<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ShopLite - Single Page E-commerce</title>
  <style>
    /* Color tokens (WCAG-friendly) - all UI accents use these tokens */
    :root{
      --bg: #f6f7fb;
      --surface: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 6px 18px rgba(0,0,0,.08);

      --brand-900: #1e3a8a;
      --brand-700: #3b82f6;
      --brand-500: #2563eb;
      --brand-300: #93c5fd;
      --accent: #10b981;
      --warning: #f59e0b;
      --green-500: #10b981;
      --red-500: #ef4444;
    }

    /* Global layout */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color: var(--text);
      background: var(--bg);
    }

    /* Layout grid: header + two-column content (catalog + cart) */
    .container {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header / Nav */
    header.site-header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .brand {
      display: flex; align-items: center; gap: 12px;
    }
    .brand .logo {
      width: 38px; height: 38px; border-radius: 10px;
      display: grid; place-items: center;
      background: linear-gradient(135deg, var(--brand-500), var(--brand-700));
      color: white; font-weight: 700;
    }
    .brand h1 { font-size: 1.1rem; margin: 0; letter-spacing: .2px; }
    .toolbar { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }

    input[type="search"] {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
      min-width: 180px;
    }
    select, input[type="range"], input[type="number"] {
      padding: 9px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
    }
    .btn {
      border: none; border-radius: 8px;
      padding: 10px 14px; cursor: pointer;
      font-weight: 600;
      background: var(--brand-500); color: white;
    }
    .btn.secondary { background: #f3f4f6; color: var(--text); border: 1px solid var(--border); }
    .btn.ghost { background: transparent; color: var(--text); border: 0; }

    /* Catalog grid and cards */
    main {
      padding: 0;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      align-items: start;
    }

    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
    }

    .panel-header {
      display: flex; justify-content: space-between; align-items: baseline;
      margin-bottom: 8px;
    }
    .panel-header h2 { margin: 0; font-size: 1.05rem; }

    .catalog {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 14px;
    }

    .card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform .2s ease;
      min-height: 320px;
    }
    .card:hover { transform: translateY(-2px); }

    .card-image {
      height: 150px;
      display: grid; place-items: center;
      color: white; font-weight: 700;
      position: relative;
      overflow: hidden;
    }
    .card-image .tag {
      position: absolute; top: 8px; left: 8px;
      background: rgba(0,0,0,.25);
      padding: 4px 8px; border-radius: 999px; font-size: 12px;
    }
    .card-body { padding: 12px; display: flex; flex-direction: column; gap: 6px; flex: 1; }
    .card-title { font-size: 1rem; margin: 0; line-height: 1.25; }
    .rating { color: #f59e0b; font-size: 13px; }
    .price { font-weight: 700; font-size: 1.05rem; }
    .stock { font-size: 12px; color: var(--muted); }
    .card-actions { margin-top: auto; display: flex; gap: 8px; align-items: center; }

    /* Cart panel (right column) */
    .cart-panel {
      align-self: start;
    }
    .cart-items { max-height: 38vh; overflow: auto; padding-right: 6px; }
    .cart-item {
      display: grid; grid-template-columns: 1fr auto; gap: 8px;
      align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border);
    }
    .cart-item-name { font-size: 0.95rem; }
    .qty-controls { display: inline-flex; align-items: center; gap: 6px; }
    .qty { width: 28px; text-align: center; padding: 4px; border-radius: 6px; border: 1px solid var(--border); }

    .cart-total { padding-top: 8px; display: grid; gap: 6px; }
    .line { display: flex; justify-content: space-between; font-size: 14px; }
    .grand { font-weight: 800; font-size: 1.05rem; }

    /* Modals (Product detail & Checkout) */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(15, 23, 42, 0.6);
      display: none; align-items: center; justify-content: center;
      padding: 20px;
      z-index: 100;
    }
    .overlay.active { display: flex; }
    .modal {
      width: min(680px, 100%);
      background: #fff; border-radius: 12px; overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    .modal-header { padding: 12px 14px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
    .modal-body { padding: 14px; display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .modal-footer { padding: 12px 14px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }

    .product-image {
      height: 260px; border-radius: 8px; display: grid; place-items: center;
      color: white; font-weight: 700;
    }
    .detail-text { display: flex; flex-direction: column; gap: 8px; }

    /* Checkout form */
    .checkout-form { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .checkout-form label { font-size: 12px; color: var(--muted); }
    .checkout-form input, .checkout-form select, .checkout-form textarea {
      padding: 10px; border-radius: 6px; border: 1px solid var(--border);
      font: inherit;
    }
    .notice { font-size: 12px; color: var(--muted); }

    /* Responsive behavior */
    @media (max-width: 980px) {
      .container { grid-template-columns: 1fr; padding: 12px; }
      .cart-panel { order: -1; }
      .modal-body { grid-template-columns: 1fr; }
      .checkout-form { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="site-header" aria-label="Site header">
    <div class="brand">
      <div class="logo" aria-label="ShopLite logo">SL</div>
      <h1>ShopLite</h1>
      <span class="notice" aria-label="SPA-E-commerce sample">Single-page demo</span>
    </div>
    <div class="toolbar" role="navigation" aria-label="Catalog controls">
      <input id="search" type="search" placeholder="Search products…" aria-label="Search products" />
      <select id="categoryFilter" aria-label="Filter by category">
        <option value="All">All categories</option>
      </select>
      <select id="sorters" aria-label="Sort products">
        <option value="default">Sort: Default</option>
        <option value="price-asc">Price: Low to High</option>
        <option value="price-desc">Price: High to Low</option>
        <option value="rating-desc">Rating</option>
      </select>
      <button class="btn" id="openCartBtn" aria-label="Open cart">
        Cart (<span id="cartCount">0</span>)
      </button>
    </div>
  </header>

  <main class="container" aria-label="Main content">
    <!-- Catalog Panel -->
    <section class="panel" id="catalogPanel" aria-label="Product catalog">
      <div class="panel-header">
        <h2>Product Catalog</h2>
        <div class="notice" id="resultSummary" aria-live="polite"></div>
      </div>
      <div class="catalog" id="catalog"></div>
    </section>

    <!-- Cart Panel (right column) -->
    <aside class="panel cart-panel" aria-label="Shopping cart" id="cartPanel">
      <div class="panel-header" style="margin-bottom:8px;">
        <h2>Cart</h2>
        <button class="btn ghost" id="clearCart" aria-label="Clear cart">Clear</button>
      </div>
      <div class="cart-items" id="cartItems" role="list" aria-label="Cart items"></div>

      <div class="cart-total" aria-label="Cart total">
        <div class="line">
          <span>Subtotal</span>
          <span id="subtotal">$0.00</span>
        </div>
        <div class="line">
          <span>Shipping</span>
          <span id="shipping">Free</span>
        </div>
        <div class="line grand" aria-label="Grand total">
          <span>Total</span>
          <span id="grandTotal">$0.00</span>
        </div>
        <button class="btn" id="checkoutBtn" aria-label="Checkout" style="width:100%;">Checkout</button>
      </div>
    </aside>
  </main>

  <!-- Product Detail Modal -->
  <div class="overlay" id="detailOverlay" aria-hidden="true" role="dialog" aria-label="Product detail">
    <div class="modal" role="document">
      <div class="modal-header">
        <strong id="detailTitle"></strong>
        <button class="btn ghost" id="closeDetail" aria-label="Close">Close</button>
      </div>
      <div class="modal-body">
        <div class="image" id="detailImage" style="height:240px; border-radius:8px; display:grid; place-items:center; color:white; font-weight:700;">
          <!-- dynamic image gradient -->
        </div>
        <div class="detail-text" id="detailText">
          <div id="detailDesc" style="color:var(--muted)"></div>
          <div><strong>Price:</strong> <span id="detailPrice"></span></div>
          <div><strong>Stock:</strong> <span id="detailStock"></span></div>
          <div id="detailRating" class="rating" aria-label=""></div>
          <div class="notice" id="detailNote"></div>
          <button class="btn" id="addToCartFromDetail" aria-label="Add to cart from detail">Add to cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout Modal -->
  <div class="overlay" id="checkoutOverlay" aria-hidden="true" role="dialog" aria-label="Checkout">
    <div class="modal" role="document">
      <div class="modal-header">
        <strong>Checkout</strong>
        <button class="btn ghost" id="closeCheckout" aria-label="Close">Close</button>
      </div>
      <div class="modal-body" style="grid-template-columns:1fr;">
        <div class="checkout-summary" style="border-right:0;">
          <p class="notice" id="checkoutNotice" style="margin-bottom:8px;">
            This is a simulated checkout. No real payments are processed.
          </p>
          <div class="line" style="gap:8px;"><span>Items:</span><span id="checkoutItemsCount">0</span></div>
          <div class="line" style="gap:8px;"><span>Subtotal:</span><span id="checkoutSubtotal">$0.00</span></div>
          <div class="line" style="gap:8px;"><span>Shipping:</span><span>Free</span></div>
          <div class="line grand" style="gap:8px;"><span>Total:</span><span id="checkoutTotal">$0.00</span></div>
        </div>
        <form class="checkout-form" id="checkoutForm" autocomplete="on" aria-label="Checkout form">
          <div>
            <label for="name">Full name</label>
            <input id="name" name="name" type="text" placeholder="Jane Doe" required>
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="jane@example.com" required>
          </div>
          <div>
            <label for="address">Shipping address</label>
            <input id="address" name="address" type="text" placeholder="123 Main St" required>
          </div>
          <div>
            <label for="city">City</label>
            <input id="city" name="city" type="text" placeholder="Anytown" required>
          </div>
          <div>
            <label for="zip">ZIP / Postal</label>
            <input id="zip" name="zip" type="text" placeholder="12345" required>
          </div>
          <div style="grid-column: span 2;">
            <button class="btn" type="submit" style="width:100%;">Place order</button>
          </div>
        </form>
      </div>
      <div class="modal-footer" aria-label="Checkout actions" style="justify-content: space-between;">
        <span class="notice" id="checkoutNote2">You will receive a confirmation code after placing the order.</span>
      </div>
    </div>
  </div>

  <script>
    // Data: products (mock catalog)
    const PRODUCTS = [
      {
        id: 'p-horizon',
        name: 'Horizon Wireless Earbuds',
        description: 'Compact, immersive sound with up to 24h battery life and noise isolation.',
        price: 59.99,
        category: 'Audio',
        rating: 4.5,
        stock: 20,
        color1: '#1e40af',
        color2: '#f472b6'
      },
      {
        id: 'p-nebula',
        name: 'Nebula Smartwatch',
        description: 'Health tracking, 7-day battery, and sleek AMOLED display.',
        price: 149.99,
        category: 'Wearables',
        rating: 4.2,
        stock: 8,
        color1: '#374151',
        color2: '#8b5cf6'
      },
      {
        id: 'p-pulse-speaker',
        name: 'Pulse Bluetooth Speaker',
        description: 'Water-resistant speaker with rich bass and stereo pairing.',
        price: 89.99,
        category: 'Audio',
        rating: 4.7,
        stock: 12,
        color1: '#e11d48',
        color2: '#f59e0b'
      },
      {
        id: 'p-luma-keyboard',
        name: 'Luma Mechanical Keyboard',
        description: 'Hot-swappable keys with per-key RGB lighting.',
        price: 129.99,
        category: 'Accessories',
        rating: 4.6,
        stock: 6,
        color1: '#0f766e',
        color2: '#f472b6'
      },
      {
        id: 'p-astro-hub',
        name: 'Flux USB-C Hub',
        description: '6-in-1 hub with 4K60 HDMI, USB-C power, and data ports.',
        price: 39.99,
        category: 'Accessories',
        rating: 4.3,
        stock: 25,
        color1: '#10b981',
        color2: '#3b82f6'
      },
      {
        id: 'p-astra-monitor',
        name: 'Astra 27" 4K Monitor',
        description: 'Ultra-clear display with HDR and 90W power pass-through.',
        price: 299.99,
        category: 'Displays',
        rating: 4.5,
        stock: 4,
        color1: '#111827',
        color2: '#3b82f6'
      }
    ];

    // State
    const state = {
      cart: [], // { productId, quantity }
      search: '',
      category: 'All',
      maxPrice: 10000,
      sort: 'default'
    };

    // Elements
    const catalogEl = document.getElementById('catalog');
    const searchEl = document.getElementById('search');
    const categoryEl = document.getElementById('categoryFilter');
    const sortEl = document.getElementById('sorters');
    const cartCountEl = document.getElementById('cartCount');
    const cartItemsEl = document.getElementById('cartItems');
    const subtotalEl = document.getElementById('subtotal');
    const grandTotalEl = document.getElementById('grandTotal');
    const openCartBtn = document.getElementById('openCartBtn');
    const detailOverlay = document.getElementById('detailOverlay');
    const detailTitle = document.getElementById('detailTitle');
    const detailImage = document.getElementById('detailImage');
    const detailText = document.getElementById('detailText');
    const detailDesc = document.getElementById('detailDesc');
    const detailPrice = document.getElementById('detailPrice');
    const detailStock = document.getElementById('detailStock');
    const detailRating = document.getElementById('detailRating');
    const detailNote = document.getElementById('detailNote');
    const addToCartFromDetail = document.getElementById('addToCartFromDetail');
    const closeDetailBtn = document.getElementById('closeDetail');
    const checkoutOverlay = document.getElementById('checkoutOverlay');
    const checkoutForm = document.getElementById('checkoutForm');
    const checkoutTotal = document.getElementById('checkoutTotal');
    const closeCheckoutBtn = document.getElementById('closeCheckout');
    const checkoutItemsCount = document.getElementById('checkoutItemsCount');
    const checkoutSubtotal = document.getElementById('checkoutSubtotal');
    const checkoutTotalLine = document.getElementById('checkoutTotal');
    const clearCartBtn = document.getElementById('clearCart');
    const resultSummaryEl = document.getElementById('resultSummary');
    const checkoutNotice = document.getElementById('checkoutNotice');
    const checkoutOverlayLabel = document.querySelector('#checkoutOverlay[aria-hidden]');
    const detailOverlayBackdrop = detailOverlay;

    // Helpers
    function formatPrice(n) {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(n);
    }

    function saveCart() {
      localStorage.setItem('spa_cart', JSON.stringify(state.cart));
    }

    function loadCart() {
      try {
        const raw = localStorage.getItem('spa_cart');
        if (raw) state.cart = JSON.parse(raw);
      } catch {
        state.cart = [];
      }
    }

    function cartItemCount() {
      return state.cart.reduce((sum, c) => sum + c.quantity, 0);
    }

    function findProduct(pid) {
      return PRODUCTS.find(p => p.id === pid);
    }

    function calcTotals() {
      let subtotal = 0;
      for (const item of state.cart) {
        const p = findProduct(item.productId);
        if (p) subtotal += p.price * item.quantity;
      }
      const shipping = subtotal > 0 ? 0 : 0;
      const grand = subtotal + shipping;
      return { subtotal, shipping, grand };
    }

    function renderCart() {
      // cart items
      cartItemsEl.innerHTML = '';
      if (state.cart.length === 0) {
        cartItemsEl.innerHTML = '<div class="notice" style="padding:8px 0;">Cart is empty. Add items from the catalog.</div>';
      } else {
        for (const ci of state.cart) {
          const p = findProduct(ci.productId);
          if (!p) continue;

          const itemEl = document.createElement('div');
          itemEl.className = 'cart-item';
          itemEl.setAttribute('data-id', ci.productId);
          itemEl.innerHTML = `
            <div class="cart-item-name" style="font-weight:600;">
              ${p.name} <span style="color:var(--muted); font-weight:400;">• ${formatPrice(p.price)}</span>
            </div>
            <div class="qty-controls" aria-label="Quantity controls">
              <button class="btn ghost btn-sm" data-action="decrease" aria-label="Decrease quantity" style="padding:6px 8px;">−</button>
              <input class="qty" type="number" min="1" max="${p.stock}" value="${ci.quantity}" aria-label="Quantity" />
              <button class="btn ghost btn-sm" data-action="increase" aria-label="Increase quantity" style="padding:6px 8px;">+</button>
              <button class="btn ghost" data-action="remove" aria-label="Remove item" style="margin-left:6px;">Remove</button>
            </div>
          `;
          cartItemsEl.appendChild(itemEl);

          // Attach listeners
          const minus = itemEl.querySelector('[data-action="decrease"]');
          const plus = itemEl.querySelector('[data-action="increase"]');
          const remove = itemEl.querySelector('[data-action="remove"]');
          const qtyInput = itemEl.querySelector('.qty');

          minus.addEventListener('click', () => updateCartQuantity(ci.productId, Math.max(1, ci.quantity - 1)));
          plus.addEventListener('click', () => updateCartQuantity(ci.productId, Math.min(p.stock, ci.quantity + 1)));
          remove.addEventListener('click', () => removeFromCart(ci.productId));
          qtyInput.addEventListener('change', (e) => {
            const val = parseInt(e.target.value, 10);
            if (Number.isNaN(val) || val < 1) {
              e.target.value = ci.quantity;
              return;
            }
            updateCartQuantity(ci.productId, Math.min(p.stock, val));
          });
        }
      }

      // update totals
      const { subtotal, grand } = calcTotals();
      subtotalEl.textContent = formatPrice(subtotal);
      grandTotalEl.textContent = formatPrice(grand);
      cartCountEl.textContent = cartItemCount();

      // result summary
      const visibleCount = state.cart.length ? state.cart.reduce((s, c) => s + c.quantity, 0) : 0;
      resultSummaryEl.textContent = visibleCount ? `Items in cart: ${visibleCount}` : 'Cart is empty';
    }

    function updateCartQuantity(productId, quantity) {
      const idx = state.cart.findIndex(i => i.productId === productId);
      const product = findProduct(productId);
      if (!product) return;
      if (quantity <= 0) {
        state.cart.splice(idx, 1);
      } else {
        state.cart[idx] = { productId, quantity };
      }
      saveCart();
      renderCart();
    }

    function addToCart(productId, qty = 1) {
      const product = findProduct(productId);
      if (!product) return;
      const existing = state.cart.find(i => i.productId === productId);
      const newQty = existing ? existing.quantity + qty : qty;
      if (newQty > product.stock) {
        alert('Sorry, not enough stock for this item.');
        return;
      }
      if (existing) {
        existing.quantity = newQty;
      } else {
        state.cart.push({ productId, quantity: qty });
      }
      saveCart();
      renderCart();
      // reflect cart open count
      openCart();
    }

    function removeFromCart(productId) {
      const idx = state.cart.findIndex(i => i.productId === productId);
      if (idx >= 0) {
        state.cart.splice(idx, 1);
        saveCart();
        renderCart();
      }
    }

    function openCart() {
      // Ensure cart panel is visible on desktop; on mobile, the cart is part of the flow
      // For this minimal SPA, we simply focus the cart count already on header
    }

    // Detail modal
    function openDetail(product) {
      // Build detail view
      detailTitle.textContent = product.name;
      detailDesc.textContent = product.description;
      detailPrice.textContent = formatPrice(product.price);
      detailStock.textContent = product.stock > 0 ? `${product.stock} in stock` : 'Out of stock';
      detailRating.textContent = `Rating: ${product.rating.toFixed(1)} / 5`;
      detailNote.textContent = product.stock > 0 ? 'In stock – ready to add.' : 'Out of stock';

      // Image gradient
      detailImage.style.background = `linear-gradient(135deg, ${product.color1}, ${product.color2})`;
      detailImage.textContent = product.name.charAt(0);

      addToCartFromDetail.disabled = product.stock <= 0;
      addToCartFromDetail.textContent = product.stock > 0 ? 'Add to cart' : 'Out of stock';
      addToCartFromDetail.setAttribute('data-id', product.id);

      detailOverlay.classList.add('active');
      detailOverlay.setAttribute('aria-hidden', 'false');
      detailOverlay.focus?.();
    }

    function closeDetail() {
      detailOverlay.classList.remove('active');
      detailOverlay.setAttribute('aria-hidden', 'true');
    }

    // Checkout flow (simulated)
    function openCheckout() {
      if (state.cart.length === 0) {
        alert('Your cart is empty.');
        return;
      }
      // Update checkout summary
      const { subtotal, grand } = calcTotals();
      const itemsCount = state.cart.reduce((s, c) => s + c.quantity, 0);
      checkoutItemsCount.textContent = itemsCount;
      checkoutSubtotal.textContent = formatPrice(subtotal);
      checkoutTotalLine.textContent = formatPrice(grand);
      checkoutTotal.textContent = formatPrice(grand);

      checkoutOverlay.classList.add('active');
      checkoutOverlay.setAttribute('aria-hidden', 'false');
    }

    function closeCheckout() {
      checkoutOverlay.classList.remove('active');
      checkoutOverlay.setAttribute('aria-hidden', 'true');
    }

    function placeOrder(event) {
      event.preventDefault();
      // Simple validation
      const form = checkoutForm;
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      // Simulate order number
      const orderNumber = 'ORD-' + Math.floor(Math.random() * 9e6).toString().padStart(7, '0');
      // Reset cart
      state.cart = [];
      saveCart();
      renderCart();
      closeCheckout();

      // Show confirmation banner
      alert(`Order placed successfully! Your order number is ${orderNumber}.`);
    }

    // Catalog rendering
    function renderCatalog() {
      const search = (state.search || '').toLowerCase();
      const cat = state.category;
      const maxP = state.maxPrice;
      const sort = state.sort;

      // Build category options
      const categories = Array.from(new Set(PRODUCTS.map(p => p.category)));
      // Populate category filter if first run
      if (categoryEl.options.length <= 1) {
        const frag = document.createDocumentFragment();
        categories.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c;
          opt.textContent = c;
          frag.appendChild(opt);
        });
        categoryEl.appendChild(frag);
      }

      // Filter
      let items = PRODUCTS.filter(p => {
        const matchCat = cat === 'All' || p.category === cat;
        const matchSearch = !search || p.name.toLowerCase().includes(search) || p.description.toLowerCase().includes(search);
        const matchPrice = p.price <= maxP;
        return matchCat && matchSearch && matchPrice;
      });

      // Sort
      switch (sort) {
        case 'price-asc':
          items = items.sort((a,b) => a.price - b.price);
          break;
        case 'price-desc':
          items = items.sort((a,b) => b.price - a.price);
          break;
        case 'rating-desc':
          items = items.sort((a,b) => b.rating - a.rating);
          break;
        default:
          // default: maintain catalog order
          break;
      }

      // Render
      catalogEl.innerHTML = '';
      if (items.length === 0) {
        catalogEl.innerHTML = '<div class="notice" style="padding:20px 10px;">No products match your filters.</div>';
      } else {
        const frag = document.createDocumentFragment();
        items.forEach(p => {
          const card = document.createElement('article');
          card.className = 'card';
          card.setAttribute('aria-label', p.name);
          card.innerHTML = `
            <div class="card-image" style="background: linear-gradient(135deg, ${p.color1}, ${p.color2});" aria-label="Product image">
              <span>${p.name.charAt(0)}</span>
              <span class="tag" aria-label="Category">${p.category}</span>
            </div>
            <div class="card-body">
              <h3 class="card-title">${p.name}</h3>
              <div class="rating" aria-label="Rating: ${p.rating} out of 5">Rating: ${p.rating.toFixed(1)} ★</div>
              <div class="price">${formatPrice(p.price)}</div>
              <div class="stock" aria-live="polite">${p.stock > 0 ? `${p.stock} in stock` : 'Out of stock'}</div>
              <div class="card-actions">
                <button class="btn" data-action="add" data-id="${p.id}" ${p.stock<=0?'disabled':''}>Add to cart</button>
                <button class="btn secondary" data-action="detail" data-id="${p.id}">View</button>
              </div>
            </div>
          `;
          // detail + add handlers
          const addBtn = card.querySelector('button[data-action="add"]');
          const detailBtn = card.querySelector('button[data-action="detail"]');
          addBtn.addEventListener('click', () => addToCart(p.id, 1));
          detailBtn.addEventListener('click', () => openDetail(p));

          frag.appendChild(card);
        });
        catalogEl.appendChild(frag);
      }

      // Update summary line
      const totalCount = PRODUCTS.length;
      resultSummaryEl.textContent = `Showing ${items.length} of ${totalCount} products`;
    }

    // Initialize
    function init() {
      // Load cart
      loadCart();
      // Initialize category options
      renderCatalog();
      renderCart();

      // Event listeners
      searchEl.addEventListener('input', (e) => {
        state.search = e.target.value;
        renderCatalog();
      });

      categoryEl.addEventListener('change', (e) => {
        state.category = e.target.value;
        renderCatalog();
      });

      sortEl.addEventListener('change', (e) => {
        state.sort = e.target.value;
        renderCatalog();
      });

      openCartBtn.addEventListener('click', () => openCheckout());

      clearCartBtn.addEventListener('click', () => {
        if (confirm('Clear the cart?')) {
          state.cart = [];
          saveCart();
          renderCart();
        }
      });

      // Detail modal controls
      closeDetailBtn.addEventListener('click', closeDetail);
      detailOverlay.addEventListener('click', (e) => {
        if (e.target === detailOverlay) closeDetail();
      });
      addToCartFromDetail.addEventListener('click', () => {
        const pid = addToCartFromDetail.getAttribute('data-id');
        if (pid) {
          addToCart(pid, 1);
          closeDetail();
        }
      });

      // Checkout flow
      document.getElementById('checkoutBtn').addEventListener('click', openCheckout);
      closeCheckoutBtn.addEventListener('click', closeCheckout);
      checkoutOverlay.addEventListener('click', (e) => {
        if (e.target === checkoutOverlay) closeCheckout();
      });
      checkoutForm.addEventListener('submit', placeOrder);

      // Keyboard accessibility
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (detailOverlay.classList.contains('active')) closeDetail();
          if (checkoutOverlay.classList.contains('active')) closeCheckout();
        }
      });
    }

    // Run
    init();
    // Notes:
    // - The app is framework-agnostic (vanilla JS)
    // - All data is local; cart persists via localStorage
    // - This SPA supports catalog browsing, detail view, cart with update/remove, and a simulated checkout
    // - Extend by adding more products, additional filters, or integrating a real API in the data layer

  </script>
</body>
</html>