<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Palette Shop - Single Page E-commerce</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --brand-900:#264653; /* dark teal / primary */
      --brand-700:#2A9D8F; /* teal */
      --brand-500:#E9C46A; /* amber */
      --brand-400:#F4A261; /* orange */
      --brand-600:#E76F51; /* coral */
      --bg:#ffffff;
      --surface:#ffffff;
      --text:#1f1f1f;
      --muted:#5a5a5a;
      --border:#e5e5e5;
      --shadow: 0 2px 8px rgba(0,0,0,.08);
      --radius:12px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, Arial, sans-serif;
      color: var(--text);
      background: #fafafa;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Layout */
    header.app-header {
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 20px;
      background: var(--brand-900);
      color: white;
      box-shadow: 0 2px 6px rgba(0,0,0,.15);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .brand-mark {
      width: 34px; height: 34px;
      border-radius: 9px;
      background: linear-gradient(135deg, #2A9D8F, #264653);
      display: grid; place-items: center;
      color: white;
      font-weight: 700;
      font-size: 14px;
    }
    .brand-name {
      font-weight: 700;
      letter-spacing: .4px;
    }
    .cart-btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 14px; border-radius: 8px;
      border: 1px solid rgba(255,255,255,.4);
      background: rgba(255,255,255,.08);
      color: white; cursor: pointer;
    }
    .cart-count {
      background: #fff; color: var(--brand-900);
      padding: 2px 8px; border-radius: 999px; font-weight: 700;
    }

    main { padding: 20px; max-width: 1200px; margin: 0 auto; width: 100%; }

    /* Filters bar */
    .filters {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
      gap: 12px;
      align-items: end;
      margin: 14px 0 20px;
    }
    .filters input, .filters select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 14px;
    }
    .filters label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px; }

    /* Catalog grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
    }
    .card {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      box-shadow: var(--shadow);
      display: flex; flex-direction: column;
      overflow: hidden;
    }
    .card img {
      width: 100%; height: 150px; object-fit: cover;
      background: #f0f0f0;
    }
    .card-body { padding: 12px; display: flex; flex-direction: column; gap: 8px; flex: 1; }
    .card-title { font-size: 16px; font-weight: 600; margin: 0; }
    .card-desc { font-size: 13px; color: #555; min-height: 38px; }
    .price-row { display: flex; justify-content: space-between; align-items: center; }
    .price { font-weight: 700; color: var(--brand-700); }
    .stock {
      font-size: 12px; padding: 4px 8px; border-radius: 999px;
      border: 0; font-weight: 700;
    }
    .stock.in { background: #e6f7f2; color: #1f8a77; }
    .stock.out { background: #ffe1e1; color: #a11d1d; }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 10px 12px; border-radius: 8px; border: none; cursor: pointer;
      font-weight: 600; background: var(--brand-700); color: white;
      transition: transform .05s ease-in-out;
    }
    .btn:active { transform: scale(0.98); }
    .btn.secondary { background: #eee; color: #333; }
    .btn.ghost { background: transparent; border: 1px solid var(--border); color: #333; }
    .btn.small { padding: 8px 10px; font-size: 13px; }

    /* Modal for product details */
    .modal {
      position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,.4); padding: 20px; z-index: 60;
    }
    .modal.open { display: flex; }
    .modal-dialog {
      width: min(680px, 96%); background: #fff; border-radius: 12px; overflow: hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      display: grid; grid-template-columns: 1fr 1fr;
    }
    .modal-media { padding: 12px; display: grid; place-items: center; background: #fff; }
    .modal-media img { width: 100%; height: 300px; object-fit: cover; border-radius: 8px; }
    .modal-content { padding: 14px; display: flex; flex-direction: column; gap: 8px; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .modal-title { font-size: 18px; font-weight: 700; }
    .modal-desc { color: #555; font-size: 14px; line-height: 1.4; }
    .modal-actions { display: flex; gap: 8px; align-items: center; }

    /* Cart Drawer */
    .cart-drawer {
      position: fixed; top: 0; right: 0; height: 100%; width: 380px;
      background: #fff; border-left: 1px solid var(--border);
      box-shadow: -6px 0 16px rgba(0,0,0,.08);
      transform: translateX(100%); transition: transform .25s ease;
      z-index: 70; display: flex; flex-direction: column;
    }
    .cart-drawer.open { transform: translateX(0); }
    .cart-header { display: flex; justify-content: space-between; align-items: center;
      padding: 14px; border-bottom: 1px solid var(--border);
      background: var(--brand-700); color: #fff;
    }
    .cart-title { font-weight: 700; }
    .cart-content { padding: 12px; overflow: auto; flex: 1; }
    .cart-item { display: grid; grid-template-columns: 48px 1fr auto; gap: 8px; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); }
    .cart-thumb { width: 48px; height: 48px; object-fit: cover; border-radius: 6px; }
    .cart-item-name { font-size: 13px; }
    .cart-qty { display: inline-flex; align-items: center; border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
    .cart-qty button { background: #fff; border: none; padding: 6px 8px; cursor: pointer; }
    .cart-qty input { width: 40px; text-align: center; border: none; outline: none; }

    .cart-summary { padding: 12px; border-top: 1px solid var(--border); }
    .row { display: flex; justify-content: space-between; align-items: center; }

    .checkout-bar { padding: 12px; display: grid; gap: 8px; border-top: 1px solid var(--border); }
    .total { font-weight: 700; font-size: 16px; display: flex; justify-content: space-between; }

    /* Helpers */
    .section-title { font-size: 14px; color: var(--muted); text-transform: uppercase; letter-spacing: .4px; margin: 8px 0; }
    .empty { text-align: center; padding: 40px 12px; color: var(--muted); }

    /* Responsive tweaks */
    @media (max-width: 980px){
      .filters { grid-template-columns: 1fr 1fr; }
      .modal-dialog { grid-template-columns: 1fr; width: 90%; }
      .cart-drawer { width: 100%; height: auto; bottom: 0; right: 0; top: auto; transform: translateY(100%); }
      .cart-drawer.open { transform: translateY(0); height: 50%; }
    }

  </style>
</head>
<body>
  <header class="app-header" aria-label="Site header">
    <div class="brand" aria-label="Brand">
      <div class="brand-mark" aria-hidden="true">PS</div>
      <div class="brand-name">Palette Shop</div>
      <div class="section-title" style="display:inline-block; margin-left:8px; color:#fff;">Palette-Driven E-commerce</div>
    </div>
    <button id="openCart" class="cart-btn" aria-label="Open cart" title="Open cart">
      ðŸ§º Cart <span id="cartCount" class="cart-count">0</span>
    </button>
  </header>

  <main aria-label="Main content">
    <section class="filters" aria-label="Product filters">
      <div>
        <label for="search" aria-label="Search products">Search</label>
        <input id="search" type="search" placeholder="Search products..." />
      </div>
      <div>
        <label for="categoryFilter" aria-label="Category filter">Category</label>
        <select id="categoryFilter">
          <option value="all">All</option>
        </select>
      </div>
      <div>
        <label for="minPrice" aria-label="Minimum price filter">Min price</label>
        <input id="minPrice" type="number" min="0" step="1" value="0" />
      </div>
      <div>
        <label for="maxPrice" aria-label="Maximum price filter">Max price</label>
        <input id="maxPrice" type="number" min="0" step="1" value="1000" />
      </div>
      <div>
        <label for="ratingFilter" aria-label="Minimum rating filter">Min rating</label>
        <select id="ratingFilter">
          <option value="0">All</option>
          <option value="3">3â˜…+</option>
          <option value="4">4â˜…+</option>
          <option value="4.5">4.5â˜…+</option>
        </select>
      </div>
      <div>
        <label for="sortFilter" aria-label="Sort options">Sort</label>
        <select id="sortFilter">
          <option value="default">Recommended</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="rating-desc">Rating: High to Low</option>
          <option value="name-asc">Name: A-Z</option>
        </select>
      </div>
    </section>

    <section id="catalog" class="grid" aria-label="Product catalog">
      <!-- Catalog cards will be injected here -->
    </section>

    <p class="empty" id="emptyState" style="display:none;">No products match your filters. Try adjusting the search or filters.</p>
  </main>

  <!-- Product Detail Modal -->
  <div id="productModal" class="modal" role="dialog" aria-modal="true" aria-label="Product details">
    <div class="modal-dialog">
      <div class="modal-media" aria-hidden="true">
        <img id="modalImage" alt="Product image" />
      </div>
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title" id="modalTitle">Product</div>
          <button id="modalClose" class="btn ghost" aria-label="Close details">Close</button>
        </div>
        <div id="modalDesc" class="modal-desc"></div>
        <div class="row" style="gap:8px; align-items:center;">
          <span id="modalPrice" class="price" style="font-size:16px;">$0.00</span>
          <span id="modalStock" class="stock in" style="font-weight:700;"></span>
        </div>
        <div id="modalRating" aria-label="Rating" style="color:#ffb400; font-size:14px;"></div>
        <div class="modal-actions" style="margin-top:6px;">
          <button id="modalAddToCart" class="btn" aria-label="Add to cart from details" style="background: var(--brand-700);">Add to cart</button>
          <button id="modalShopNow" class="btn secondary" aria-label="Shop now" style="border:1px solid var(--border);">View in catalog</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Drawer -->
  <aside id="cartDrawer" class="cart-drawer" aria-label="Shopping cart" role="complementary" aria-hidden="true">
    <div class="cart-header">
      <div class="cart-title">Your Cart</div>
      <button id="closeCart" class="btn ghost" aria-label="Close cart">âœ•</button>
    </div>
    <div class="cart-content" id="cartContent">
      <!-- Cart items injected here -->
    </div>
    <div class="cart-summary" id="cartSummary">
      <div class="row" style="margin-bottom:6px;">
        <span>Subtotal</span><span id="cartSubtotal">$0.00</span>
      </div>
      <div class="row" style="margin-bottom:6px;">
        <span>Tax (est.)</span><span id="cartTax">$0.00</span>
      </div>
      <div class="row total" aria-label="Total">
        <span>Total</span><span id="cartTotal">$0.00</span>
      </div>
    </div>
    <div class="checkout-bar">
      <button id="checkoutBtn" class="btn" style="background: var(--brand-400);">Checkout</button>
      <button id="continueBtn" class="btn ghost" aria-label="Continue shopping" style="justify-content:center;">Continue shopping</button>
    </div>
  </aside>

  <!-- Simple Checkout Confirmation Screen (in-page) -->
  <div id="checkoutScreen" class="modal" aria-hidden="true" role="dialog" aria-label="Checkout confirmation" style="pointer-events:none;">
    <div class="modal-dialog" style="grid-template-columns:1fr;">
      <div class="modal-content" style="padding:20px; text-align:center;">
        <div style="font-size:28px; font-weight:700; margin-bottom:10px; color: var(--brand-700);">Checkout Complete</div>
        <div id="orderSummary" style="margin:8px 0 20px; color:#555;"></div>
        <button id="shopAgain" class="btn" style="background: var(--brand-700);">Shop more</button>
      </div>
    </div>
  </div>

  <script>
    // Data model
    const productsSeed = [
      { id: 'p1', name: 'Aero Backpack', description: 'Lightweight, durable backpack with ergonomic design and water-resistant fabric.', price: 59.99, category: 'Bags', rating: 4.6, stock: 8 },
      { id: 'p2', name: 'Nimbus Jacket', description: 'Breathable, weatherproof jacket with zip pockets and adjustable hood.', price: 89.99, category: 'Apparel', rating: 4.5, stock: 4 },
      { id: 'p3', name: 'Glide Sneakers', description: 'Everyday sneakers with responsive foam and anti-slip sole.', price: 74.5, category: 'Footwear', rating: 4.2, stock: 0 },
      { id: 'p4', name: 'Kairo Sunglasses', description: 'Polarized lenses with UV protection and lightweight frame.', price: 24.99, category: 'Accessories', rating: 4.1, stock: 15 },
      { id: 'p5', name: 'Luma Desk Lamp', description: 'LED desk lamp with color temperature controls and USB-C charging.', price: 29.99, category: 'Home', rating: 4.4, stock: 12 },
      { id: 'p6', name: 'Pulse Fitness Band', description: 'Multi-sport tracker with heart rate and sleep tracking.', price: 44.99, category: 'Wearables', rating: 4.0, stock: 6 },
      { id: 'p7', name: 'Cascade Water Bottle', description: 'Insulated stainless steel bottle keeps drinks cold for 24h.', price: 19.99, category: 'Accessories', rating: 4.3, stock: 25 },
      { id: 'p8', name: 'Nova Hoodie', description: 'Cozy fleece hoodie with roomy pocket and durable stitching.', price: 39.99, category: 'Apparel', rating: 4.7, stock: 3 }
    ];

    // Helpers
    function currency(n){ return '$' + n.toFixed(2); }

    // Image generator (SVG data URLs)
    function makeImage(label, colorA, colorB){
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='600' height='360'>
        <defs>
          <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
            <stop stop-color='${colorA}' offset='0'/>
            <stop stop-color='${colorB}' offset='1'/>
          </linearGradient>
        </defs>
        <rect width='100%' height='100%' fill='url(#g)'/>
        <text x='50%' y='52%' text-anchor='middle' fill='white' font-family='Arial' font-weight='bold' font-size='40'>${label}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    // Build product objects with images
    const categoryPalette = ['#2A9D8F', '#E9C46A', '#F4A261', '#E76F51', '#264653'];
    const catalog = [];
    let products = [];

    function initProducts() {
      products = productsSeed.map((p, idx) => {
        const colorA = categoryPalette[idx % categoryPalette.length];
        const colorB = categoryPalette[(idx+1) % categoryPalette.length];
        return { ...p, image: makeImage(p.name, colorA, colorB), id: p.id };
      });
      // Build category list
      const categories = Array.from(new Set(products.map(p => p.category))).sort();
      const categoryFilter = document.getElementById('categoryFilter');
      categories.forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat;
        opt.textContent = cat;
        categoryFilter.appendChild(opt);
      });
    }

    // Cart persistence
    const CART_KEY = 'palette_shop_cart_v1';
    let cart = [];

    function loadCart(){
      try {
        const raw = localStorage.getItem(CART_KEY);
        if(raw){
          cart = JSON.parse(raw);
          if(!Array.isArray(cart)) cart = [];
        }
      } catch(e){ cart = []; }
      updateCartUI();
    }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }

    // Cart operations
    function addToCart(productId, qty=1){
      const p = products.find(x => x.id === productId);
      if(!p || p.stock <= 0) return;
      const item = cart.find(i => i.productId === productId);
      const currentQty = item ? item.qty : 0;
      const newQty = currentQty + qty;
      const clamped = Math.min(newQty, p.stock);
      if(!item){
        cart.push({ productId, qty: clamped });
      } else {
        item.qty = clamped;
      }
      if(clamped <= 0){
        // nothing
      } else {
        saveCart();
        updateCartUI();
      }
    }

    function updateCartItem(productId, qty){
      const p = products.find(x => x.id === productId);
      if(!p) return;
      const item = cart.find(i => i.productId === productId);
      if(!item) return;
      const newQty = Math.max(0, Math.min(qty, p.stock));
      if(newQty === 0){
        cart = cart.filter(i => i.productId !== productId);
      } else {
        item.qty = newQty;
      }
      saveCart();
      updateCartUI();
    }

    function removeFromCart(productId){
      cart = cart.filter(i => i.productId !== productId);
      saveCart();
      updateCartUI();
    }

    function clearCart(){
      cart = [];
      saveCart();
      updateCartUI();
    }

    // Rendering helpers
    const catalogEl = document.getElementById('catalog');
    const searchEl = document.getElementById('search');
    const categoryEl = document.getElementById('categoryFilter');
    const minPriceEl = document.getElementById('minPrice');
    const maxPriceEl = document.getElementById('maxPrice');
    const ratingEl = document.getElementById('ratingFilter');
    const sortEl = document.getElementById('sortFilter');
    const emptyStateEl = document.getElementById('emptyState');

    function renderCatalog(){
      // filter
      const q = (searchEl.value || '').toLowerCase();
      const cat = categoryEl.value;
      const minP = parseFloat(minPriceEl.value) || 0;
      const maxP = parseFloat(maxPriceEl.value) || Number.POSITIVE_INFINITY;
      const minR = parseFloat(ratingEl.value) || 0;
      const sort = sortEl.value;

      let items = products.filter(p => {
        const inCat = (cat === 'all') || (p.category === cat);
        const inSearch = !q || p.name.toLowerCase().includes(q) || p.description.toLowerCase().includes(q);
        const inPrice = p.price >= minP && p.price <= maxP;
        const inRating = p.rating >= minR;
        return inCat && inSearch && inPrice && inRating;
      });

      // sort
      switch(sort){
        case 'price-asc': items = items.sort((a,b)=>a.price - b.price); break;
        case 'price-desc': items = items.sort((a,b)=>b.price - a.price); break;
        case 'rating-desc': items = items.sort((a,b)=> b.rating - a.rating); break;
        case 'name-asc': items = items.sort((a,b)=> a.name.localeCompare(b.name)); break;
        default: items = items.sort((a,b)=> a.name.localeCompare(b.name)); break;
      }

      // render
      catalogEl.innerHTML = '';
      if(items.length === 0){
        emptyStateEl.style.display = 'block';
      } else {
        emptyStateEl.style.display = 'none';
      }
      items.forEach(p => {
        const stockClass = p.stock > 0 ? 'in' : 'out';
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}" />
          <div class="card-body">
            <h3 class="card-title" style="margin:0; cursor:pointer;" data-id="${p.id}" aria-label="Open product ${p.name}">${p.name}</h3>
            <div class="card-desc" aria-label="Description">${p.description}</div>
            <div class="price-row">
              <span class="price">${currency(p.price)}</span>
              <span class="stock ${stockClass}" aria-label="${p.stock > 0 ? 'In stock' : 'Out of stock'}">${p.stock > 0 ? 'In stock' : 'Out of stock'}</span>
            </div>
            <div style="display:flex; gap:8px;">
              <button class="btn" data-id="${p.id}" ${p.stock<=0?'disabled':''} aria-label="Add to cart ${p.name}">Add to cart</button>
              <button class="btn secondary" data-id="${p.id}" aria-label="View details ${p.name}">Details</button>
            </div>
          </div>
        `;
        catalogEl.appendChild(card);

        // event handlers per card
        const addBtn = card.querySelector('button[data-id="'+p.id+'"]');
        addBtn.addEventListener('click', () => {
          if(p.stock <= 0) return;
          addToCart(p.id, 1);
        });

        const detailBtn = card.querySelector('button[data-id="'+p.id+'"][aria-label*="Details"]');
        if(detailBtn){
          detailBtn.addEventListener('click', () => openProductModal(p.id));
        }

        // title click to open modal
        const titleEl = card.querySelector('.card-title');
        if(titleEl){
          titleEl.addEventListener('click', () => openProductModal(p.id));
        }
      });
    }

    // Cart UI
    const cartContentEl = document.getElementById('cartContent');
    const cartSubtotalEl = document.getElementById('cartSubtotal');
    const cartTaxEl = document.getElementById('cartTax');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartCountEl = document.getElementById('cartCount');
    const openCartBtn = document.getElementById('openCart');
    const cartDrawer = document.getElementById('cartDrawer');
    const closeCartBtn = document.getElementById('closeCart');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const continueBtn = document.getElementById('continueBtn');
    const shopAgainBtn = document.getElementById('shopAgain');

    function formatCartItem(p, item){
      // returns DOM node
      const el = document.createElement('div');
      el.className = 'cart-item';
      el.innerHTML = `
        <img class="cart-thumb" src="${p.image}" alt="${p.name}">
        <div style="display:flex; flex-direction:column; gap:4px;">
          <span class="cart-item-name" aria-label="Product name">${p.name}</span>
          <span style="font-size:12px; color:var(--muted);">${p.category} â€¢ ${currency(p.price)}</span>
        </div>
        <div class="cart-qty" aria-label="Quantity control" role="group" data-id="${p.id}">
          <button class="dec" aria-label="Decrease">-</button>
          <input type="text" value="${item.qty}" disabled />
          <button class="inc" aria-label="Increase">+</button>
        </div>
      `;
      // attach handlers
      const dec = el.querySelector('.dec');
      const inc = el.querySelector('.inc');
      dec.addEventListener('click', () => {
        updateCartItem(p.id, item.qty - 1);
      });
      inc.addEventListener('click', () => {
        updateCartItem(p.id, item.qty + 1);
      });
      return el;
    }

    function renderCart(){
      cartContentEl.innerHTML = '';
      if(cart.length === 0){
        cartContentEl.innerHTML = `<div class="empty" style="padding:20px;">Your cart is empty.</div>`;
        cartSubtotalEl.textContent = currency(0);
        cartTaxEl.textContent = currency(0);
        cartTotalEl.textContent = currency(0);
        cartCountEl.textContent = '0';
        return;
      }
      let subtotal = 0;
      cart.forEach(ci => {
        const p = products.find(x => x.id === ci.productId);
        if(!p) return;
        subtotal += p.price * ci.qty;
        const itemEl = renderCartItem(p, ci);
        cartContentEl.appendChild(itemEl);
      });
      const tax = subtotal * 0.07; // 7% simulated tax
      const total = subtotal + tax;
      cartSubtotalEl.textContent = currency(subtotal);
      cartTaxEl.textContent = currency(tax);
      cartTotalEl.textContent = currency(total);
      cartCountEl.textContent = String(cart.reduce((a,b)=>a+b.qty,0));
    }

    function renderCartItem(p, ci){
      // create element
      const wrapper = document.createElement('div');
      wrapper.dataset.productId = p.id;
      wrapper.style.display = 'block';
      wrapper.style.background = '#fff';
      wrapper.style.borderRadius = '6px';
      wrapper.style.padding = '6px';
      wrapper.style.border = '1px solid var(--border)';
      wrapper.style.marginBottom = '6px';
      wrapper.innerHTML = `
        <div style="display:flex; align-items:center; gap:8px;">
          <img src="${p.image}" alt="${p.name}" class="cart-thumb" style="width:40px; height:40px; object-fit:cover; border-radius:6px;">
          <div style="flex:1;">
            <div style="font-size:13px; font-weight:600;">${p.name}</div>
            <div style="font-size:12px; color:var(--muted);">${p.category} â€¢ ${currency(p.price)}</div>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:700; font-size:14px;">${currency(p.price * ci.qty)}</div>
            <div class="cart-qty" aria-label="Quantity" role="group" data-id="${p.id}" style="margin-top:6px;">
              <button class="dec" aria-label="Decrease">-</button>
              <input type="text" value="${ci.qty}" disabled style="width:30px; text-align:center; border:none; outline:none;" />
              <button class="inc" aria-label="Increase">+</button>
            </div>
          </div>
        </div>
      `;
      // bind qty controls
      const dec = wrapper.querySelector('.dec');
      const inc = wrapper.querySelector('.inc');
      dec.addEventListener('click', () => updateCartItem(p.id, ci.qty - 1));
      inc.addEventListener('click', () => updateCartItem(p.id, ci.qty + 1));

      // remove on long press or small trash
      const removeBtn = document.createElement('button');
      removeBtn.textContent = 'Remove';
      removeBtn.className = 'btn ghost';
      removeBtn.style.marginTop = '6px';
      removeBtn.style.fontSize = '12px';
      removeBtn.style.padding = '6px 8px';
      removeBtn.addEventListener('click', () => removeFromCart(p.id));
      wrapper.appendChild(removeBtn);

      return wrapper;
    }

    // Modal helpers
    const modal = document.getElementById('productModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalPrice = document.getElementById('modalPrice');
    const modalStock = document.getElementById('modalStock');
    const modalRating = document.getElementById('modalRating');
    const modalAddToCart = document.getElementById('modalAddToCart');
    const modalShopNow = document.getElementById('modalShopNow');
    const modalClose = document.getElementById('modalClose');
    let currentModalId = null;

    function openProductModal(productId){
      const p = products.find(x => x.id === productId);
      if(!p) return;
      currentModalId = productId;
      modalImage.src = p.image;
      modalImage.alt = p.name;
      modalTitle.textContent = p.name;
      modalDesc.textContent = p.description;
      modalPrice.textContent = currency(p.price);
      modalStock.textContent = p.stock > 0 ? 'In stock' : 'Out of stock';
      modalStock.className = 'stock ' + (p.stock > 0 ? 'in' : 'out');
      modalRating.innerHTML = 'Rating: ' + 'â˜…'.repeat(Math.floor(p.rating)) + (p.rating % 1 >= 0.5 ? 'Â½' : '');
      modalAddToCart.disabled = p.stock <= 0;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      // focus trap
      setTimeout(() => modal.querySelector('.btn').focus(), 50);
    }

    modalClose.addEventListener('click', () => closeProductModal());
    modalShopNow.addEventListener('click', () => {
      closeProductModal();
      // go to cart (open)
      openCart();
    });
    modalAddToCart.addEventListener('click', () => {
      if(currentModalId){
        const p = products.find(x => x.id === currentModalId);
        if(p && p.stock>0){
          addToCart(p.id, 1);
        }
      }
    });
    function closeProductModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      currentModalId = null;
    }

    // Cart drawer controls
    function openCart(){
      cartDrawer.classList.add('open');
      cartDrawer.setAttribute('aria-hidden','false');
      renderCart();
      // focus on first interactive element
      setTimeout(()=> document.getElementById('closeCart').focus(), 50);
    }
    function closeCart(){
      cartDrawer.classList.remove('open');
      cartDrawer.setAttribute('aria-hidden','true');
    }

    openCartBtn.addEventListener('click', openCart);
    closeCartBtn.addEventListener('click', closeCart);
    continueBtn.addEventListener('click', closeCart);
    cartDrawer.addEventListener('keydown', (e) => {
      if(e.key === 'Escape') closeCart();
    });

    // Checkout flow
    const checkoutScreen = document.getElementById('checkoutScreen');
    const orderSummary = document.getElementById('orderSummary');
    const shopAgain = document.getElementById('shopAgain');
    checkoutBtn.addEventListener('click', () => {
      if(cart.length === 0) return;
      // simulate checkout: generate order id
      const orderId = 'ORD-' + Math.floor(Math.random()*900000 + 100000);
      orderSummary.textContent = `Your order ${orderId} has been placed successfully. A confirmation email will be sent.`;
      checkoutScreen.style.pointerEvents = 'auto';
      checkoutScreen.style.display = 'flex';
      checkoutScreen.classList.add('open');
      checkoutScreen.setAttribute('aria-hidden','false');
      // clear cart after slight delay
      setTimeout(() => {
        clearCart();
      }, 400);
    });
    shopAgain.addEventListener('click', () => {
      checkoutScreen.style.display = 'none';
      checkoutScreen.setAttribute('aria-hidden','true');
      checkoutScreen.classList.remove('open');
    });
    // allow pressing Shop Again after checkout
    shopAgain.addEventListener('focus', ()=> {});

    // Initialize
    function updateCartUI(){
      renderCart();
      // Update count badge in header
      cartCountEl.textContent = String(cart.reduce((a,b)=>a+b.qty, 0));
    }

    // Live filter triggers
    function bindFilters(){
      searchEl.addEventListener('input', renderCatalog);
      categoryEl.addEventListener('change', renderCatalog);
      minPriceEl.addEventListener('change', renderCatalog);
      maxPriceEl.addEventListener('change', renderCatalog);
      ratingEl.addEventListener('change', renderCatalog);
      sortEl.addEventListener('change', renderCatalog);
      // Enter on catalog card title opens details
      catalogEl.addEventListener('click', (e) => {
        const id = e.target.closest('[data-id]');
        if(id){
          const pid = id.getAttribute('data-id');
          openProductModal(pid);
        }
      });
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape'){
        if(modal.classList.contains('open')) closeProductModal();
        if(cartDrawer.classList.contains('open')) closeCart();
        if(checkoutScreen.style.display === 'flex') {
          checkoutScreen.style.display = 'none';
          checkoutScreen.setAttribute('aria-hidden','true');
          checkoutScreen.classList.remove('open');
        }
      }
    });

    // Init
    function init(){
      initProducts();
      // initialize catalog data with images
      renderCatalog();
      loadCart();
      bindFilters();
    }

    // Start
    init();

  </script>
</body>
</html>