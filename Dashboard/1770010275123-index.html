<!DOCTYPE html>
<html lang="en" data-theme="light"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nexus Agency | Design &amp; Development Management</title>
  <style>
    :root {
      /* Design Tokens - Light Theme */
      --bg: #f8fafc;
      --bg-2: #f1f5f9;
      --surface: #ffffff;
      --surface-2: #f8fafc;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --primary: #2563eb;
      --primary-2: #1d4ed8;
      --on-primary: #ffffff;
      --accent: #0ea5e9;
      --on-accent: #ffffff;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --focus: #3b82f6;
      --shadow-soft: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
      
      --radius-btn: 3px;
      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 1rem;
      --space-4: 1.5rem;
      --space-5: 2rem;
      --space-6: 3rem;

      --font-size-1: 0.75rem;
      --font-size-2: 0.875rem;
      --font-size-3: 1rem;
      --font-size-4: 1.25rem;
      --font-size-5: 1.5rem;
      --font-size-6: 2rem;
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --bg-2: #1e293b;
      --surface: #1e293b;
      --surface-2: #334155;
      --text: #f8fafc;
      --muted: #94a3b8;
      --border: #334155;
      --primary: #3b82f6;
      --primary-2: #60a5fa;
      --on-primary: #ffffff;
      --accent: #38bdf8;
      --on-accent: #0f172a;
      --success: #34d399;
      --warning: #fbbf24;
      --danger: #f87171;
      --focus: #60a5fa;
      --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.5;
      transition: background-color 0.2s, color 0.2s;
      -webkit-font-smoothing: antialiased;
    }

    /* Layout */
    .app-container {
      max-width: 1140px;
      margin: 0 auto;
      padding: 0 var(--space-4);
    }

    header {
      background-color: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-inner {
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-weight: 700;
      font-size: var(--font-size-4);
      color: var(--primary);
      text-decoration: none;
    }

    nav {
      display: flex;
      gap: var(--space-4);
    }

    nav a {
      text-decoration: none;
      color: var(--muted);
      font-size: var(--font-size-2);
      font-weight: 500;
      padding: var(--space-2) 0;
      border-bottom: 2px solid transparent;
      transition: color 0.2s, border-color 0.2s;
    }

    nav a:hover, nav a.active {
      color: var(--primary);
    }

    nav a.active {
      border-color: var(--primary);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    /* Components */
    button {
      cursor: pointer;
      font-family: inherit;
      font-size: var(--font-size-2);
      font-weight: 600;
      padding: 0 var(--space-3);
      height: 40px;
      border: 1px solid transparent;
      border-radius: var(--radius-btn);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      transition: all 0.2s;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--on-primary);
    }

    .btn-primary:hover {
      background-color: var(--primary-2);
    }

    .btn-outline {
      background-color: transparent;
      border-color: var(--border);
      color: var(--text);
    }

    .btn-outline:hover {
      background-color: var(--bg-2);
      border-color: var(--muted);
    }

    .btn-ghost {
      background-color: transparent;
      color: var(--muted);
      border: none;
    }

    .btn-ghost:hover {
      background-color: var(--bg-2);
      color: var(--text);
    }

    .btn-sm {
      height: 32px;
      padding: 0 var(--space-2);
      font-size: var(--font-size-1);
    }

    input, select, textarea {
      width: 100%;
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--border);
      border-radius: var(--radius-btn);
      background-color: var(--surface);
      color: var(--text);
      font-family: inherit;
      font-size: var(--font-size-2);
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--focus);
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    .badge-design { background: rgba(14, 165, 233, 0.1); color: #0284c7; }
    .badge-dev { background: rgba(37, 99, 235, 0.1); color: #2563eb; }
    .badge-qa { background: rgba(168, 85, 247, 0.1); color: #9333ea; }
    .badge-high { background: rgba(239, 68, 68, 0.1); color: #dc2626; }
    .badge-med { background: rgba(245, 158, 11, 0.1); color: #d97706; }
    .badge-low { background: rgba(16, 185, 129, 0.1); color: #059669; }

    /* Main Area */
    main {
      padding: var(--space-5) 0;
    }

    .view-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: var(--space-5);
    }

    .view-title h1 {
      font-size: var(--font-size-5);
      font-weight: 800;
      margin-bottom: var(--space-1);
    }

    .view-title p {
      color: var(--muted);
      font-size: var(--font-size-2);
    }

    /* Grid Layouts */
    .project-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: var(--space-4);
    }

    .card {
      background-color: var(--surface);
      border: 1px solid var(--border);
      padding: var(--space-4);
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      box-shadow: var(--shadow-soft);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .card-client {
      font-size: var(--font-size-1);
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
    }

    .card-title {
      font-size: var(--font-size-3);
      font-weight: 700;
      margin-top: 2px;
    }

    .card-footer {
      margin-top: auto;
      padding-top: var(--space-3);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Kanban Board */
    .kanban-container {
      display: flex;
      gap: var(--space-4);
      overflow-x: auto;
      padding-bottom: var(--space-4);
      min-height: 600px;
    }

    .kanban-column {
      flex: 0 0 300px;
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }

    .column-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--space-1);
    }

    .column-title {
      font-size: var(--font-size-2);
      font-weight: 700;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .task-card {
      background-color: var(--surface);
      border: 1px solid var(--border);
      padding: var(--space-3);
      cursor: grab;
    }

    .task-card:active { cursor: grabbing; }

    .task-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--space-3);
    }

    .avatar-group {
      display: flex;
      margin-left: 4px;
    }

    .avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-color: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      border: 2px solid var(--surface);
      margin-left: -8px;
    }

    /* Workload */
    .workload-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: var(--space-4);
    }

    .workload-card {
      background-color: var(--surface);
      border: 1px solid var(--border);
      padding: var(--space-4);
      text-align: center;
    }

    .workload-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      margin: 0 auto var(--space-3);
      background-color: var(--bg-2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-4);
      color: var(--primary);
      border: 2px solid var(--border);
    }

    .stat-row {
      display: flex;
      justify-content: space-around;
      margin-top: var(--space-4);
      padding-top: var(--space-3);
      border-top: 1px solid var(--border);
    }

    .stat-item {
      display: flex;
      flex-direction: column;
    }

    .stat-val { font-weight: 700; font-size: var(--font-size-3); }
    .stat-label { font-size: var(--font-size-1); color: var(--muted); }

    /* Modals & Toasts */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(2px);
    }

    .modal {
      background: var(--surface);
      width: 100%;
      max-width: 500px;
      padding: var(--space-5);
      border-radius: 0;
      position: relative;
    }

    .toast-container {
      position: fixed;
      bottom: var(--space-4);
      right: var(--space-4);
      z-index: 1100;
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .toast {
      background: var(--surface);
      border-left: 4px solid var(--primary);
      padding: var(--space-3) var(--space-4);
      box-shadow: var(--shadow-soft);
      display: flex;
      align-items: center;
      gap: var(--space-3);
      min-width: 280px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Utilities */
    .hidden { display: none !important; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: var(--space-2); }
    .mt-4 { margin-top: var(--space-4); }
    .text-muted { color: var(--muted); }
    .text-sm { font-size: var(--font-size-2); }

    /* Login View */
    .login-wrapper {
      max-width: 400px;
      margin: 100px auto;
      background: var(--surface);
      padding: var(--space-5);
      border: 1px solid var(--border);
    }

    .login-header {
      text-align: center;
      margin-bottom: var(--space-4);
    }

    .login-header h2 { font-size: var(--font-size-5); margin-bottom: var(--space-2); }

    /* Timeline */
    .timeline-grid {
      background: var(--surface);
      border: 1px solid var(--border);
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .timeline-day {
      border: 1px solid var(--border);
      min-height: 120px;
      padding: var(--space-2);
    }

    .day-num { font-weight: 700; color: var(--muted); margin-bottom: var(--space-2); }
    .day-task {
      font-size: 10px;
      background: var(--primary);
      color: white;
      padding: 2px 4px;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .header-inner { flex-direction: column; height: auto; padding: var(--space-3) 0; gap: var(--space-3); }
      nav { overflow-x: auto; width: 100%; padding-bottom: var(--space-2); }
      .project-grid { grid-template-columns: 1fr; }
      .view-header { flex-direction: column; align-items: flex-start; gap: var(--space-3); }
    }
  </style>
</head>
<body>

  <div id="auth-view" class="">
    <div class="login-wrapper">
      <div class="login-header">
        <div class="brand" style="justify-content: center; margin-bottom: var(--space-3);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
          Nexus Agency
        </div>
        <h2>Sign In</h2>
        <p class="text-muted">Access your team workspace</p>
      </div>
      <div style="display: flex; flex-direction: column; gap: var(--space-3);">
        <div>
          <label class="text-sm" style="display:block; margin-bottom:4px">Select Persona</label>
          <select id="login-role">
            <option value="pm">Sarah Jenkins (Project Manager)</option>
            <option value="dev">Mike Chen (Senior Developer)</option>
            <option value="designer">Elena Rossi (UI/UX Designer)</option>
            <option value="admin">Alex Rivera (System Admin)</option>
          </select>
        </div>
        <button class="btn-primary" onclick="handleLogin()" style="width: 100%;">Enter Workspace</button>
      </div>
    </div>
  </div>

  <div id="app-view" class="hidden">
    <header>
      <div class="app-container header-inner">
        <a href="#" class="brand" onclick="navigate('projects')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
          Nexus
        </a>
        <nav>
          <a href="#" id="nav-projects" class="active" onclick="navigate('projects')">Projects</a>
          <a href="#" id="nav-tasks" onclick="navigate('tasks')">Tasks</a>
          <a href="#" id="nav-team" onclick="navigate('team')">Team</a>
          <a href="#" id="nav-timeline" onclick="navigate('timeline')">Timeline</a>
        </nav>
        <div class="header-actions">
          <button class="btn-ghost" onclick="toggleTheme()" aria-label="Toggle Theme" id="theme-toggle">
            <svg id="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            <svg id="moon-icon" class="hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
          </button>
          <div class="items-center flex gap-2" style="border-left: 1px solid var(--border); padding-left: var(--space-3);">
            <div id="user-avatar" class="avatar" style="margin:0; width:32px; height:32px;">SJ</div>
            <button class="btn-ghost btn-sm" onclick="handleLogout()">Sign Out</button>
          </div>
        </div>
      </div>
    </header>

    <main class="app-container">
      <!-- Projects View -->
      <section id="view-projects">
        <div class="view-header">
          <div class="view-title">
            <h1>Active Projects</h1>
            <p>Managing 12 client engagements across design and engineering.</p>
          </div>
          <button class="btn-primary" id="btn-new-project" onclick="showModal('project')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            New Project
          </button>
        </div>
        <div class="project-grid" id="project-list">
          <!-- Projects injected here -->
        </div>
      </section>

      <!-- Tasks View -->
      <section id="view-tasks" class="hidden">
        <div class="view-header">
          <div class="view-title">
            <h1 id="task-view-title">All Tasks</h1>
            <p>Track progress and manage deliverables.</p>
          </div>
          <div class="flex gap-2">
            <select id="task-filter-project" style="width: 180px;" onchange="renderTasks()">
              <option value="all">All Projects</option>
            </select>
            <button class="btn-primary" onclick="showModal('task')">Add Task</button>
          </div>
        </div>
        
        <div class="kanban-container" id="kanban-board">
          <!-- Columns: Backlog, In Progress, In Review, Done -->
          <div class="kanban-column" id="col-backlog">
            <div class="column-header">
              <span class="column-title">Backlog <span class="badge badge-low" id="count-backlog">0</span></span>
            </div>
            <div class="column-list" id="list-backlog"></div>
          </div>
          <div class="kanban-column" id="col-progress">
            <div class="column-header">
              <span class="column-title">In Progress <span class="badge badge-med" id="count-progress">0</span></span>
            </div>
            <div class="column-list" id="list-progress"></div>
          </div>
          <div class="kanban-column" id="col-review">
            <div class="column-header">
              <span class="column-title">In Review <span class="badge badge-high" id="count-review">0</span></span>
            </div>
            <div class="column-list" id="list-review"></div>
          </div>
          <div class="kanban-column" id="col-done">
            <div class="column-header">
              <span class="column-title">Done <span class="badge badge-low" style="background:rgba(16,185,129,0.1); color:#059669" id="count-done">0</span></span>
            </div>
            <div class="column-list" id="list-done"></div>
          </div>
        </div>
      </section>

      <!-- Team View -->
      <section id="view-team" class="hidden">
        <div class="view-header">
          <div class="view-title">
            <h1>Team Workload</h1>
            <p>Current capacity and task distribution across the agency.</p>
          </div>
        </div>
        <div class="workload-grid" id="team-list">
          <!-- Team injected here -->
        </div>
      </section>

      <!-- Timeline View -->
      <section id="view-timeline" class="hidden">
        <div class="view-header">
          <div class="view-title">
            <h1>Delivery Timeline</h1>
            <p>Upcoming milestones and task deadlines for October 2023.</p>
          </div>
        </div>
        <div class="timeline-grid" id="timeline-calendar">
          <!-- Calendar injected here -->
        </div>
      </section>
    </main>
  </div>

  <!-- Modals -->
  <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
    <div class="modal" id="modal-content" onclick="event.stopPropagation()">
      <h2 id="modal-title" style="margin-bottom: var(--space-4);">Create New Task</h2>
      <div id="modal-body" style="display: flex; flex-direction: column; gap: var(--space-3);">
        <!-- Dynamic form content -->
      </div>
      <div class="flex justify-between mt-4" style="border-top: 1px solid var(--border); padding-top: var(--space-4);">
        <button class="btn-outline" onclick="closeModal()">Cancel</button>
        <button class="btn-primary" id="modal-submit">Save Changes</button>
      </div>
    </div>
  </div>

  <div class="toast-container" id="toast-container"></div>

  <script>
    // --- Data Model ---
    const state = {
      currentUser: null,
      currentView: 'projects',
      theme: localStorage.getItem('theme') || 'light',
      projects: [
        { id: 'p1', name: 'Solaris Mobile App', client: 'Solaris Energy', status: 'Active', members: 4, priority: 'High', tags: ['Mobile', 'UI/UX'] },
        { id: 'p2', name: 'Vertex Fintech Rebrand', client: 'Vertex Capital', status: 'In Review', members: 3, priority: 'Medium', tags: ['Branding', 'Web'] },
        { id: 'p3', name: 'E-Commerce Migration', client: 'Luxe Retail', status: 'Active', members: 6, priority: 'High', tags: ['Backend', 'Shopify'] },
        { id: 'p4', name: 'Internal Design System', client: 'Nexus Agency', status: 'Planning', members: 2, priority: 'Low', tags: ['Design Ops'] }
      ],
      tasks: [
        { id: 't1', projectId: 'p1', title: 'High-fidelity wireframes', assignee: 'Elena Rossi', role: 'Design', status: 'progress', priority: 'High', due: '2023-10-24' },
        { id: 't2', projectId: 'p1', title: 'Stripe API Integration', assignee: 'Mike Chen', role: 'Dev', status: 'backlog', priority: 'High', due: '2023-10-28' },
        { id: 't3', projectId: 'p2', title: 'Logo exploration v2', assignee: 'Elena Rossi', role: 'Design', status: 'review', priority: 'Medium', due: '2023-10-22' },
        { id: 't4', projectId: 'p3', title: 'Product schema mapping', assignee: 'Mike Chen', role: 'Dev', status: 'done', priority: 'Medium', due: '2023-10-15' },
        { id: 't5', projectId: 'p1', title: 'User interview synthesis', assignee: 'Sarah Jenkins', role: 'PM', status: 'done', priority: 'Low', due: '2023-10-10' },
        { id: 't6', projectId: 'p3', title: 'Checkout flow QA', assignee: 'Alex Rivera', role: 'QA', status: 'backlog', priority: 'High', due: '2023-10-30' }
      ],
      users: [
        { id: 'u1', name: 'Sarah Jenkins', role: 'pm', initial: 'SJ', tasks: 2, hours: 12 },
        { id: 'u2', name: 'Mike Chen', role: 'dev', initial: 'MC', tasks: 5, hours: 34 },
        { id: 'u3', name: 'Elena Rossi', role: 'designer', initial: 'ER', tasks: 3, hours: 20 },
        { id: 'u4', name: 'Alex Rivera', role: 'admin', initial: 'AR', tasks: 1, hours: 4 }
      ]
    };

    // --- Core Logic ---
    function init() {
      applyTheme();
      const savedUser = localStorage.getItem('nexus_user');
      if (savedUser) {
        state.currentUser = JSON.parse(savedUser);
        renderApp();
      } else {
        showAuth();
      }
    }

    function showAuth() {
      document.getElementById('auth-view').classList.remove('hidden');
      document.getElementById('app-view').classList.add('hidden');
    }

    function handleLogin() {
      const roleVal = document.getElementById('login-role').value;
      const user = state.users.find(u => u.role === roleVal);
      state.currentUser = user;
      localStorage.setItem('nexus_user', JSON.stringify(user));
      
      showToast(`Welcome back, ${user.name}!`, 'success');
      document.getElementById('auth-view').classList.add('hidden');
      document.getElementById('app-view').classList.remove('hidden');
      
      renderApp();
    }

    function handleLogout() {
      state.currentUser = null;
      localStorage.removeItem('nexus_user');
      showAuth();
    }

    function navigate(view) {
      state.currentView = view;
      renderApp();
    }

    function toggleTheme() {
      state.theme = state.theme === 'light' ? 'dark' : 'light';
      localStorage.setItem('theme', state.theme);
      applyTheme();
    }

    function applyTheme() {
      document.documentElement.setAttribute('data-theme', state.theme);
      const sun = document.getElementById('sun-icon');
      const moon = document.getElementById('moon-icon');
      if (state.theme === 'dark') {
        sun.classList.add('hidden');
        moon.classList.remove('hidden');
      } else {
        sun.classList.remove('hidden');
        moon.classList.add('hidden');
      }
    }

    // --- Rendering ---
    function renderApp() {
      // Update Nav
      document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
      document.getElementById(`nav-${state.currentView}`).classList.add('active');

      // Update User Info
      document.getElementById('user-avatar').innerText = state.currentUser.initial;
      
      // Permissions
      const canCreate = ['pm', 'admin'].includes(state.currentUser.role);
      document.getElementById('btn-new-project').style.display = canCreate ? 'inline-flex' : 'none';

      // Hide all views
      ['projects', 'tasks', 'team', 'timeline'].forEach(v => {
        document.getElementById(`view-${v}`).classList.add('hidden');
      });
      document.getElementById(`view-${state.currentView}`).classList.remove('hidden');

      if (state.currentView === 'projects') renderProjects();
      if (state.currentView === 'tasks') renderTasks();
      if (state.currentView === 'team') renderTeam();
      if (state.currentView === 'timeline') renderTimeline();
    }

    function renderProjects() {
      const container = document.getElementById('project-list');
      container.innerHTML = state.projects.map(p => `
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-client">${p.client}</div>
              <div class="card-title">${p.name}</div>
            </div>
            <span class="badge ${p.priority === 'High' ? 'badge-high' : 'badge-med'}">${p.priority}</span>
          </div>
          <div class="flex gap-2">
            ${p.tags.map(t => `<span class="badge badge-low" style="background:var(--bg-2); color:var(--muted)">${t}</span>`).join('')}
          </div>
          <div class="card-footer">
            <div class="avatar-group">
              ${Array(p.members).fill(0).map((_, i) => `<div class="avatar" style="background:hsl(${i * 40}, 60%, 50%)">${String.fromCharCode(65 + i)}</div>`).join('')}
            </div>
            <button class="btn-outline btn-sm" onclick="viewProjectTasks('${p.id}')">View Tasks</button>
          </div>
        </div>
      `).join('');
    }

    function viewProjectTasks(pid) {
      state.currentView = 'tasks';
      renderApp();
      document.getElementById('task-filter-project').value = pid;
      renderTasks();
    }

    function renderTasks() {
      const pid = document.getElementById('task-filter-project').value;
      const filterSelect = document.getElementById('task-filter-project');
      
      // Populate project filter if empty
      if (filterSelect.options.length === 1) {
        state.projects.forEach(p => {
          const opt = document.createElement('option');
          opt.value = p.id;
          opt.textContent = p.name;
          filterSelect.appendChild(opt);
        });
      }

      const filtered = pid === 'all' ? state.tasks : state.tasks.filter(t => t.projectId === pid);
      
      const columns = ['backlog', 'progress', 'review', 'done'];
      columns.forEach(col => {
        const list = document.getElementById(`list-${col}`);
        const count = document.getElementById(`count-${col}`);
        const tasks = filtered.filter(t => t.status === col);
        
        count.innerText = tasks.length;
        list.innerHTML = tasks.map(t => `
          <div class="task-card mt-4" draggable="true">
            <div class="text-sm" style="font-weight:700; margin-bottom:4px;">${t.title}</div>
            <div class="flex items-center justify-between">
              <span class="badge badge-${t.role.toLowerCase()}">${t.role}</span>
              <span class="text-muted" style="font-size:10px">${t.due}</span>
            </div>
            <div class="task-meta">
              <div class="avatar" style="margin:0">${t.assignee.split(' ').map(n => n[0]).join('')}</div>
              <button class="btn-ghost btn-sm" onclick="showToast('Task details coming soon', 'info')">Edit</button>
            </div>
          </div>
        `).join('');
      });
    }

    function renderTeam() {
      const container = document.getElementById('team-list');
      container.innerHTML = state.users.map(u => `
        <div class="workload-card">
          <div class="workload-avatar">${u.initial}</div>
          <div style="font-weight:700">${u.name}</div>
          <div class="text-muted text-sm">${u.role.toUpperCase()}</div>
          <div class="stat-row">
            <div class="stat-item">
              <span class="stat-val">${u.tasks}</span>
              <span class="stat-label">Tasks</span>
            </div>
            <div class="stat-item">
              <span class="stat-val">${u.hours}h</span>
              <span class="stat-label">Cap.</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderTimeline() {
      const container = document.getElementById('timeline-calendar');
      container.innerHTML = '';
      
      // Simple October 2023 grid (starts on Sunday)
      for (let i = 1; i <= 31; i++) {
        const dateStr = `2023-10-${i.toString().padStart(2, '0')}`;
        const dayTasks = state.tasks.filter(t => t.due === dateStr);
        
        const dayEl = document.createElement('div');
        dayEl.className = 'timeline-day';
        dayEl.innerHTML = `
          <div class="day-num">${i}</div>
          ${dayTasks.map(t => `<div class="day-task">${t.title}</div>`).join('')}
        `;
        container.appendChild(dayEl);
      }
    }

    // --- UI Interactions ---
    function showModal(type) {
      const overlay = document.getElementById('modal-overlay');
      const title = document.getElementById('modal-title');
      const body = document.getElementById('modal-body');
      const submit = document.getElementById('modal-submit');

      overlay.style.display = 'flex';

      if (type === 'task') {
        title.innerText = 'Create New Task';
        body.innerHTML = `
          <div>
            <label class="text-sm">Task Title</label>
            <input type="text" placeholder="e.g. Finalize design system">
          </div>
          <div class="flex gap-2">
            <div style="flex:1">
              <label class="text-sm">Project</label>
              <select>${state.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}</select>
            </div>
            <div style="flex:1">
              <label class="text-sm">Assignee</label>
              <select>${state.users.map(u => `<option value="${u.id}">${u.name}</option>`).join('')}</select>
            </div>
          </div>
          <div>
            <label class="text-sm">Due Date</label>
            <input type="date" value="2023-10-31">
          </div>
        `;
        submit.onclick = () => {
          showToast('Task created successfully', 'success');
          closeModal();
        };
      } else {
        title.innerText = 'New Project';
        body.innerHTML = `
          <div>
            <label class="text-sm">Project Name</label>
            <input type="text" placeholder="Client - Project Name">
          </div>
          <div>
            <label class="text-sm">Client</label>
            <input type="text" placeholder="Company Name">
          </div>
          <div>
            <label class="text-sm">Priority</label>
            <select><option>Low</option><option>Medium</option><option>High</option></select>
          </div>
        `;
        submit.onclick = () => {
          showToast('Project initialized', 'success');
          closeModal();
        };
      }
    }

    function closeModal(e) {
      document.getElementById('modal-overlay').style.display = 'none';
    }

    function showToast(msg, type = 'primary') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast';
      if (type === 'success') toast.style.borderLeftColor = 'var(--success)';
      if (type === 'info') toast.style.borderLeftColor = 'var(--accent)';
      
      toast.innerHTML = `
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <span class="text-sm" style="font-weight:600">${msg}</span>
      `;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(20px)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Initialize the app
    init();
  </script>

</body></html>