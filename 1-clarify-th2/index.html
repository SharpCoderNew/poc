<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catalog Cart SPA</title>
  <style>
    /* Color tokens derived from the provided palette (example tokens for accessibility) */
    :root {
      /* Brand / primary accents (must be used consistently) */
      --brand-900: #0b1e3a;
      --brand-800: #12315e;
      --brand-700: #2148a3;
      --brand-600: #2b6bd4;
      --brand-500: #4a90e2;

      /* neutrals and surfaces */
      --bg: #f7f7fb;
      --surface: #ffffff;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 6px 18px rgba(0,0,0,.08);

      /* accent and status */
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;

      /* UI helpers */
      --focus: #2563eb;
      --chip: #eef2ff;
    }

    /* Global reset-ish */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color: var(--text);
      background: var(--bg);
    }

    /* Layout components */
    header {
      position: sticky; top: 0; z-index: 50;
      background: #fff;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 2px 6px rgba(0,0,0,.04);
    }
    .header-inner {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 12px;
      align-items: center;
      padding: 14px 20px;
      max-width: 1100px; margin: 0 auto;
    }
    .brand {
      display: flex; align-items: center; gap: 12px;
    }
    .brand-logo {
      width: 34px; height: 34px; border-radius: 8px;
      background: linear-gradient(135deg, var(--brand-600), var(--brand-500));
      display: inline-block;
    }
    .brand-name { font-weight: 700; font-size: 1.05rem; }
    .searchbar {
      display: flex; justify-content: center;
    }
    .searchbar input {
      width: 100%; max-width: 520px; padding: 10px 12px;
      border: 1px solid var(--border); border-radius: 999px;
      background: #fff;
      outline: none;
    }
    .searchbar input:focus { border-color: var(--brand-700); box-shadow: 0 0 0 3px rgba(33,72,163,.15); }

    .cart-trigger {
      justify-self: end; display: flex; justify-content: flex-end; gap: 8px;
    }
    .btn {
      border: none; border-radius: 999px; padding: 10px 14px;
      background: var(--brand-500); color: #fff; cursor: pointer;
      font-weight: 600;
      transition: transform .05s ease-in-out;
    }
    .btn.secondary {
      background: #fff; color: var(--brand-700); border: 1px solid var(--border);
    }
    .btn:focus { outline: 2px solid var(--focus); outline-offset: 2px; }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    main.content {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 20px;
      max-width: 1100px; margin: 20px auto; padding: 0 16px;
    }

    /* Catalog */
    .filters {
      display: flex; flex-wrap: wrap; gap: 8px; align-items: center;
      padding: 6px 0 12px;
    }
    .chip {
      padding: 6px 12px; border-radius: 999px; background: var(--chip);
      border: 1px solid var(--border); font-size: 0.9rem; color: var(--text);
      cursor: pointer;
    }
    .chip.active { background: var(--brand-700); color: #fff; border-color: transparent; }

    .sort-select {
      margin-left: auto;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      gap: 14px;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      display: flex; flex-direction: column;
      min-height: 280px;
      box-shadow: var(--shadow);
    }
    .card-media {
      height: 140px; display: flex; align-items: center; justify-content: center;
      background: #f6f7fb;
    }
    .card-media img { width: 100%; height: 100%; object-fit: cover; }
    .card-body { padding: 12px; display: flex; flex-direction: column; gap: 6px; flex: 1; }
    .card-title { font-weight: 700; font-size: 1rem; color: var(--text); }
    .card-desc { font-size: 0.85rem; color: var(--muted); height: 38px; overflow: hidden; }
    .price-row { display: flex; justify-content: space-between; align-items: center; }
    .rating { font-size: 0.85rem; color: #f59e0b; }

    .stock { font-size: 0.75rem; padding: 2px 6px; border-radius: 999px; background: #eafaf1; color: #0f9d58; border: 1px solid #c6f3d2; }

    .card-actions { margin-top: auto; display: flex; gap: 8px; padding: 8px 12px 12px; }

    /* Cart panel (right drawer-like) */
    .cart-panel {
      position: sticky; top: 70px; height: calc(100vh - 90px);
      border: 1px solid var(--border); border-radius: 12px;
      padding: 12px; background: #fff;
      display: flex; flex-direction: column;
      min-height: 400px;
      box-shadow: var(--shadow);
    }
    .cart-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    .cart-items { flex: 1; overflow: auto; padding: 6px 0; display: flex; flex-direction: column; gap: 8px; }

    .cart-item { display: grid; grid-template-columns: 48px 1fr auto; gap: 8px; align-items: center; padding: 6px; border: 1px solid var(--border); border-radius: 8px; }
    .cart-thumb { width: 48px; height: 48px; border-radius: 6px; object-fit: cover; background: #f0f0f0; }
    .cart-name { font-size: 0.92rem; }
    .cart-qty { display: inline-flex; align-items: center; gap: 6px; }
    .qty-btn { width: 24px; height: 24px; border-radius: 6px; border: 1px solid var(--border); background: #fff; cursor: pointer; }
    .cart-total { font-weight: 700; padding-top: 8px; border-top: 1px solid var(--border); margin-top: 6px; }

    /* Checkout / modal-like overlay (simulated) */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,.4);
      display: none; align-items: center; justify-content: center; z-index: 100;
    }
    .modal {
      width: min(520px, 92vw);
      background: #fff; border-radius: 12px; padding: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 20px 40px rgba(0,0,0,.15);
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    .modal-body { padding: 8px 0; display: grid; gap: 8px; }
    .line { height: 1px; background: var(--border); margin: 6px 0; }

    /* Responsive tweaks */
    @media (max-width: 980px) {
      main.content { grid-template-columns: 1fr; padding: 0 12px; }
      .cart-panel { order: -1; height: auto; }
      .header-inner { grid-template-columns: 1fr auto; }
      .searchbar { display: none; }
    }
  </style>
</head>
<body>
  <header aria-label="Site header">
    <div class="header-inner">
      <div class="brand" aria-label="Brand">
        <span class="brand-logo" aria-label="Brand logo"></span>
        <span class="brand-name">SharpCart</span>
      </div>

      <div class="searchbar" aria-label="Site search">
        <input id="searchInput" type="search" placeholder="Search products..." aria-label="Search products" />
      </div>

      <div class="cart-trigger" role="group" aria-label="Cart and actions">
        <button id="openCartBtn" class="btn" title="Open cart" aria-label="Open cart">
          View Cart (<span id="cartCount">0</span>)
        </button>
      </div>
    </div>
  </header>

  <main class="content" aria-label="Product catalog and cart">
    <!-- Catalog -->
    <section aria-label="Product catalog" class="catalog">
      <div class="filters" id="filtersBar" aria-label="Filters and sorting">
        <span class="chip" data-cat="All" role="button" aria-label="All categories">All</span>
        <span class="chip" data-cat="Electronics" role="button" aria-label="Electronics category">Electronics</span>
        <span class="chip" data-cat="Apparel" role="button" aria-label="Apparel category">Apparel</span>
        <span class="chip" data-cat="Home" role="button" aria-label="Home category">Home</span>

        <span class="line" style="width:1px; height:20px; display:inline-block;"></span>

        <label for="sortSelect" class="sr-only" style="position:absolute;left:-9999px;">Sort</label>
        <select id="sortSelect" class="btn sort-select" aria-label="Sort products" style="padding:8px 12px;">
          <option value="popularity">Sort: Popular</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="rating">Rating</option>
          <option value="name">Name A-Z</option>
        </select>
      </div>

      <div id="product-grid" class="grid" aria-label="Product grid">
        <!-- Cards render here -->
      </div>
    </section>

    <!-- Cart (right panel) -->
    <aside class="cart-panel" aria-label="Shopping cart">
      <div class="cart-header">
        <strong>Your Cart</strong>
        <button id="clearCartBtn" class="btn secondary" aria-label="Clear cart" title="Clear cart" style="padding:6px 10px;">Clear</button>
      </div>

      <div class="cart-items" id="cartItems" aria-live="polite">
        <!-- Cart items render here -->
      </div>

      <div class="cart-total" id="cartTotals" aria-label="Cart totals">
        Subtotal: $0.00
        <div style="display:flex; justify-content: space-between; margin-top:6px;">
          <span>Tax (0%)</span><span>$0.00</span>
        </div>
        <div style="display:flex; justify-content: space-between; font-weight:700; margin-top:6px;">
          <span>Total</span><span id="cartGrandTotal">$0.00</span>
        </div>
      </div>

      <button id="checkoutBtn" class="btn" style="margin-top:8px;" aria-label="Proceed to checkout" disabled>Checkout</button>
    </aside>
  </main>

  <!-- Product detail modal -->
  <div id="productDetail" class="overlay" role="dialog" aria-modal="true" aria-label="Product detail modal" hidden>
    <div class="modal" role="document">
      <div class="modal-header">
        <strong id="detailTitle">Product Title</strong>
        <button class="btn secondary" id="closeDetail" aria-label="Close product details" style="padding:6px 10px;">Close</button>
      </div>
      <div class="modal-body" id="detailBody">
        <!-- details injected -->
      </div>
      <div class="line" aria-hidden="true"></div>
      <div style="display:flex; justify-content:flex-end; gap:8px;">
        <button class="btn secondary" id="detailAddToCart" aria-label="Add to cart from details" disabled>Add to Cart</button>
      </div>
    </div>
  </div>

  <!-- Checkout modal (simulated) -->
  <div id="checkoutModal" class="overlay" role="dialog" aria-modal="true" aria-label="Checkout" hidden>
    <div class="modal" role="document">
      <div class="modal-header">
        <strong>Checkout Summary</strong>
        <button class="btn secondary" id="closeCheckout" aria-label="Close checkout" style="padding:6px 10px;">Close</button>
      </div>
      <div class="modal-body" id="checkoutBody">
        <!-- summary injected -->
      </div>
      <div class="line" aria-hidden="true"></div>
      <div style="display:flex; justify-content:flex-end; gap:8px;">
        <button class="btn" id="confirmCheckout" aria-label="Confirm checkout">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    // Data models
    const currency = "USD";
    const products = [
      {
        id: "p1",
        name: "Aurora Wireless Headphones",
        description: "Immersive sound with long-lasting battery and wireless comfort.",
        price: 149.99,
        category: "Electronics",
        rating: 4.6,
        stock: 12,
        color: "Midnight",
        image: generateSVG("Aurora Headphones", "#4f9bd1")
      },
      {
        id: "p2",
        name: "Nimbus Hoodie",
        description: "Cozy fleece-lined hoodie with breathable fabric.",
        price: 59.99,
        category: "Apparel",
        rating: 4.4,
        stock: 25,
        color: "Storm",
        image: generateSVG("Nimbus Hoodie", "#7c3aed")
      },
      {
        id: "p3",
        name: "Luma Desk Lamp",
        description: "LED desk lamp with adjustable temperature and brightness.",
        price: 39.99,
        category: "Home",
        rating: 4.3,
        stock: 0,
        color: "Glow",
        image: generateSVG("Luma Lamp", "#f59e0b")
      },
      {
        id: "p4",
        name: "Pulse Fitness Band",
        description: "Track steps, heart rate, and calories with a sleek band.",
        price: 79.99,
        category: "Electronics",
        rating: 4.2,
        stock: 8,
        color: "Slate",
        image: generateSVG("Pulse Band", "#10b981")
      },
      {
        id: "p5",
        name: "Ceramic Pour-over Kit",
        description: "Beautiful ceramic set for your morning coffee ritual.",
        price: 24.99,
        category: "Home",
        rating: 4.5,
        stock: 16,
        color: "Cream",
        image: generateSVG("Pour-over Kit", "#e11d48")
      },
      {
        id: "p6",
        name: "Acoustic Studio Headset",
        description: "Studio-grade headphones for precise listening.",
        price: 119.0,
        category: "Electronics",
        rating: 4.7,
        stock: 4,
        color: "Pearl",
        image: generateSVG("Studio Headset", "#3b82f6")
      }
    ];

    // State
    let cart = [];
    let activeCategory = "All";
    let searchQuery = "";
    let sortKey = "popularity";

    // DOM references
    const productGrid = document.getElementById("product-grid");
    const searchInput = document.getElementById("searchInput");
    const filtersBar = document.getElementById("filtersBar");
    const cartPanelBtn = document.getElementById("openCartBtn");
    const cartCountEl = document.getElementById("cartCount");
    const cartItemsEl = document.getElementById("cartItems");
    const cartTotalsEl = document.getElementById("cartTotals");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const clearCartBtn = document.getElementById("clearCartBtn");

    // Detail modal elements
    const productDetailModal = document.getElementById("productDetail");
    const detailTitle = document.getElementById("detailTitle");
    const detailBody = document.getElementById("detailBody");
    const closeDetailBtn = document.getElementById("closeDetail");
    const detailAddToCart = document.getElementById("detailAddToCart");

    // Checkout modal
    const checkoutModal = document.getElementById("checkoutModal");
    const checkoutBody = document.getElementById("checkoutBody");
    const closeCheckoutBtn = document.getElementById("closeCheckout");
    const confirmCheckoutBtn = document.getElementById("confirmCheckout");

    // Helpers
    function formatPrice(n, curr = currency) {
      return new Intl.NumberFormat(undefined, { style: "currency", currency: curr }).format(n);
    }

    function saveCart() {
      try {
        localStorage.setItem("nova_cart", JSON.stringify(cart));
      } catch (e) {
        // ignore storage failures
      }
    }

    function loadCart() {
      try {
        const raw = localStorage.getItem("nova_cart");
        if (raw) cart = JSON.parse(raw);
      } catch {
        cart = [];
      }
    }

    function updateCartUI() {
      // cart items
      cartItemsEl.innerHTML = "";
      let subtotal = 0;
      cart.forEach(item => {
        const prod = products.find(p => p.id === item.productId);
        if (!prod) return;
        const line = document.createElement("div");
        line.className = "cart-item";
        line.innerHTML = `
          <img class="cart-thumb" src="${prod.image}" alt="${prod.name}">
          <div style="min-width: 0;">
            <div class="cart-name" title="${prod.name}">${prod.name}</div>
            <div style="font-size: .8rem; color: var(--muted);">
              ${prod.category} • ${formatPrice(prod.price)}
            </div>
          </div>
          <div class="cart-qty" aria-label="Quantity">
            <button class="qty-btn" data-id="${prod.id}" data-delta="-1" aria-label="Decrease quantity">-</button>
            <span>${item.quantity}</span>
            <button class="qty-btn" data-id="${prod.id}" data-delta="1" aria-label="Increase quantity">+</button>
          </div>
        `;
        subtotal += prod.price * item.quantity;
        cartItemsEl.appendChild(line);
      });

      // totals
      const tax = 0; // simulated
      const grand = subtotal + tax;
      cartTotalsEl.innerHTML = `
        Subtotal: ${formatPrice(subtotal)}
        <div style="display:flex; justify-content: space-between; margin-top:6px;">
          <span>Tax (0%)</span><span>${formatPrice(tax)}</span>
        </div>
        <div style="display:flex; justify-content: space-between; font-weight:700; margin-top:6px;">
          <span>Total</span><span id="cartGrandTotal">${formatPrice(grand)}</span>
        </div>
      `;

      // attach quantity handlers
      document.querySelectorAll('.qty-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const pid = btn.getAttribute('data-id');
          const delta = parseInt(btn.getAttribute('data-delta'), 10);
          updateCart(pid, delta);
        });
      });

      // enable checkout if items exist
      checkoutBtn.disabled = cart.length === 0;
      cartCountEl.textContent = cart.reduce((sum, it) => sum + it.quantity, 0);
      saveCart();
    }

    function addToCart(productId, qty = 1) {
      const prod = products.find(p => p.id === productId);
      if (!prod) return;
      const existing = cart.find(i => i.productId === productId);
      const newQty = existing ? existing.quantity + qty : qty;

      if (newQty > prod.stock) {
        // clamp to stock
        existing ? existing.quantity = Math.min(newQty, prod.stock) : cart.push({ productId, quantity: Math.min(qty, prod.stock) });
      } else {
        if (existing) existing.quantity = newQty;
        else cart.push({ productId, quantity: qty });
      }
      updateCartUI();
    }

    function updateCart(productId, delta) {
      const idx = cart.findIndex(i => i.productId === productId);
      if (idx < 0) return;
      const prod = products.find(p => p.id === productId);
      const newQty = cart[idx].quantity + delta;
      if (newQty <= 0) {
        cart.splice(idx, 1);
      } else if (newQty > prod.stock) {
        cart[idx].quantity = prod.stock;
      } else {
        cart[idx].quantity = newQty;
      }
      updateCartUI();
    }

    function clearCart() {
      cart = [];
      updateCartUI();
    }

    // Rendering catalog
    function productCardHTML(p) {
      const stockLabel = p.stock > 0 ? `<span class="stock" aria-label="In stock">In stock: ${p.stock}</span>` : `<span class="stock" aria-label="Out of stock" style="background:#fee2e2;color:#991b1b;border-color:#f5c2c7;">Out of stock</span>`;
      return `
        <article class="card" aria-label="${p.name}">
          <div class="card-media" role="img" aria-label="${p.name}">
            <img src="${p.image}" alt="${p.name}">
          </div>
          <div class="card-body">
            <div class="card-title">${p.name}</div>
            <div class="card-desc" style="min-height: 0;">${p.description}</div>
            <div class="price-row" aria-label="Price and rating">
              <span style="font-weight:700">${formatPrice(p.price)}</span>
              <span class="rating" title="Rating">${p.rating.toFixed(1)}★</span>
            </div>
            <div style="display:flex; justify-content: space-between; align-items:center;">
              ${stockLabel}
            </div>
          </div>
          <div class="card-actions">
            <button class="btn" data-id="${p.id}" aria-label="View details" style="flex:1;">Details</button>
            <button class="btn secondary" data-id="${p.id}" aria-label="Add to cart" ${p.stock<=0 ? 'disabled' : ''}>Add</button>
          </div>
        </article>
      `;
    }

    function renderCatalog() {
      let filtered = products.filter(p => {
        const inCat = activeCategory === "All" || p.category === activeCategory;
        const q = searchQuery.trim().toLowerCase();
        const matchesQuery = q === "" || p.name.toLowerCase().includes(q) || p.description.toLowerCase().includes(q);
        return inCat && matchesQuery;
      });

      // sort
      switch (sortKey) {
        case "price-asc":
          filtered = filtered.slice().sort((a,b) => a.price - b.price); break;
        case "price-desc":
          filtered = filtered.slice().sort((a,b) => b.price - a.price); break;
        case "rating":
          filtered = filtered.slice().sort((a,b) => b.rating - a.rating); break;
        case "name":
          filtered = filtered.slice().sort((a,b) => a.name.localeCompare(b.name)); break;
        case "popularity":
        default:
          filtered = filtered.slice().sort((a,b) => b.stock - a.stock); // simple proxy
      }

      productGrid.innerHTML = filtered.map(p => productCardHTML(p)).join("");

      // attach event listeners for Details and Add
      productGrid.querySelectorAll('[data-id]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const pid = btn.getAttribute('data-id');
          if (btn.textContent === "Details" || btn.getAttribute('aria-label') === 'View details') {
            openProductDetail(pid);
          } else {
            addToCart(pid, 1);
          }
        });
      });
    }

    // Product detail modal
    function openProductDetail(productId) {
      const p = products.find(x => x.id === productId);
      if (!p) return;
      detailTitle.textContent = p.name;
      detailBody.innerHTML = `
        <div style="display:flex; gap:12px; align-items:center;">
          <img src="${p.image}" alt="${p.name}" style="width:120px; height:120px; object-fit:cover; border-radius:8px; border:1px solid var(--border);" />
          <div>
            <div style="font-weight:700; font-size:1.05rem;">${p.name}</div>
            <div style="color:var(--muted);">${p.description}</div>
            <div style="margin-top:6px;">
              <span class="rating" title="Rating">${p.rating.toFixed(1)} ★</span>
              <span style="margin-left:8px; font-weight:600;">${formatPrice(p.price)}</span>
            </div>
            <div style="margin-top:6px;">
              ${p.stock > 0 ? `<span class="stock" aria-label="In stock" >In stock: ${p.stock}</span>` : `<span class="stock" aria-label="Out of stock" style="background:#fee2e2;color:#991b1b;border-color:#f5c2c7;">Out of stock</span>`}
            </div>
          </div>
        </div>
      `;
      detailAddToCart.disabled = p.stock <= 0;
      detailAddToCart.setAttribute('data-id', p.id);
      productDetailModal.hidden = false;
      productDetailModal.style.display = "flex";
    }

    function closeProductDetail() {
      productDetailModal.style.display = "none";
      productDetailModal.hidden = true;
    }

    // Checkout modal content
    function openCheckout() {
      const lines = cart.map(item => {
        const p = products.find(x => x.id === item.productId);
        return `${p.name} x${item.quantity} - ${formatPrice(p.price * item.quantity)}`;
      });
      const total = cart.reduce((sum, it) => {
        const p = products.find(x => x.id === it.productId);
        return sum + p.price * it.quantity;
      }, 0);
      checkoutBody.innerHTML = `
        <div style="font-size:0.95rem; color:var(--muted);">Review your items before confirming the order.</div>
        <ul style="margin:4px 0; padding-left: 18px;">
          ${lines.map(l => `<li>${l}</li>`).join("")}
        </ul>
        <div style="display:flex; justify-content: space-between; padding-top:6px; font-weight:700;">
          <span>Grand Total</span><span>${formatPrice(total)}</span>
        </div>
      `;
      checkoutModal.hidden = false;
      checkoutModal.style.display = "flex";
    }

    function closeCheckout() {
      checkoutModal.style.display = "none";
      checkoutModal.hidden = true;
    }

    // Initialize
    function init() {
      // load persisted cart
      loadCart();
      // render initial catalog
      renderCatalog();
      updateCartUI();

      // category quick filters
      Array.from(filtersBar.querySelectorAll('.chip')).forEach(chip => {
        chip.addEventListener('click', () => {
          activeCategory = chip.getAttribute('data-cat');
          // highlight active
          filtersBar.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          renderCatalog();
        });
      });

      // search
      searchInput.addEventListener('input', (e) => {
        searchQuery = e.target.value;
        renderCatalog();
      });

      // sort
      document.getElementById('sortSelect').addEventListener('change', (e) => {
        sortKey = e.target.value;
        renderCatalog();
      });

      // cart drawer toggle
      cartPanelBtn.addEventListener('click', () => {
        // simple toggle: show modal-like overlay with cart in page
        // For simplicity, we'll focus the cart panel; it's always visible in this SPA layout.
        // Could add a modal overlay if desired.
        // No-op: the cart is always visible in this scaffold.
      });

      // Clear cart
      clearCartBtn.addEventListener('click', clearCart);

      // Detail modal controls
      closeDetailBtn.addEventListener('click', closeProductDetail);
      productDetailModal.addEventListener('click', (e) => {
        if (e.target === productDetailModal) closeProductDetail();
      });

      detailAddToCart.addEventListener('click', () => {
        const pid = detailAddToCart.getAttribute('data-id');
        addToCart(pid, 1);
      });

      // Close checkout
      closeCheckoutBtn.addEventListener('click', closeCheckout);
      checkoutModal.addEventListener('click', (e) => {
        if (e.target === checkoutModal) closeCheckout();
      });

      // Confirm checkout
      confirmCheckoutBtn.addEventListener('click', () => {
        // Simulated checkout success
        closeCheckout();
        clearCart();
        const conf = document.createElement('div');
        conf.style.padding = "12px";
        conf.style.fontWeight = "500";
        conf.textContent = "Thank you! Your order has been placed (simulated).";
        checkoutBody.innerHTML = "";
        checkoutBody.appendChild(conf);
      });

      // Hook up Add buttons on cards (delegate already handled in render)
    }

    // SVG placeholder generator (inline data URL)
    function generateSVG(label, color) {
      // Simple inline SVG with gradient and label text
      const escaped = label.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="600" height="400" viewBox="0 0 600 400">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop stop-color="${color}" offset="0"/>
              <stop stop-color="#ffffff" offset="1"/>
            </linearGradient>
          </defs>
          <rect width="600" height="400" fill="url(#g)"/>
          <text x="50%" y="54%" font-family="Arial" font-size="28" text-anchor="middle" fill="#ffffff" opacity="0.95">${escaped}</text>
        </svg>
      `;
      return "data:image/svg+xml;utf8," + encodeURIComponent(svg);
    }

    // Initialize after DOM ready
    document.addEventListener('DOMContentLoaded', init);
    // Expose small helpers to global for potential extension (optional)
    window.__nova = {
      addToCart
    };
  </script>
</body>

</html>