<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FloraFlow Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* FloraFlow Theme: dark purple gradient with lavender accents */
    :root{
      --bg: #0b0720;
      --bg2: #1a0c2a;
      --card: #141027;
      --text: #e9e1f9;
      --muted: #c8b8e6;
      --accent1: #a78bfa; /* lavender */
      --accent2: #4c1d95; /* violet */
      --ring: rgba(167,139,250,.5);
      --green: #34d399;
      --shadow: 0 10px 25px rgba(0,0,0,.25);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, #2a0a30 0%, #1a0b28 40%, #120c20 100%), #0b0720;
      background-attachment: fixed;
    }

    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus {
      position: static;
      width: auto;
      height: auto;
      padding: 8px 12px;
      background: #222;
      color: #fff;
      border-radius: 4px;
      z-index: 1000;
    }

    /* Layout */
    .site {
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      min-height: 100%;
    }

    header.site-header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(10,6,20,.9);
      backdrop-filter: saturate(1.2) blur(4px);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
    }
    .brand .logo {
      width: 34px; height: 34px;
      border-radius: 8px;
      display: inline-flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #a78bfa 0%, #4c1d95 100%);
      color: white; font-weight: bold;
    }
    .brand .name { font-family: "Times New Roman", serif; font-size: 1.25rem; letter-spacing: .5px; }
    nav.main-nav {
      display: flex; gap: 8px; align-items: center;
      padding: 0 20px 12px;
    }
    nav.main-nav a {
      color: #e9e1f9; text-decoration: none; padding: 10px 12px; border-radius: 6px;
    }
    nav.main-nav a[aria-current="page"] { background: rgba(167,139,250,.25); }
    .toolbar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 20px 16px;
      gap: 12px;
    }
    .btn {
      background: #2a1747;
      color: #fff;
      border: 1px solid rgba(167,139,250,.4);
      padding: 10px 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: transform .15s ease, background .2s;
    }
    .btn.secondary {
      background: transparent;
      border: 1px solid rgba(167,139,250,.6);
    }
    .btn:hover { transform: translateY(-1px); background: #2e1a56; }
    .btn.primary { background: linear-gradient(135deg, #a78bfa 0%, #4c1d95 100%); border: none; color: white; }
    .btn.icon { padding: 8px; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; }

    .lang-select { background: rgba(255,255,255,.08); color: #fff; border: 1px solid rgba(255,255,255,.25); border-radius: 6px; padding: 6px 8px; }

    main { padding: 20px; }

    section { margin: 28px 0; }
    section h2 {
      font-family: "Times New Roman", serif;
      font-size: 1.75rem;
      margin: 0 0 12px;
      color: #e7e2f8;
    }

    /* Filters bar */
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      align-items: end;
      padding: 8px 0 12px;
    }
    .field { display: grid; gap: 6px; }
    label { font-size: 12px; color: var(--muted); }
    select, input[type="number"] {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.05);
      color: #fff;
    }
    @media (max-width: 900px){
      .filters { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
    }

    /* Grid cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 14px;
    }
    .card {
      background: rgba(16,8,32,.6);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-rows: 150px 1fr;
      transition: transform .2s ease;
    }
    .card:hover { transform: translateY(-4px); }
    .thumb {
      position: relative;
      width: 100%; height: 150px;
      display: grid; place-items: center;
      background: #111;
    }
    .thumb-emoji { font-size: 64px; }
    .thumb-img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .skeleton {
      position: absolute; inset: 0;
      background: linear-gradient(-90deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.16) 50%, rgba(255,255,255,.08) 100%);
      background-size: 400% 400%;
      animation: shimmer 1.2s ease-in-out infinite;
      z-index: 1;
    }
    @keyframes shimmer { 0% { transform: translateX(-100%);} 100% { transform: translateX(100%);} }

    .card-body { padding: 12px 12px 14px; display: grid; gap: 6px; }
    .name { font-family: "Times New Roman", serif; font-size: 1rem; margin: 0; }
    .tagline { font-size: 12px; color: #d9d1ee; margin: 0; }
    .price { font-weight: bold; }
    .old-price { text-decoration: line-through; color: #c7b8e3; font-size: 12px; margin-left: 6px; }

    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 8px; border-radius: 999px;
      background: rgba(167,139,250,.25);
      font-size: 12px;
      color: #eae2ff;
    }

    /* Sections layout helpers (inline section headers with counts) */
    .section-header {
      display: flex; justify-content: space-between; align-items: baseline;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      margin-bottom: 6px;
    }

    /* Cart Drawer */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.5);
      display: none;
      z-index: 60;
    }
    .drawer {
      position: fixed;
      top: 0; right: 0;
      width: 360px; max-width: 96vw;
      height: 100%;
      background: #1a1142;
      border-left: 1px solid rgba(255,255,255,.15);
      box-shadow: -6px 0 20px rgba(0,0,0,.4);
      transform: translateX(100%);
      transition: transform .25s ease;
      z-index: 70;
      display: flex; flex-direction: column;
    }
    .drawer.open { transform: translateX(0%); }
    .drawer header { padding: 14px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,.1); }
    .drawer .cart-items { padding: 12px; overflow: auto; flex: 1; display: grid; gap: 12px; }
    .cart-row { display: grid; grid-template-columns: 48px 1fr auto; gap: 8px; align-items: center; }
    .cart-thumb { width: 48px; height: 48px; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; font-size: 22px; background: rgba(255,255,255,.08); }
    .qty { width: 60px; padding: 6px; border-radius: 6px; border: 1px solid rgba(255,255,255,.25); text-align: center; background: rgba(0,0,0,.2); color: #fff; }
    .cart-footer { padding: 12px; border-top: 1px solid rgba(255,255,255,.1); }
    .cart-total { display:flex; justify-content: space-between; align-items: center; font-weight: bold; padding: 8px 0; }
    .empty { text-align: center; color: #c9b7e3; padding: 20px; }

    /* Chat Widget */
    .chat-toggle {
      position: fixed; right: 20px; bottom: 20px;
      z-index: 60;
      width: 56px; height: 56px; border-radius: 50%;
      background: linear-gradient(135deg, #a78bfa, #4c1d95);
      border: none; cursor: pointer; font-size: 22px;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
    }
    .chat-panel {
      position: fixed; right: 20px; bottom: 88px;
      width: 320px; max-width: 90vw; height: 420px;
      background: #1b1038; border: 1px solid rgba(255,255,255,.15);
      border-radius: 14px; display: flex; flex-direction: column; z-index: 65;
      overflow: hidden;
      box-shadow: 0 10px 28px rgba(0,0,0,.4);
    }
    .chat-header { padding: 12px; border-bottom: 1px solid rgba(255,255,255,.15); display:flex; justify-content:space-between; align-items:center; }
    .chat-content { padding: 12px; overflow: auto; flex: 1; display: grid; gap: 8px; }
    .message { max-width: 78%; padding: 8px 10px; border-radius: 10px; }
    .me { background: rgba(167,139,250,.4); justify-self: end; }
    .bot { background: rgba(255,255,255,.08); }
    .chat-input { display: flex; padding: 8px; border-top: 1px solid rgba(255,255,255,.15); }
    .chat-input input { flex: 1; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,.3); background: rgba(0,0,0,.2); color: #fff; }
    .chat-input button { margin-left: 6px; }

    /* About / Contact content polish */
    .card p { margin: 0; color: #ddd; line-height: 1.5; }
    .container { max-width: 1200px; margin: 0 auto; }

    /* Footer */
    footer.site-footer { padding: 28px 20px; text-align: center; color: #bfb5d9; border-top: 1px solid rgba(255,255,255,.1); }

    @media (max-width: 900px){
      .thumb { height: 120px; }
      .thumb-emoji { font-size: 54px; }
      .drawer { width: 100%; max-width: 100%; }
      .chat-panel { width: calc(100% - 40px); right: 20px; bottom: 90px; }
    }
  </style>
</head>
<body>
  <a href="#content" class="skip-link" aria-label="Skip to content">Skip to content</a>

  <div class="site" id="app-root">
    <!-- Header -->
    <header class="site-header" role="banner">
      <div class="brand" aria-label="FloraFlow brand">
        <div class="logo" aria-hidden="true">FF</div>
        <div class="name" id="brand-name">FloraFlow</div>
        <span aria-hidden="true" style="flex:1"></span>
        <select id="lang" class="lang-select" aria-label="Language switcher">
          <option value="en">EN</option>
          <option value="es">ES</option>
          <option value="fr">FR</option>
          <option value="de">DE</option>
        </select>
      </div>
      <nav class="main-nav" aria-label="Main navigation">
        <a href="#shop" data-i18n-key="navShop" aria-label="Shop section" id="nav-shop">Shop</a>
        <a href="#occasions" data-i18n-key="navOccasions" aria-label="Occasions section" id="nav-occasions">Occasions</a>
        <a href="#bestsellers" data-i18n-key="navBestsellers" aria-label="Bestsellers section" id="nav-bestsellers">Bestsellers</a>
        <a href="#about" data-i18n-key="navAbout" aria-label="About section" id="nav-about">About</a>
        <a href="#contact" data-i18n-key="navContact" aria-label="Contact section" id="nav-contact">Contact</a>
        <button class="btn" id="open-cart" aria-label="Open cart" title="Cart">
          🛒 Cart
        </button>
      </nav>
    </header>

    <!-- Sub-toolbar: quick actions -->
    <div class="toolbar container" aria-label="Toolbar">
      <div style="display:flex; align-items:center; gap:12px;">
        <span id="filters-label" data-i18n-key="filterLabel" style="font-weight:600; letter-spacing:.3px;"></span>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <span style="font-size:12px; color:#cbd5e1;" aria-live="polite" id="live-region"></span>
      </div>
    </div>

    <main id="content" class="container" role="main" aria-label="Main content">
      <!-- Filters -->
      <section aria-labelledby="filters-title" class="filters" id="filters-section" aria-label="Filters">
        <div class="field">
          <label id="filters-category-label" for="filter-category" data-i18n-key="category">Category</label>
          <select id="filter-category" aria-labelledby="filters-category-label" title="Category filter">
            <option value="All" data-i18n-exclude>All</option>
            <!-- dynamic categories filled by script -->
          </select>
        </div>
        <div class="field">
          <label id="filters-occasion-label" for="filter-occasion" data-i18n-key="occasion">Occasion</label>
          <select id="filter-occasion" aria-labelledby="filters-occasion-label" title="Occasion filter">
            <option value="All" data-i18n-exclude>All</option>
            <option value="Romance">Romance</option>
            <option value="Birthday">Birthday</option>
            <option value="Anniversary">Anniversary</option>
            <option value="Thank You">Thank You</option>
          </select>
        </div>
        <div class="field">
          <label id="filters-color-label" for="filter-color" data-i18n-key="color">Color</label>
          <select id="filter-color" aria-labelledby="filters-color-label" title="Color filter">
            <option value="All" data-i18n-exclude>All</option>
            <option value="Purple">Purple</option>
            <option value="Red">Red</option>
            <option value="Pink">Pink</option>
            <option value="Yellow">Yellow</option>
            <option value="White">White</option>
          </select>
        </div>
        <div class="field">
          <label id="filters-price-label" for="filter-min" data-i18n-key="price">Price</label>
          <div style="display:flex; gap:6px;">
            <input id="filter-min" type="number" placeholder="Min" min="0" style="width:100px;">
            <input id="filter-max" type="number" placeholder="Max" min="0" style="width:100px;">
          </div>
        </div>
        <div class="field">
          <label id="filters-sort-label" for="sort-by" data-i18n-key="sortBy">Sort By</label>
          <select id="sort-by" aria-labelledby="filters-sort-label" title="Sort items">
            <option value="default" data-i18n-exclude>Default</option>
            <option value="price-asc" data-i18n-key="sortPriceAsc" data-i18n-attr="textContent">Price: Low to High</option>
            <option value="price-desc" data-i18n-key="sortPriceDesc" data-i18n-attr="textContent">Price: High to Low</option>
            <option value="rating-desc" data-i18n-key="sortRating" data-i18n-attr="textContent">Rating</option>
          </select>
        </div>
        <div class="field" style="align-self:end;">
          <button class="btn" id="clear-filters" aria-label="Clear filters" title="Clear filters" data-i18n-key="clearFilters">Clear Filters</button>
        </div>
      </section>

      <!-- Shop -->
      <section aria-labelledby="shop-title" id="shop" class="shop-section">
        <div class="section-header">
          <h2 id="shop-title" data-i18n-key="shopTitle" style="margin:0;">Shop</h2>
          <span class="badge" aria-label="Shop count" id="shop-count">0 items</span>
        </div>
        <div id="shop-grid" class="grid" role="grid" aria-label="Shop products"></div>
      </section>

      <!-- Occasions -->
      <section aria-labelledby="occasions-title" id="occasions" class="occasions-section">
        <div class="section-header">
          <h2 id="occasions-title" data-i18n-key="occasionsTitle" style="margin:0;">Occasions</h2>
          <span class="badge" aria-label="Occasions count" id="occasions-count">0 items</span>
        </div>
        <div id="occasions-grid" class="grid" role="grid" aria-label="Occasions products"></div>
      </section>

      <!-- Bestsellers -->
      <section aria-labelledby="bestsellers-title" id="bestsellers" class="bestsellers-section">
        <div class="section-header">
          <h2 id="bestsellers-title" data-i18n-key="bestsellersTitle" style="margin:0;">Bestsellers</h2>
          <span class="badge" aria-label="Bestsellers count" id="bestsellers-count">0 items</span>
        </div>
        <div id="bestsellers-grid" class="grid" role="grid" aria-label="Bestsellers products"></div>
      </section>

      <!-- About -->
      <section id="about" aria-labelledby="about-title" class="about-section">
        <h2 id="about-title" data-i18n-key="aboutTitle" style="margin:0;">About FloraFlow</h2>
        <div class="card" style="margin-top:12px;">
          <div class="thumb" aria-label="Brand image" style="height:180px;">
            <div class="skeleton" aria-hidden="true"></div>
            <div class="thumb-emoji" style="font-size:72px;">🌸</div>
          </div>
          <div class="card-body" style="gap:8px;">
            <p>FloraFlow crafts premium floral experiences with a lavender to violet gradient aesthetic, blending timeless serif headings with modern sans-serif UI. This demo showcases a multi-language, filterable catalog with emoji-first visuals that swap to generated images when loaded.</p>
          </div>
        </div>
      </section>

      <!-- Contact -->
      <section id="contact" aria-labelledby="contact-title" class="contact-section">
        <h2 id="contact-title" data-i18n-key="contactTitle" style="margin:0;">Contact</h2>
        <form id="contact-form" class="card" style="margin-top:12px;" novalidate aria-label="Contact form">
          <div class="card-body" style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
            <div class="field" style="grid-column: span 2;">
              <label for="name" data-i18n-key="name" aria-label="Your name">Name</label>
              <input id="name" name="name" type="text" required placeholder="Your name" />
            </div>
            <div class="field" style="grid-column: span 2;">
              <label for="email" data-i18n-key="email" aria-label="Your email">Email</label>
              <input id="email" name="email" type="email" required placeholder="you@example.com" />
            </div>
            <div class="field" style="grid-column: span 2;">
              <label for="message" data-i18n-key="message" aria-label="Message">Message</label>
              <textarea id="message" name="message" rows="4" required placeholder="Your message..." style="resize: vertical;"></textarea>
            </div>
          </div>
          <div class="cart-footer" style="padding:12px;">
            <button class="btn primary" type="submit" aria-label="Submit message" data-i18n-key="submit">Submit</button>
            <span id="form-status" aria-live="polite" style="margin-left:12px;"></span>
          </div>
        </form>
      </section>
    </main>

    <!-- Cart Drawer -->
    <div class="overlay" id="overlay" aria-hidden="true"></div>
    <aside class="drawer" id="cart-drawer" aria-label="Cart Drawer" aria-hidden="true" role="dialog" aria-modal="true" >
      <header>
        <strong data-i18n-key="cartTitle" id="cart-title">Your Cart</strong>
        <button class="btn" id="close-cart" aria-label="Close cart">✖</button>
      </header>
      <div class="cart-items" id="cart-items" aria-live="polite">
        <div class="empty" id="cart-empty" style="display:block;">Your cart is empty.</div>
      </div>
      <div class="cart-footer">
        <div class="cart-total" id="cart-subtotal">
          <span data-i18n-key="subtotal" id="cart-subtotal-label">Subtotal</span>
          <span id="cart-subtotal-value">$0.00</span>
        </div>
        <button class="btn primary" id="checkout" aria-label="Checkout" style="width:100%;">Checkout</button>
      </div>
    </aside>

    <!-- Overlaying Chat Widget -->
    <button class="chat-toggle" id="open-chat" aria-label="Open chat" title="Chat">💬</button>
    <section class="chat-panel" id="chat-panel" aria-label="Chat" hidden>
      <div class="chat-header">
        <strong>FloraFlow Bot</strong>
        <button class="btn" id="close-chat" aria-label="Close chat" title="Close">✖</button>
      </div>
      <div class="chat-content" id="chat-content" aria-live="polite">
        <div class="message bot" style="justify-self:flex-start;">Hi there! Need floral inspiration or help with filters?</div>
        <div class="message bot" style="justify-self:flex-start;">Tip: Try the Occasion and Color filters to discover combos.</div>
      </div>
      <div class="chat-input" aria-label="Chat input">
        <input id="chat-input" placeholder="Message..." autocomplete="off" />
        <button class="btn" id="send-chat" aria-label="Send message">Send</button>
      </div>
    </section>

    <footer class="site-footer" role="contentinfo">
      <span>&copy; FloraFlow Demo</span> •
      <span id="footer-lang-note" aria-live="polite"></span>
    </footer>
  </div>

  <script>
    // Data and translations
    const colorHex = {
      Purple: '#8b5cf6',
      Red: '#f87171',
      Pink: '#f472b6',
      Yellow: '#f59e0b',
      White: '#e5e7eb',
      Orange: '#f97316',
      Blue: '#60a5fa',
    };

    // Translations (EN default; fallback to EN if missing)
    const translations = {
      en: {
        navShop: 'Shop',
        navOccasions: 'Occasions',
        navBestsellers: 'Bestsellers',
        navAbout: 'About',
        navContact: 'Contact',
        filterLabel: 'Filters',
        category: 'Category',
        occasion: 'Occasion',
        color: 'Color',
        price: 'Price',
        sortBy: 'Sort By',
        clearFilters: 'Clear Filters',
        shopTitle: 'Shop',
        occasionsTitle: 'Occasions',
        bestsellersTitle: 'Bestsellers',
        aboutTitle: 'About FloraFlow',
        contactTitle: 'Contact',
        cartTitle: 'Your Cart',
        subtotal: 'Subtotal',
        checkout: 'Checkout',
        language: 'Language',
        name: 'Name',
        email: 'Email',
        message: 'Message',
        submit: 'Submit',
        thankYou: 'Thank you! Your message has been sent.',
        sortPriceAsc: 'Price: Low to High',
        sortPriceDesc: 'Price: High to Low',
        sortRating: 'Rating',
        cartCount: 'items',
        shopCount: 'items',
        occasionsCount: 'items',
        bestsellersCount: 'items',
        aboutIntro: 'FloraFlow crafts premium floral experiences with a lavender to violet gradient aesthetic.',
      },
      es: {
        navShop: 'Tienda',
        navOccasions: 'Ocasiones',
        navBestsellers: 'Más vendidos',
        navAbout: 'Acerca de',
        navContact: 'Contacto',
        filterLabel: 'Filtros',
        category: 'Categoría',
        occasion: 'Ocasión',
        color: 'Color',
        price: 'Precio',
        sortBy: 'Ordenar por',
        clearFilters: 'Limpiar filtros',
        shopTitle: 'Tienda',
        occasionsTitle: 'Ocasiones',
        bestsellersTitle: 'Más vendidos',
        aboutTitle: 'Acerca de FloraFlow',
        contactTitle: 'Contacto',
        cartTitle: 'Carrito',
        subtotal: 'Subtotal',
        checkout: 'Pagar',
        language: 'Idioma',
        name: 'Nombre',
        email: 'Correo',
        message: 'Mensaje',
        submit: 'Enviar',
        thankYou: '¡Gracias! Su mensaje ha sido enviado.',
        sortPriceAsc: 'Precio: menor a mayor',
        sortPriceDesc: 'Precio: mayor a menor',
        sortRating: 'Calificación',
        cartCount: 'artículos',
        shopCount: 'artículos',
        occasionsCount: 'artículos',
        bestsellersCount: 'artículos',
        aboutIntro: 'FloraFlow crea experiencias florales premium con una estética de gradiente lavanda a violeta.',
      },
      fr: {
        navShop: 'Boutique',
        navOccasions: 'Occasions',
        navBestsellers: 'Meilleures ventes',
        navAbout: 'À propos',
        navContact: 'Contact',
        filterLabel: 'Filtres',
        category: 'Catégorie',
        occasion: 'Occasion',
        color: 'Couleur',
        price: 'Prix',
        sortBy: 'Trier par',
        clearFilters: 'Effacer les filtres',
        shopTitle: 'Boutique',
        occasionsTitle: 'Occasions',
        bestsellersTitle: 'Meilleures ventes',
        aboutTitle: 'À propos de FloraFlow',
        contactTitle: 'Contact',
        cartTitle: 'Votre panier',
        subtotal: 'Sous-total',
        checkout: 'Passer à la caisse',
        language: 'Langue',
        name: 'Nom',
        email: 'Email',
        message: 'Message',
        submit: 'Envoyer',
        thankYou: 'Merci! Votre message a été envoyé.',
        sortPriceAsc: 'Prix croissant',
        sortPriceDesc: 'Prix décroissant',
        sortRating: 'Note',
        cartCount: 'articles',
        shopCount: 'articles',
        occasionsCount: 'articles',
        bestsellersCount: 'articles',
        aboutIntro: "FloraFlow conçoit des expériences florales premium avec un dégradé lavande à violet.",
      },
      de: {
        navShop: 'Shop',
        navOccasions: 'Anlässe',
        navBestsellers: 'Bestseller',
        navAbout: 'Über uns',
        navContact: 'Kontakt',
        filterLabel: 'Filter',
        category: 'Kategorie',
        occasion: 'Anlass',
        color: 'Farbe',
        price: 'Preis',
        sortBy: 'Sortieren nach',
        clearFilters: 'Filter löschen',
        shopTitle: 'Shop',
        occasionsTitle: 'Anlässe',
        bestsellersTitle: 'Bestseller',
        aboutTitle: 'Über FloraFlow',
        contactTitle: 'Kontakt',
        cartTitle: 'Warenkorb',
        subtotal: 'Zwischensumme',
        checkout: 'Zur Kasse',
        language: 'Sprache',
        name: 'Name',
        email: 'E-Mail',
        message: 'Nachricht',
        submit: 'Senden',
        thankYou: 'Danke! Ihre Nachricht wurde gesendet.',
        sortPriceAsc: 'Preis aufsteigend',
        sortPriceDesc: 'Preis absteigend',
        sortRating: 'Bewertung',
        cartCount: 'artikel',
        shopCount: 'artikel',
        occasionsCount: 'artikel',
        bestsellersCount: 'artikel',
        aboutIntro: 'FloraFlow gestaltet florale Erlebnisse mit einem ästhetischen Gradienten von Lavendel zu Violett.',
      }
    };

    // Data: 12 Shop items, 4 Occasions items, 4 Bestsellers (unique items)
    const productsRaw = [
      // Shop
      { id: 's1', name: 'Lavender Bliss Bouquet', tagline: 'Soft petals, bold scent', emoji:'💐', imageUrl:null, color:'Purple', category:'Bouquet', price:28, discount:10, rating:4.6, reviews:128, sections:['shop'], occasion:'None' },
      { id: 's2', name: 'Rose Garden Bundle', tagline: 'Classic reds, timeless romance', emoji:'🌹', imageUrl:null, color:'Red', category:'Bouquet', price:32, discount:0, rating:4.8, reviews:210, sections:['shop'], occasion:'Romance' },
      { id: 's3', name: 'Sunlit Meadow', tagline: 'Golden sunflowers burst', emoji:'🌻', imageUrl:null, color:'Yellow', category:'Bouquet', price:26, discount:5, rating:4.5, reviews:98, sections:['shop'], occasion:'Birthday' },
      { id: 's4', name: 'Velvet Night Bouquet', tagline:'Deep purples and velvety petals', emoji:'🥀', imageUrl:null, color:'Purple', category:'Bouquet', price:30, discount:15, rating:4.4, reviews:77, sections:['shop'], occasion:'Anniversary' },
      { id: 's5', name: 'Petal Poetry', tagline:'Soft, poetic pinks', emoji:'🌸', imageUrl:null, color:'Pink', category:'Bouquet', price:22, discount:0, rating:4.2, reviews:64, sections:['shop'], occasion:'None' },
      { id: 's6', name: 'Midnight Orchid', tagline:'Mystic purple hues', emoji:'🪷', imageUrl:null, color:'Purple', category:'Orchid', price:34, discount:0, rating:4.7, reviews:89, sections:['shop'], occasion:'Romance' },
      { id: 's7', name: 'Bloom Whisper', tagline:'Delicate pink tones', emoji:'🌷', imageUrl:null, color:'Pink', category:'Bouquet', price:20, discount:0, rating:4.1, reviews:52, sections:['shop'], occasion:'None' },
      { id: 's8', name: 'Twilight Lavender', tagline:'Lavender dusk hues', emoji:'🌙', imageUrl:null, color:'Purple', category:'Bouquet', price:29, discount:5, rating:4.3, reviews:67, sections:['shop'], occasion:'Birthday' },
      { id: 's9', name: 'Ember Rose Basket', tagline:'Cozy reds in a basket', emoji:'🌹', imageUrl:null, color:'Red', category:'Basket', price:27, discount:10, rating:4.5, reviews:88, sections:['shop'], occasion:'Anniversary' },
      { id: 's10', name: 'Violet Dream', tagline:'Dreamy purple glow', emoji:'💜', imageUrl:null, color:'Purple', category:'Bouquet', price:25, discount:0, rating:4.0, reviews:41, sections:['shop'], occasion:'None' },
      { id: 's11', name: 'Floral Cascade', tagline:'Cascade of fresh blooms', emoji:'🌼', imageUrl:null, color:'Yellow', category:'Bouquet', price:33, discount:0, rating:4.6, reviews:120, sections:['shop'], occasion:'Anniversary' },
      { id: 's12', name: 'Petals & Pearls', tagline:'Elegant white petals', emoji:'💮', imageUrl:null, color:'White', category:'Bouquet', price:24, discount:0, rating:4.3, reviews:88, sections:['shop'], occasion:'Thank You' },
      // Occasions (4)
      { id: 'o1', name: 'Romantic Evening Bundle', tagline:'Romance in full bloom', emoji:'💖', imageUrl:null, color:'Pink', category:'Occasion', price:39, discount:0, rating:4.9, reviews:320, sections:['occasions'], occasion:'Romance' },
      { id: 'o2', name: 'Birthday Surprise', tagline:'Colorful celebrations', emoji:'🎁', imageUrl:null, color:'Yellow', category:'Occasion', price:29, discount:0, rating:4.6, reviews:210, sections:['occasions'], occasion:'Birthday' },
      { id: 'o3', name: 'Anniversary Glow', tagline:'Forever starts here', emoji:'💎', imageUrl:null, color:'Purple', category:'Occasion', price:45, discount:0, rating:4.8, reviews:180, sections:['occasions'], occasion:'Anniversary' },
      { id: 'o4', name: 'Thank You Notes', tagline:'Gratitude in petals', emoji:'🙏', imageUrl:null, color:'Purple', category:'Occasion', price:22, discount:0, rating:4.4, reviews:95, sections:['occasions'], occasion:'Thank You' },
      // Bestsellers (4)
      { id: 'b1', name: 'Garden Favorite', tagline:'Loved by many', emoji:'🌷', imageUrl:null, color:'Pink', category:'Bouquet', price:26, discount:0, rating:4.7, reviews:410, sections:['bestsellers'], occasion:'None' },
      { id: 'b2', name: 'Forever Red', tagline:'Classic and bold', emoji:'🌹', imageUrl:null, color:'Red', category:'Bouquet', price:34, discount:0, rating:4.8, reviews:390, sections:['bestsellers'], occasion:'None' },
      { id: 'b3', name: 'Lemon Sunshine', tagline:'Bright and cheerful', emoji:'🍋', imageUrl:null, color:'Yellow', category:'Bouquet', price:24, discount:0, rating:4.5, reviews:210, sections:['bestsellers'], occasion:'None' },
      { id: 'b4', name: 'Purple Dream', tagline:'Lavender whispers', emoji:'💜', imageUrl:null, color:'Purple', category:'Bouquet', price:28, discount:0, rating:4.6, reviews:190, sections:['bestsellers'], occasion:'None' }
    ];

    // We'll generate data URLs for each product (SVG gradient with emoji)
    function colorToHex(colorName){
      return colorHex[colorName] || '#7c3aed';
    }
    function generateSVG(emoji, colorName){
      const w = 600, h = 400;
      const g1 = colorToHex(colorName);
      const g2 = '#000';
      const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}">
        <defs>
          <linearGradient id="grad" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="${g1}"/>
            <stop offset="100%" stop-color="${g2}"/>
          </linearGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#grad)"/>
        <text x="50%" y="54%" text-anchor="middle" font-family="Segoe UI Emoji,Apple Color Emoji,Batik,Arial" font-size="160" dy="0" fill="white" >${emoji}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    // Initialize: attach dataUrl to each product
    function initImages(){
      for (const p of productsRaw){
        p.imageUrl = generateSVG(p.emoji, p.color);
      }
    }

    // App state
    let currentLang = 'en';
    let filters = { category: 'All', occasion: 'All', color: 'All', min: null, max: null, sortBy: 'default' };
    let cart = {}; // { productId: { product, qty } }

    // Helpers
    function t(key){
      const langMap = translations[currentLang] || translations['en'];
      return langMap[key] ?? translations['en'][key] ?? key;
    }

    function formatPrice(n){
      // Use locale for currency formatting
      try{
        return new Intl.NumberFormat(currentLang, { style:'currency', currency:'USD', minimumFractionDigits: 2 }).format(n);
      }catch(e){
        return '$' + n.toFixed(2);
      }
    }

    function applyFiltersToList(list){
      const min = filters.min != null ? Number(filters.min) : null;
      const max = filters.max != null ? Number(filters.max) : null;
      const occ = filters.occasion;
      const cat = filters.category;
      const col = filters.color;

      return list.filter(p => {
        if (cat !== 'All' && p.category !== cat) return false;
        if (col !== 'All' && p.color !== col) return false;
        // price after discount
        const price = p.price * (1 - (p.discount||0)/100);
        if (min != null && price < min) return false;
        if (max != null && price > max) return false;
        if (occ !== 'All' && p.occasion !== occ) return false;
        return true;
      });
    }

    function sortList(list){
      const key = filters.sortBy;
      if (key === 'price-asc'){
        return list.slice().sort((a,b)=> (a.price*(1 - (a.discount||0)/100)) - (b.price*(1 - (b.discount||0)/100)));
      } else if (key === 'price-desc'){
        return list.slice().sort((a,b)=> (b.price*(1 - (b.discount||0)/100)) - (a.price*(1 - (a.discount||0)/100)));
      } else if (key === 'rating-desc'){
        return list.slice().sort((a,b)=> b.rating - a.rating);
      }
      return list;
    }

    // Rendering helpers
    function renderGrid(containerId, items){
      const wrap = document.getElementById(containerId);
      wrap.innerHTML = '';
      if (!items.length){
        wrap.innerHTML = '<div class="empty" style="padding:20px;">No results. <button class="btn" id="clear-filters-inline">Clear Filters</button></div>';
        document.getElementById('clear-filters-inline')?.addEventListener('click', ()=>{ resetFilters(); renderAll(); });
        return;
      }
      items.forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';
        card.role = 'article';
        // Card structure
        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        thumb.setAttribute('aria-label', p.name);

        const skeleton = document.createElement('div');
        skeleton.className = 'skeleton';
        skeleton.style.display = 'none'; // we'll show after image load if needed
        // Emoji placeholder
        const emojiDiv = document.createElement('div');
        emojiDiv.className = 'thumb-emoji';
        emojiDiv.textContent = p.emoji;

        // Image (generated data URL)
        const img = document.createElement('img');
        img.className = 'thumb-img';
        img.alt = p.name;
        img.style.display = 'none';
        img.loading = 'lazy';
        img.src = p.imageUrl;

        // Attach load handler: swap emoji for image on success
        img.addEventListener('load', () => {
          emojiDiv.style.display = 'none';
          img.style.display = 'block';
        });
        img.addEventListener('error', () => {
          // keep emoji if image fails
        });

        thumb.appendChild(skeleton);
        thumb.appendChild(emojiDiv);
        thumb.appendChild(img);

        const body = document.createElement('div');
        body.className = 'card-body';
        const nameEl = document.createElement('div');
        nameEl.className = 'name';
        nameEl.textContent = p.name;
        const taglineEl = document.createElement('div');
        taglineEl.className = 'tagline';
        taglineEl.textContent = p.tagline;
        const priceP = document.createElement('div');
        priceP.style.display = 'flex'; alignItems = 'center';
        priceP.style.gap = '6px';
        priceP.style.marginTop = '4px';
        const priceValue = document.createElement('span');
        priceValue.className = 'price';
        const finalPrice = p.price * (1 - (p.discount||0)/100);
        priceValue.textContent = formatPrice(finalPrice);
        if (p.discount){
          const oldP = document.createElement('span');
          oldP.className = 'old-price';
          oldP.textContent = formatPrice(p.price);
          priceP.appendChild(oldP);
        }
        priceP.appendChild(priceValue);

        const actions = document.createElement('div');
        actions.style.display = 'flex'; actions.style.justifyContent = 'space-between'; actions.style.alignItems = 'center'; actions.style.marginTop = '6px';
        const addBtn = document.createElement('button');
        addBtn.className = 'btn';
        addBtn.textContent = 'Add';
        addBtn.setAttribute('aria-label', 'Add to cart');
        addBtn.addEventListener('click', ()=>{ addToCart(p, 1); });

        // small rating indicator
        const rating = document.createElement('span');
        rating.style.fontSize = '12px';
        rating.style.color = '#ffd896';
        rating.textContent = '★'.repeat(Math.round(p.rating));

        const ratingWrap = document.createElement('span');
        ratingWrap.style.display = 'inline-flex'; ratingWrap.style.alignItems = 'center'; ratingWrap.style.gap = '6px';
        ratingWrap.appendChild(rating);
        ratingWrap.appendChild(document.createTextNode(` ${p.rating.toFixed(1)} (${p.reviews})`));

        actions.appendChild(addBtn);
        actions.appendChild(ratingWrap);

        body.appendChild(nameEl);
        body.appendChild(taglineEl);
        body.appendChild(priceP);
        body.appendChild(actions);

        card.appendChild(thumb);
        card.appendChild(body);
        wrap.appendChild(card);
      });
      // update counts
      document.getElementById(containerId).querySelectorAll('.card') // purely to trigger reflow if needed
    }

    function renderAllCounts(){
      // counts by section
      const shopCount = productsRaw.filter(p => p.sections.includes('shop')).length;
      const occasionsCount = productsRaw.filter(p => p.sections.includes('occasions')).length;
      const bestsellersCount = productsRaw.filter(p => p.sections.includes('bestsellers')).length;
      document.getElementById('shop-count').textContent = shopCount + ' ' + (shopCount === 1 ? 'item' : 'items');
      document.getElementById('occasions-count').textContent = occasionsCount + ' ' + (occasionsCount === 1 ? 'item' : 'items');
      document.getElementById('bestsellers-count').textContent = bestsellersCount + ' ' + (bestsellersCount === 1 ? 'item' : 'items');
    }

    function renderShop(){
      const list = applyFiltersToList(productsRaw.filter(p => p.sections.includes('shop')));
      const sorted = sortList(list);
      renderGrid('shop-grid', sorted);
      document.getElementById('shop-count').textContent = sorted.length + ' ' + (sorted.length === 1 ? 'item' : 'items');
    }
    function renderOccasions(){
      const list = applyFiltersToList(productsRaw.filter(p => p.sections.includes('occasions')));
      const sorted = sortList(list);
      renderGrid('occasions-grid', sorted);
      document.getElementById('occasions-count').textContent = sorted.length + ' ' + (sorted.length === 1 ? 'item' : 'items');
    }
    function renderBestsellers(){
      const list = applyFiltersToList(productsRaw.filter(p => p.sections.includes('bestsellers')));
      const sorted = sortList(list);
      renderGrid('bestsellers-grid', sorted);
      document.getElementById('bestsellers-count').textContent = sorted.length + ' ' + (sorted.length === 1 ? 'item' : 'items');
    }

    function renderAll(){
      renderShop();
      renderOccasions();
      renderBestsellers();
      // Update translations for text nodes
      renderTexts();
    }

    // Cart
    function addToCart(product, qty){
      if (!cart[product.id]){
        cart[product.id] = { product: product, qty: 0 };
      }
      cart[product.id].qty += qty;
      renderCart();
      showCart();
    }
    function removeFromCart(id){
      delete cart[id];
      renderCart();
    }
    function setQty(id, qty){
      if (!cart[id]) return;
      cart[id].qty = Math.max(0, qty);
      if (cart[id].qty === 0) delete cart[id];
      renderCart();
    }
    function cartSubtotal(){
      let sum = 0;
      for (const id in cart){
        const c = cart[id];
        const price = c.product.price * (1 - (c.product.discount||0)/100);
        sum += price * c.qty;
      }
      return sum;
    }
    function renderCart(){
      const container = document.getElementById('cart-items');
      container.innerHTML = '';
      const keys = Object.keys(cart);
      if (keys.length === 0){
        document.getElementById('cart-empty').style.display = 'block';
        document.getElementById('cart-subtotal-value').textContent = '$0.00';
        return;
      }
      document.getElementById('cart-empty').style.display = 'none';
      keys.forEach(id => {
        const item = cart[id];
        const row = document.createElement('div');
        row.className = 'cart-row';
        // thumbnail
        const thumb = document.createElement('div');
        thumb.className = 'cart-thumb';
        thumb.textContent = item.product.emoji;
        // details
        const info = document.createElement('div');
        info.style.display = 'flex'; info.style.flexDirection = 'column';
        const N = document.createElement('span');
        N.style.fontSize = '14px';
        N.textContent = item.product.name;
        const sub = document.createElement('span');
        sub.style.fontSize = '12px';
        sub.style.color = '#ddd';
        sub.textContent = item.product.tagline;
        // quantity controls
        const ctrl = document.createElement('div');
        ctrl.style.display = 'flex'; ctrl.style.alignItems = 'center'; ctrl.style.gap = '6px';
        const dec = document.createElement('button'); dec.className='btn'; dec.textContent='-'; dec.style.width='28px';
        dec.addEventListener('click', ()=>{ setQty(id, item.qty - 1); });
        const q = document.createElement('input'); q.type='number'; q.value=item.qty; q.className='qty';
        q.min = 0; q.addEventListener('change', ()=>{ setQty(id, Number(q.value)); });
        const inc = document.createElement('button'); inc.className='btn'; inc.textContent='+'; inc.style.width='28px';
        inc.addEventListener('click', ()=>{ setQty(id, item.qty + 1); });

        const price = document.createElement('span');
        price.style.marginLeft = 'auto';
        const finalPrice = item.product.price * (1 - (item.product.discount||0)/100);
        price.textContent = formatPrice(finalPrice * item.qty);

        ctrl.appendChild(dec); ctrl.appendChild(q); ctrl.appendChild(inc);

        info.appendChild(N); info.appendChild(sub); info.appendChild(ctrl);
        row.appendChild(thumb); row.appendChild(info); row.appendChild(price);
        container.appendChild(row);

        // update on qty change
        q.addEventListener('change', ()=>{
          price.textContent = formatPrice(finalPrice * Number(q.value));
          document.getElementById('cart-subtotal-value').textContent = formatPrice(cartSubtotal());
        });
      });
      document.getElementById('cart-subtotal-value').textContent = formatPrice(cartSubtotal());
    }

    // Cart UI toggling
    function showCart(){
      const drawer = document.getElementById('cart-drawer');
      drawer.classList.add('open');
      drawer.setAttribute('aria-hidden','false');
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('overlay').setAttribute('aria-hidden','false');
    }
    function hideCart(){
      const drawer = document.getElementById('cart-drawer');
      drawer.classList.remove('open');
      drawer.setAttribute('aria-hidden','true');
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('overlay').setAttribute('aria-hidden','true');
    }

    // Chat interactions
    function appendChatBot(text){
      const chat = document.getElementById('chat-content');
      const msg = document.createElement('div');
      msg.className = 'message bot';
      msg.textContent = text;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    // Text translation updates
    function renderTexts(){
      // Update nav labels
      document.querySelectorAll('[data-i18n-key]').forEach(el => {
        const key = el.getAttribute('data-i18n-key');
        if (key){
          el.textContent = t(key);
        }
      });
      // Buttons/labels that may not be in data-i18n-key map
      document.getElementById('cart-title').textContent = t('cartTitle');
      document.getElementById('checkout').textContent = t('checkout');
      document.getElementById('live-region').textContent = '';
      // About intro
      // footer language hint
      document.getElementById('footer-lang-note').textContent = 'Lang: ' + currentLang.toUpperCase();
    }

    // Initialize UI and event handlers
    function initUI(){
      // Fill filter category choices from shop list
      const catSet = new Set();
      productsRaw.filter(p => p.sections.includes('shop')).forEach(p => catSet.add(p.category));
      const filterCategory = document.getElementById('filter-category');
      catSet.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        filterCategory.appendChild(opt);
      });

      // Populate language change
      document.getElementById('lang').value = currentLang;
      document.getElementById('lang').addEventListener('change', (e)=>{
        currentLang = e.target.value;
        renderTexts();
        // Re-render with current filters (translations only)
        renderAll();
        document.getElementById('live-region').textContent = 'Language changed';
        setTimeout(()=>{ document.getElementById('live-region').textContent = ''; }, 1500);
      });

      // Cart open/close
      document.getElementById('open-cart').addEventListener('click', ()=>{ showCart(); });
      document.getElementById('close-cart').addEventListener('click', ()=>{ hideCart(); });
      document.getElementById('overlay').addEventListener('click', ()=>{ hideCart(); });<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FloraFlow Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* FloraFlow Theme: dark purple gradient with lavender accents */
    :root{
      --bg: #0b0720;
      --bg2: #1a0c2a;
      --card: #141027;
      --text: #e9e1f9;
      --muted: #c8b8e6;
      --accent1: #a78bfa; /* lavender */
      --accent2: #4c1d95; /* violet */
      --ring: rgba(167,139,250,.5);
      --green: #34d399;
      --shadow: 0 10px 25px rgba(0,0,0,.25);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, #2a0a30 0%, #1a0b28 40%, #120c20 100%), #0b0720;
      background-attachment: fixed;
    }

    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus {
      position: static;
      width: auto;
      height: auto;
      padding: 8px 12px;
      background: #222;
      color: #fff;
      border-radius: 4px;
      z-index: 1000;
    }

    /* Layout */
    .site {
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      min-height: 100%;
    }

    header.site-header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(10,6,20,.9);
      backdrop-filter: saturate(1.2) blur(4px);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
    }
    .brand .logo {
      width: 34px; height: 34px;
      border-radius: 8px;
      display: inline-flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #a78bfa 0%, #4c1d95 100%);
      color: white; font-weight: bold;
    }
    .brand .name { font-family: "Times New Roman", serif; font-size: 1.25rem; letter-spacing: .5px; }
    nav.main-nav {
      display: flex; gap: 8px; align-items: center;
      padding: 0 20px 12px;
    }
    nav.main-nav a {
      color: #e9e1f9; text-decoration: none; padding: 10px 12px; border-radius: 6px;
    }
    nav.main-nav a[aria-current="page"] { background: rgba(167,139,250,.25); }
    .toolbar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 20px 16px;
      gap: 12px;
    }
    .btn {
      background: #2a1747;
      color: #fff;
      border: 1px solid rgba(167,139,250,.4);
      padding: 10px 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: transform .15s ease, background .2s;
    }
    .btn.secondary {
      background: transparent;
      border: 1px solid rgba(167,139,250,.6);
    }
    .btn:hover { transform: translateY(-1px); background: #2e1a56; }
    .btn.primary { background: linear-gradient(135deg, #a78bfa 0%, #4c1d95 100%); border: none; color: white; }
    .btn.icon { padding: 8px; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; }

    .lang-select { background: rgba(255,255,255,.08); color: #fff; border: 1px solid rgba(255,255,255,.25); border-radius: 6px; padding: 6px 8px; }

    main { padding: 20px; }

    section { margin: 28px 0; }
    section h2 {
      font-family: "Times New Roman", serif;
      font-size: 1.75rem;
      margin: 0 0 12px;
      color: #e7e2f8;
    }

    /* Filters bar */
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      align-items: end;
      padding: 8px 0 12px;
    }
    .field { display: grid; gap: 6px; }
    label { font-size: 12px; color: var(--muted); }
    select, input[type="number"] {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.05);
      color: #fff;
    }
    @media (max-width: 900px){
      .filters { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
    }

    /* Grid cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 14px;
    }
    .card {
      background: rgba(16,8,32,.6);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-rows: 150px 1fr;
      transition: transform .2s ease;
    }
    .card:hover { transform: translateY(-4px); }
    .thumb {
      position: relative;
      width: 100%; height: 150px;
      display: grid; place-items: center;
      background: #111;
    }
    .thumb-emoji { font-size: 64px; }
    .thumb-img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .skeleton {
      position: absolute; inset: 0;
      background: linear-gradient(-90deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.16) 50%, rgba(255,255,255,.08) 100%);
      background-size: 400% 400%;
      animation: shimmer 1.2s ease-in-out infinite;
      z-index: 1;
    }
    @keyframes shimmer { 0% { transform: translateX(-100%);} 100% { transform: translateX(100%);} }

    .card-body { padding: 12px 12px 14px; display: grid; gap: 6px; }
    .name { font-family: "Times New Roman", serif; font-size: 1rem; margin: 0; }
    .tagline { font-size: 12px; color: #d9d1ee; margin: 0; }
    .price { font-weight: bold; }
    .old-price { text-decoration: line-through; color: #c7b8e3; font-size: 12px; margin-left: 6px; }

    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 8px; border-radius: 999px;
      background: rgba(167,139,250,.25);
      font-size: 12px;
      color: #eae2ff;
    }

    /* Sections layout helpers (inline section headers with counts) */
    .section-header {
      display: flex; justify-content: space-between; align-items: baseline;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      margin-bottom: 6px;
    }

    /* Cart Drawer */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.5);
      display: none;
      z-index: 60;
    }
    .drawer {
      position: fixed;
      top: 0; right: 0;
      width: 360px; max-width: 96vw;
      height: 100%;
      background: #1a1142;
      border-left: 1px solid rgba(255,255,255,.15);
      box-shadow: -6px 0 20px rgba(0,0,0,.4);
      transform: translateX(100%);
      transition: transform .25s ease;
      z-index: 70;
      display: flex; flex-direction: column;
    }
    .drawer.open { transform: translateX(0%); }
    .drawer header { padding: 14px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,.1); }
    .drawer .cart-items { padding: 12px; overflow: auto; flex: 1; display: grid; gap: 12px; }
    .cart-row { display: grid; grid-template-columns: 48px 1fr auto; gap: 8px; align-items: center; }
    .cart-thumb { width: 48px; height: 48px; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; font-size: 22px; background: rgba(255,255,255,.08); }
    .qty { width: 60px; padding: 6px; border-radius: 6px; border: 1px solid rgba(255,255,255,.25); text-align: center; background: rgba(0,0,0,.2); color: #fff; }
    .cart-footer { padding: 12px; border-top: 1px solid rgba(255,255,255,.1); }
    .cart-total { display:flex; justify-content: space-between; align-items: center; font-weight: bold; padding: 8px 0; }
    .empty { text-align: center; color: #c9b7e3; padding: 20px; }

    /* Chat Widget */
    .chat-toggle {
      position: fixed; right: 20px; bottom: 20px;
      z-index: 60;
      width: 56px; height: 56px; border-radius: 50%;
      background: linear-gradient(135deg, #a78bfa, #4c1d95);
      border: none; cursor: pointer; font-size: 22px;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
    }
    .chat-panel {
      position: fixed; right: 20px; bottom: 88px;
      width: 320px; max-width: 90vw; height: 420px;
      background: #1b1038; border: 1px solid rgba(255,255,255,.15);
      border-radius: 14px; display: flex; flex-direction: column; z-index: 65;
      overflow: hidden;
      box-shadow: 0 10px 28px rgba(0,0,0,.4);
    }
    .chat-header { padding: 12px; border-bottom: 1px solid rgba(255,255,255,.15); display:flex; justify-content:space-between; align-items:center; }
    .chat-content { padding: 12px; overflow: auto; flex: 1; display: grid; gap: 8px; }
    .message { max-width: 78%; padding: 8px 10px; border-radius: 10px; }
    .me { background: rgba(167,139,250,.4); justify-self: end; }
    .bot { background: rgba(255,255,255,.08); }
    .chat-input { display: flex; padding: 8px; border-top: 1px solid rgba(255,255,255,.15); }
    .chat-input input { flex: 1; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,.3); background: rgba(0,0,0,.2); color: #fff; }
    .chat-input button { margin-left: 6px; }

    /* About / Contact content polish */
    .card p { margin: 0; color: #ddd; line-height: 1.5; }
    .container { max-width: 1200px; margin: 0 auto; }

    /* Footer */
    footer.site-footer { padding: 28px 20px; text-align: center; color: #bfb5d9; border-top: 1px solid rgba(255,255,255,.1); }

    @media (max-width: 900px){
      .thumb { height: 120px; }
      .thumb-emoji { font-size: 54px; }
      .drawer { width: 100%; max-width: 100%; }
      .chat-panel { width: calc(100% - 40px); right: 20px; bottom: 90px; }
    }
  </style>
</head>
<body>
  <a href="#content" class="skip-link" aria-label="Skip to content">Skip to content</a>

  <div class="site" id="app-root">
    <!-- Header -->
    <header class="site-header" role="banner">
      <div class="brand" aria-label="FloraFlow brand">
        <div class="logo" aria-hidden="true">FF</div>
        <div class="name" id="brand-name">FloraFlow</div>
        <span aria-hidden="true" style="flex:1"></span>
        <select id="lang" class="lang-select" aria-label="Language switcher">
          <option value="en">EN</option>
          <option value="es">ES</option>
          <option value="fr">FR</option>
          <option value="de">DE</option>
        </select>
      </div>
      <nav class="main-nav" aria-label="Main navigation">
        <a href="#shop" data-i18n-key="navShop" aria-label="Shop section" id="nav-shop">Shop</a>
        <a href="#occasions" data-i18n-key="navOccasions" aria-label="Occasions section" id="nav-occasions">Occasions</a>
        <a href="#bestsellers" data-i18n-key="navBestsellers" aria-label="Bestsellers section" id="nav-bestsellers">Bestsellers</a>
        <a href="#about" data-i18n-key="navAbout" aria-label="About section" id="nav-about">About</a>
        <a href="#contact" data-i18n-key="navContact" aria-label="Contact section" id="nav-contact">Contact</a>
        <button class="btn" id="open-cart" aria-label="Open cart" title="Cart">
          🛒 Cart
        </button>
      </nav>
    </header>

    <!-- Sub-toolbar: quick actions -->
    <div class="toolbar container" aria-label="Toolbar">
      <div style="display:flex; align-items:center; gap:12px;">
        <span id="filters-label" data-i18n-key="filterLabel" style="font-weight:600; letter-spacing:.3px;"></span>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <span style="font-size:12px; color:#cbd5e1;" aria-live="polite" id="live-region"></span>
      </div>
    </div>

    <main id="content" class="container" role="main" aria-label="Main content">
      <!-- Filters -->
      <section aria-labelledby="filters-title" class="filters" id="filters-section" aria-label="Filters">
        <div class="field">
          <label id="filters-category-label" for="filter-category" data-i18n-key="category">Category</label>
          <select id="filter-category" aria-labelledby="filters-category-label" title="Category filter">
            <option value="All" data-i18n-exclude>All</option>
            <!-- dynamic categories filled by script -->
          </select>
        </div>
        <div class="field">
          <label id="filters-occasion-label" for="filter-occasion" data-i18n-key="occasion">Occasion</label>
          <select id="filter-occasion" aria-labelledby="filters-occasion-label" title="Occasion filter">
            <option value="All" data-i18n-exclude>All</option>
            <option value="Romance">Romance</option>
            <option value="Birthday">Birthday</option>
            <option value="Anniversary">Anniversary</option>
            <option value="Thank You">Thank You</option>
          </select>
        </div>
        <div class="field">
          <label id="filters-color-label" for="filter-color" data-i18n-key="color">Color</label>
          <select id="filter-color" aria-labelledby="filters-color-label" title="Color filter">
            <option value="All" data-i18n-exclude>All</option>
            <option value="Purple">Purple</option>
            <option value="Red">Red</option>
            <option value="Pink">Pink</option>
            <option value="Yellow">Yellow</option>
            <option value="White">White</option>
          </select>
        </div>
        <div class="field">
          <label id="filters-price-label" for="filter-min" data-i18n-key="price">Price</label>
          <div style="display:flex; gap:6px;">
            <input id="filter-min" type="number" placeholder="Min" min="0" style="width:100px;">
            <input id="filter-max" type="number" placeholder="Max" min="0" style="width:100px;">
          </div>
        </div>
        <div class="field">
          <label id="filters-sort-label" for="sort-by" data-i18n-key="sortBy">Sort By</label>
          <select id="sort-by" aria-labelledby="filters-sort-label" title="Sort items">
            <option value="default" data-i18n-exclude>Default</option>
            <option value="price-asc" data-i18n-key="sortPriceAsc" data-i18n-attr="textContent">Price: Low to High</option>
            <option value="price-desc" data-i18n-key="sortPriceDesc" data-i18n-attr="textContent">Price: High to Low</option>
            <option value="rating-desc" data-i18n-key="sortRating" data-i18n-attr="textContent">Rating</option>
          </select>
        </div>
        <div class="field" style="align-self:end;">
          <button class="btn" id="clear-filters" aria-label="Clear filters" title="Clear filters" data-i18n-key="clearFilters">Clear Filters</button>
        </div>
      </section>

      <!-- Shop -->
      <section aria-labelledby="shop-title" id="shop" class="shop-section">
        <div class="section-header">
          <h2 id="shop-title" data-i18n-key="shopTitle" style="margin:0;">Shop</h2>
          <span class="badge" aria-label="Shop count" id="shop-count">0 items</span>
        </div>
        <div id="shop-grid" class="grid" role="grid" aria-label="Shop products"></div>
      </section>

      <!-- Occasions -->
      <section aria-labelledby="occasions-title" id="occasions" class="occasions-section">
        <div class="section-header">
          <h2 id="occasions-title" data-i18n-key="occasionsTitle" style="margin:0;">Occasions</h2>
          <span class="badge" aria-label="Occasions count" id="occasions-count">0 items</span>
        </div>
        <div id="occasions-grid" class="grid" role="grid" aria-label="Occasions products"></div>
      </section>

      <!-- Bestsellers -->
      <section aria-labelledby="bestsellers-title" id="bestsellers" class="bestsellers-section">
        <div class="section-header">
          <h2 id="bestsellers-title" data-i18n-key="bestsellersTitle" style="margin:0;">Bestsellers</h2>
          <span class="badge" aria-label="Bestsellers count" id="bestsellers-count">0 items</span>
        </div>
        <div id="bestsellers-grid" class="grid" role="grid" aria-label="Bestsellers products"></div>
      </section>

      <!-- About -->
      <section id="about" aria-labelledby="about-title" class="about-section">
        <h2 id="about-title" data-i18n-key="aboutTitle" style="margin:0;">About FloraFlow</h2>
        <div class="card" style="margin-top:12px;">
          <div class="thumb" aria-label="Brand image" style="height:180px;">
            <div class="skeleton" aria-hidden="true"></div>
            <div class="thumb-emoji" style="font-size:72px;">🌸</div>
          </div>
          <div class="card-body" style="gap:8px;">
            <p id="about-intro" aria-label="About intro"><span data-i18n-key="aboutIntro">FloraFlow crafts premium floral experiences with a lavender to violet gradient aesthetic, blending timeless serif headings with modern sans-serif UI. This demo showcases a multi-language, filterable catalog with emoji-first visuals that swap to generated images when loaded.</span></p>
          </div>
        </div>
      </section>

      <!-- Contact -->
      <section id="contact" aria-labelledby="contact-title" class="contact-section">
        <h2 id="contact-title" data-i18n-key="contactTitle" style="margin:0;">Contact</h2>
        <form id="contact-form" class="card" style="margin-top:12px;" novalidate aria-label="Contact form">
          <div class="card-body" style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
            <div class="field" style="grid-column: span 2;">
              <label for="name" data-i18n-key="name" aria-label="Your name">Name</label>
              <input id="name" name="name" type="text" required placeholder="Your name" />
            </div>
            <div class="field" style="grid-column: span 2;">
              <label for="email" data-i18n-key="email" aria-label="Your email">Email</label>
              <input id="email" name="email" type="email" required placeholder="you@example.com" />
            </div>
            <div class="field" style="grid-column: span 2;">
              <label for="message" data-i18n-key="message" aria-label="Message">Message</label>
              <textarea id="message" name="message" rows="4" required placeholder="Your message..." style="resize: vertical;"></textarea>
            </div>
          </div>
          <div class="cart-footer" style="padding:12px;">
            <button class="btn primary" id="submit-contact" aria-label="Submit message" data-i18n-key="submit">Submit</button>
            <span id="form-status" aria-live="polite" style="margin-left:12px;"></span>
          </div>
        </form>
      </section>
    </main>

    <!-- Cart Drawer -->
    <div class="overlay" id="overlay" aria-hidden="true"></div>
    <aside class="drawer" id="cart-drawer" aria-label="Cart Drawer" aria-hidden="true" role="dialog" aria-modal="true" >
      <header>
        <strong data-i18n-key="cartTitle" id="cart-title">Your Cart</strong>
        <button class="btn" id="close-cart" aria-label="Close cart">✖</button>
      </header>
      <div class="cart-items" id="cart-items" aria-live="polite">
        <div class="empty" id="cart-empty" style="display:block;">Your cart is empty.</div>
      </div>
      <div class="cart-footer">
        <div class="cart-total" id="cart-subtotal">
          <span data-i18n-key="subtotal" id="cart-subtotal-label">Subtotal</span>
          <span id="cart-subtotal-value">$0.00</span>
        </div>
        <button class="btn primary" id="checkout" aria-label="Checkout" style="width:100%;">Checkout</button>
      </div>
    </aside>

    <!-- Overlaying Chat Widget -->
    <button class="chat-toggle" id="open-chat" aria-label="Open chat" title="Chat">💬</button>
    <section class="chat-panel" id="chat-panel" aria-label="Chat" hidden>
      <div class="chat-header">
        <strong>FloraFlow Bot</strong>
        <button class="btn" id="close-chat" aria-label="Close chat" title="Close">✖</button>
      </div>
      <div class="chat-content" id="chat-content" aria-live="polite">
        <div class="message bot" style="justify-self:flex-start;">Hi there! Need floral inspiration or help with filters?</div>
        <div class="message bot" style="justify-self:flex-start;">Tip: Try the Occasion and Color filters to discover combos.</div>
      </div>
      <div class="chat-input" aria-label="Chat input">
        <input id="chat-input" placeholder="Message..." autocomplete="off" />
        <button class="btn" id="send-chat" aria-label="Send message">Send</button>
      </div>
    </section>

    <footer class="site-footer" role="contentinfo">
      <span>&copy; FloraFlow Demo</span> •
      <span id="footer-lang-note" aria-live="polite"></span>
    </footer>
  </div>

  <script>
    // Data and translations
    const colorHex = {
      Purple: '#8b5cf6',
      Red: '#f87171',
      Pink: '#f472b6',
      Yellow: '#f59e0b',
      White: '#e5e7eb',
      Orange: '#f97316',
      Blue: '#60a5fa',
    };

    // Translations (EN default; fallback to EN if missing)
    const translations = {
      en: {
        navShop: 'Shop',
        navOccasions: 'Occasions',
        navBestsellers: 'Bestsellers',
        navAbout: 'About',
        navContact: 'Contact',
        filterLabel: 'Filters',
        category: 'Category',
        occasion: 'Occasion',
        color: 'Color',
        price: 'Price',
        sortBy: 'Sort By',
        clearFilters: 'Clear Filters',
        shopTitle: 'Shop',
        occasionsTitle: 'Occasions',
        bestsellersTitle: 'Bestsellers',
        aboutTitle: 'About FloraFlow',
        contactTitle: 'Contact',
        cartTitle: 'Your Cart',
        subtotal: 'Subtotal',
        checkout: 'Checkout',
        language: 'Language',
        name: 'Name',
        email: 'Email',
        message: 'Message',
        submit: 'Submit',
        thankYou: 'Thank you! Your message has been sent.',
        sortPriceAsc: 'Price: Low to High',
        sortPriceDesc: 'Price: High to Low',
        sortRating: 'Rating',
        cartCount: 'items',
        shopCount: 'items',
        occasionsCount: 'items',
        bestsellersCount: 'items',
        aboutIntro: 'FloraFlow crafts premium floral experiences with a lavender to violet gradient aesthetic.',
      },
      es: {
        navShop: 'Tienda',
        navOccasions: 'Ocasiones',
        navBestsellers: 'Más vendidos',
        navAbout: 'Acerca de',
        navContact: 'Contacto',
        filterLabel: 'Filtros',
        category: 'Categoría',
        occasion: 'Ocasión',
        color: 'Color',
        price: 'Precio',
        sortBy: 'Ordenar por',
        clearFilters: 'Limpiar filtros',
        shopTitle: 'Tienda',
        occasionsTitle: 'Ocasiones',
        bestsellersTitle: 'Más vendidos',
        aboutTitle: 'Acerca de FloraFlow',
        contactTitle: 'Contacto',
        cartTitle: 'Carrito',
        subtotal: 'Subtotal',
        checkout: 'Pagar',
        language: 'Idioma',
        name: 'Nombre',
        email: 'Correo',
        message: 'Mensaje',
        submit: 'Enviar',
        thankYou: '¡Gracias! Su mensaje ha sido enviado.',
        sortPriceAsc: 'Precio: menor a mayor',
        sortPriceDesc: 'Precio: mayor a menor',
        sortRating: 'Calificación',
        cartCount: 'artículos',
        shopCount: 'artículos',
        occasionsCount: 'artículos',
        bestsellersCount: 'artículos',
        aboutIntro: 'FloraFlow crea experiencias florales premium con una estética de gradiente lavanda a violeta.',
      },
      fr: {
        navShop: 'Boutique',
        navOccasions: 'Occasions',
        navBestsellers: 'Meilleures ventes',
        navAbout: 'À propos',
        navContact: 'Contact',
        filterLabel: 'Filtres',
        category: 'Catégorie',
        occasion: 'Occasion',
        color: 'Couleur',
        price: 'Prix',
        sortBy: 'Trier par',
        clearFilters: 'Effacer les filtres',
        shopTitle: 'Boutique',
        occasionsTitle: 'Occasions',
        bestsellersTitle: 'Meilleures ventes',
        aboutTitle: 'À propos de FloraFlow',
        contactTitle: 'Contact',
        cartTitle: 'Votre panier',
        subtotal: 'Sous-total',
        checkout: 'Passer à la caisse',
        language: 'Langue',
        name: 'Nom',
        email: 'Email',
        message: 'Message',
        submit: 'Envoyer',
        thankYou: 'Merci! Votre message a été envoyé.',
        sortPriceAsc: 'Prix croissant',
        sortPriceDesc: 'Prix décroissant',
        sortRating: 'Note',
        cartCount: 'articles',
        shopCount: 'articles',
        occasionsCount: 'articles',
        bestsellersCount: 'articles',
        aboutIntro: "FloraFlow conçoit des expériences florales premium avec un dégradé lavande à violet.",
      },
      de: {
        navShop: 'Shop',
        navOccasions: 'Anlässe',
        navBestsellers: 'Bestseller',
        navAbout: 'Über uns',
        navContact: 'Kontakt',
        filterLabel: 'Filter',
        category: 'Kategorie',
        occasion: 'Anlass',
        color: 'Farbe',
        price: 'Preis',
        sortBy: 'Sortieren nach',
        clearFilters: 'Filter löschen',
        shopTitle: 'Shop',
        occasionsTitle: 'Anlässe',
        bestsellersTitle: 'Bestseller',
        aboutTitle: 'Über FloraFlow',
        contactTitle: 'Kontakt',
        cartTitle: 'Warenkorb',
        subtotal: 'Zwischensumme',
        checkout: 'Zur Kasse',
        language: 'Sprache',
        name: 'Name',
        email: 'E-Mail',
        message: 'Nachricht',
        submit: 'Senden',
        thankYou: 'Danke! Ihre Nachricht wurde gesendet.',
        sortPriceAsc: 'Preis aufsteigend',
        sortPriceDesc: 'Preis absteigend',
        sortRating: 'Bewertung',
        cartCount: 'artikel',
        shopCount: 'artikel',
        occasionsCount: 'artikel',
        bestsellersCount: 'artikel',
        aboutIntro: 'FloraFlow gestaltet florale Erlebnisse mit einem ästhetischen Gradienten von Lavendel zu Violett.',
      }
    };

    // Data: 12 Shop items, 4 Occasions items, 4 Bestsellers (unique items)
    const productsRaw = [
      // Shop
      { id: 's1', name: 'Lavender Bliss Bouquet', tagline: 'Soft petals, bold scent', emoji:'💐', imageUrl:null, color:'Purple', category:'Bouquet', price:28, discount:10, rating:4.6, reviews:128, sections:['shop'], occasion:'None' },
      { id: 's2', name: 'Rose Garden Bundle', tagline: 'Classic reds, timeless romance', emoji:'🌹', imageUrl:null, color:'Red', category:'Bouquet', price:32, discount:0, rating:4.8, reviews:210, sections:['shop'], occasion:'Romance' },
      { id: 's3', name: 'Sunlit Meadow', tagline: 'Golden sunflowers burst', emoji:'🌻', imageUrl:null, color:'Yellow', category:'Bouquet', price:26, discount:5, rating:4.5, reviews:98, sections:['shop'], occasion:'Birthday' },
      { id: 's4', name: 'Velvet Night Bouquet', tagline:'Deep purples and velvety petals', emoji:'🥀', imageUrl:null, color:'Purple', category:'Bouquet', price:30, discount:15, rating:4.4, reviews:77, sections:['shop'], occasion:'Anniversary' },
      { id: 's5', name: 'Petal Poetry', tagline:'Soft, poetic pinks', emoji:'🌸', imageUrl:null, color:'Pink', category:'Bouquet', price:22, discount:0, rating:4.2, reviews:64, sections:['shop'], occasion:'None' },
      { id: 's6', name: 'Midnight Orchid', tagline:'Mystic purple hues', emoji:'🪷', imageUrl:null, color:'Purple', category:'Orchid', price:34, discount:0, rating:4.7, reviews:89, sections:['shop'], occasion:'Romance' },
      { id: 's7', name: 'Bloom Whisper', tagline:'Delicate pink tones', emoji:'🌷', imageUrl:null, color:'Pink', category:'Bouquet', price:20, discount:0, rating:4.1, reviews:52, sections:['shop'], occasion:'None' },
      { id: 's8', name: 'Twilight Lavender', tagline:'Lavender dusk hues', emoji:'🌙', imageUrl:null, color:'Purple', category:'Bouquet', price:29, discount:5, rating:4.3, reviews:67, sections:['shop'], occasion:'Birthday' },
      { id: 's9', name: 'Ember Rose Basket', tagline:'Cozy reds in a basket', emoji:'🌹', imageUrl:null, color:'Red', category:'Basket', price:27, discount:10, rating:4.5, reviews:88, sections:['shop'], occasion:'Anniversary' },
      { id: 's10', name: 'Violet Dream', tagline:'Dreamy purple glow', emoji:'💜', imageUrl:null, color:'Purple', category:'Bouquet', price:25, discount:0, rating:4.0, reviews:41, sections:['shop'], occasion:'None' },
      { id: 's11', name: 'Floral Cascade', tagline:'Cascade of fresh blooms', emoji:'🌼', imageUrl:null, color:'Yellow', category:'Bouquet', price:33, discount:0, rating:4.6, reviews:120, sections:['shop'], occasion:'Anniversary' },
      { id: 's12', name: 'Petals & Pearls', tagline:'Elegant white petals', emoji:'💮', imageUrl:null, color:'White', category:'Bouquet', price:24, discount:0, rating:4.3, reviews:88, sections:['shop'], occasion:'Thank You' },
      // Occasions (4)
      { id: 'o1', name: 'Romantic Evening Bundle', tagline:'Romance in full bloom', emoji:'💖', imageUrl:null, color:'Pink', category:'Occasion', price:39, discount:0, rating:4.9, reviews:320, sections:['occasions'], occasion:'Romance' },
      { id: 'o2', name: 'Birthday Surprise', tagline:'Colorful celebrations', emoji:'🎁', imageUrl:null, color:'Yellow', category:'Occasion', price:29, discount:0, rating:4.6, reviews:210, sections:['occasions'], occasion:'Birthday' },
      { id: 'o3', name: 'Anniversary Glow', tagline:'Forever starts here', emoji:'💎', imageUrl:null, color:'Purple', category:'Occasion', price:45, discount:0, rating:4.8, reviews:180, sections:['occasions'], occasion:'Anniversary' },
      { id: 'o4', name: 'Thank You Notes', tagline:'Gratitude in petals', emoji:'🙏', imageUrl:null, color:'Purple', category:'Occasion', price:22, discount:0, rating:4.4, reviews:95, sections:['occasions'], occasion:'Thank You' },
      // Bestsellers (4)
      { id: 'b1', name: 'Garden Favorite', tagline:'Loved by many', emoji:'🌷', imageUrl:null, color:'Pink', category:'Bouquet', price:26, discount:0, rating:4.7, reviews:410, sections:['bestsellers'], occasion:'None' },
      { id: 'b2', name: 'Forever Red', tagline:'Classic and bold', emoji:'🌹', imageUrl:null, color:'Red', category:'Bouquet', price:34, discount:0, rating:4.8, reviews:390, sections:['bestsellers'], occasion:'None' },
      { id: 'b3', name: 'Lemon Sunshine', tagline:'Bright and cheerful', emoji:'🍋', imageUrl:null, color:'Yellow', category:'Bouquet', price:24, discount:0, rating:4.5, reviews:210, sections:['bestsellers'], occasion:'None' },
      { id: 'b4', name: 'Purple Dream', tagline:'Lavender whispers', emoji:'💜', imageUrl:null, color:'Purple', category:'Bouquet', price:28, discount:0, rating:4.6, reviews:190, sections:['bestsellers'], occasion:'None' }
    ];

    // We'll generate data URLs for each product (SVG gradient with emoji)
    function colorToHex(colorName){
      return colorHex[colorName] || '#7c3aed';
    }
    function generateSVG(emoji, colorName){
      const w = 600, h = 400;
      const g1 = colorToHex(colorName);
      const g2 = '#000';
      const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}">
        <defs>
          <linearGradient id="grad" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="${g1}"/>
            <stop offset="100%" stop-color="${g2}"/>
          </linearGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#grad)"/>
        <text x="50%" y="54%" text-anchor="middle" font-family="Segoe UI Emoji,Apple Color Emoji,Batik,Arial" font-size="160" dy="0" fill="white" >${emoji}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    // Initialize: attach dataUrl to each product
    function initImages(){
      for (const p of productsRaw){
        p.imageUrl = generateSVG(p.emoji, p.color);
      }
    }

    // App state
    let currentLang = 'en';
    let filters = { category: 'All', occasion: 'All', color: 'All', min: null, max: null, sortBy: 'default' };
    let cart = {}; // { productId: { product, qty } }

    // Helpers
    function t(key){
      const langMap = translations[currentLang] || translations['en'];
      return langMap[key] ?? translations['en'][key] ?? key;
    }

    function formatPrice(n){
      // Use locale for currency formatting
      try{
        return new Intl.NumberFormat(currentLang, { style:'currency', currency:'USD', minimumFractionDigits: 2 }).format(n);
      }catch(e){
        return '$' + n.toFixed(2);
      }
    }

    function applyFiltersToList(list){
      const min = filters.min != null ? Number(filters.min) : null;
      const max = filters.max != null ? Number(filters.max) : null;
      const occ = filters.occasion;
      const cat = filters.category;
      const col = filters.color;

      return list.filter(p => {
        if (cat !== 'All' && p.category !== cat) return false;
        if (col !== 'All' && p.color !== col) return false;
        // price after discount
        const price = p.price * (1 - (p.discount||0)/100);
        if (min != null && price < min) return false;
        if (max != null && price > max) return false;
        if (occ !== 'All' && p.occasion !== occ) return false;
        return true;
      });
    }

    function sortList(list){
      const key = filters.sortBy;
      if (key === 'price-asc'){
        return list.slice().sort((a,b)=> (a.price*(1 - (a.discount||0)/100)) - (b.price*(1 - (b.discount||0)/100)));
      } else if (key === 'price-desc'){
        return list.slice().sort((a,b)=> (b.price*(1 - (b.discount||0)/100)) - (a.price*(1 - (a.discount||0)/100)));
      } else if (key === 'rating-desc'){
        return list.slice().sort((a,b)=> b.rating - a.rating);
      }
      return list;
    }

    // Rendering helpers
    function renderGrid(containerId, items){
      const wrap = document.getElementById(containerId);
      wrap.innerHTML = '';
      if (!items.length){
        wrap.innerHTML = '<div class="empty" style="padding:20px;">No results. <button class="btn" id="clear-filters-inline">Clear Filters</button></div>';
        document.getElementById('clear-filters-inline')?.addEventListener('click', ()=>{ resetFilters(); renderAll(); });
        return;
      }
      items.forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';
        card.role = 'article';
        // Card structure
        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        thumb.setAttribute('aria-label', p.name);

        const skeleton = document.createElement('div');
        skeleton.className = 'skeleton';
        // Emoji placeholder
        const emojiDiv = document.createElement('div');
        emojiDiv.className = 'thumb-emoji';
        emojiDiv.textContent = p.emoji;

        // Image (generated data URL)
        const img = document.createElement('img');
        img.className = 'thumb-img';
        img.alt = p.name;
        img.style.display = 'none';
        img.loading = 'lazy';
        img.src = p.imageUrl;

        // Attach load handler: swap emoji for image on success
        img.addEventListener('load', () => {
          emojiDiv.style.display = 'none';
          img.style.display = 'block';
        });
        img.addEventListener('error', () => {
          // keep emoji if image fails
        });

        thumb.appendChild(skeleton);
        thumb.appendChild(emojiDiv);
        thumb.appendChild(img);

        const body = document.createElement('div');
        body.className = 'card-body';
        const nameEl = document.createElement('div');
        nameEl.className = 'name';
        nameEl.textContent = p.name;
        const taglineEl = document.createElement('div');
        taglineEl.className = 'tagline';
        taglineEl.textContent = p.tagline;
        const priceP = document.createElement('div');
        priceP.style.display = 'flex'; priceP.style.alignItems = 'center'; priceP.style.gap = '6px';
        priceP.style.marginTop = '4px';
        const priceValue = document.createElement('span');
        priceValue.className = 'price';
        const finalPrice = p.price * (1 - (p.discount||0)/100);
        priceValue.textContent = formatPrice(finalPrice);
        if (p.discount){
          const oldP = document.createElement('span');
          oldP.className = 'old-price';
          oldP.textContent = formatPrice(p.price);
          priceP.appendChild(oldP);
        }
        priceP.appendChild(priceValue);

        const actions = document.createElement('div');
        actions.style.display = 'flex'; actions.style.justifyContent = 'space-between'; actions.style.alignItems = 'center'; actions.style.marginTop = '6px';
        const addBtn = document.createElement('button');
        addBtn.className = 'btn';
        addBtn.textContent = 'Add';
        addBtn.setAttribute('aria-label', 'Add to cart');
        addBtn.addEventListener('click', ()=>{ addToCart(p, 1); });

        // small rating indicator
        const rating = document.createElement('span');
        rating.style.fontSize = '12px';
        rating.style.color = '#ffd896';
        rating.textContent = '★'.repeat(Math.round(p.rating));

        const ratingWrap = document.createElement('span');
        ratingWrap.style.display = 'inline-flex'; ratingWrap.style.alignItems = 'center'; ratingWrap.style.gap = '6px';
        ratingWrap.appendChild(rating);
        ratingWrap.appendChild(document.createTextNode(` ${p.rating.toFixed(1)} (${p.reviews})`));

        actions.appendChild(addBtn);
        actions.appendChild(ratingWrap);

        body.appendChild(nameEl);
        body.appendChild(taglineEl);
        body.appendChild(priceP);
        body.appendChild(actions);

        card.appendChild(thumb);
        card.appendChild(body);
        wrap.appendChild(card);
      });
      // update counts (optional reflow)
    }

    function renderAllCounts(){
      // counts by section
      const shopCount = productsRaw.filter(p => p.sections.includes('shop')).length;
      const occasionsCount = productsRaw.filter(p => p.sections.includes('occasions')).length;
      const bestsellersCount = productsRaw.filter(p => p.sections.includes('bestsellers')).length;
      document.getElementById('shop-count').textContent = shopCount + ' ' + (shopCount === 1 ? 'item' : 'items');
      document.getElementById('occasions-count').textContent = occasionsCount + ' ' + (occasionsCount === 1 ? 'item' : 'items');
      document.getElementById('bestsellers-count').textContent = bestsellersCount + ' ' + (bestsellersCount === 1 ? 'item' : 'items');
    }

    function renderShop(){
      const list = applyFiltersToList(productsRaw.filter(p => p.sections.includes('shop')));
      const sorted = sortList(list);
      renderGrid('shop-grid', sorted);
      document.getElementById('shop-count').textContent = sorted.length + ' ' + (sorted.length === 1 ? 'item' : 'items');
    }
    function renderOccasions(){
      const list = applyFiltersToList(productsRaw.filter(p => p.sections.includes('occasions')));
      const sorted = sortList(list);
      renderGrid('occasions-grid', sorted);
      document.getElementById('occasions-count').textContent = sorted.length + ' ' + (sorted.length === 1 ? 'item' : 'items');
    }
    function renderBestsellers(){
      const list = applyFiltersToList(productsRaw.filter(p => p.sections.includes('bestsellers')));
      const sorted = sortList(list);
      renderGrid('bestsellers-grid', sorted);
      document.getElementById('bestsellers-count').textContent = sorted.length + ' ' + (sorted.length === 1 ? 'item' : 'items');
    }

    function renderAll(){
      renderShop();
      renderOccasions();
      renderBestsellers();
      // Update translations for text nodes
      renderTexts();
    }

    // Cart
    function addToCart(product, qty){
      if (!cart[product.id]){
        cart[product.id] = { product: product, qty: 0 };
      }
      cart[product.id].qty += qty;
      renderCart();
      showCart();
    }
    function removeFromCart(id){
      delete cart[id];
      renderCart();
    }
    function setQty(id, qty){
      if (!cart[id]) return;
      cart[id].qty = Math.max(0, qty);
      if (cart[id].qty === 0) delete cart[id];
      renderCart();
    }
    function cartSubtotal(){
      let sum = 0;
      for (const id in cart){
        const c = cart[id];
        const price = c.product.price * (1 - (c.product.discount||0)/100);
        sum += price * c.qty;
      }
      return sum;
    }
    function renderCart(){
      const container = document.getElementById('cart-items');
      container.innerHTML = '';
      const keys = Object.keys(cart);
      if (keys.length === 0){
        document.getElementById('cart-empty').style.display = 'block';
        document.getElementById('cart-subtotal-value').textContent = '$0.00';
        return;
      }
      document.getElementById('cart-empty').style.display = 'none';
      keys.forEach(id => {
        const item = cart[id];
        const row = document.createElement('div');
        row.className = 'cart-row';
        // thumbnail
        const thumb = document.createElement('div');
        thumb.className = 'cart-thumb';
        thumb.textContent = item.product.emoji;
        // details
        const info = document.createElement('div');
        info.style.display = 'flex'; info.style.flexDirection = 'column';
        const N = document.createElement('span');
        N.style.fontSize = '14px';
        N.textContent = item.product.name;
        const sub = document.createElement('span');
        sub.style.fontSize = '12px';
        sub.style.color = '#ddd';
        sub.textContent = item.product.tagline;
        // quantity controls
        const ctrl = document.createElement('div');
        ctrl.style.display = 'flex'; ctrl.style.alignItems = 'center'; ctrl.style.gap = '6px';
        const dec = document.createElement('button'); dec.className='btn'; dec.textContent='-'; dec.style.width='28px';
        dec.addEventListener('click', ()=>{ setQty(id, item.qty - 1); });
        const q = document.createElement('input'); q.type='number'; q.value=item.qty; q.className='qty';
        q.min = 0; q.addEventListener('change', ()=>{ setQty(id, Number(q.value)); });
        const inc = document.createElement('button'); inc.className='btn'; inc.textContent='+'; inc.style.width='28px';
        inc.addEventListener('click', ()=>{ setQty(id, item.qty + 1); });

        const price = document.createElement('span');
        price.style.marginLeft = 'auto';
        const finalPrice = item.product.price * (1 - (item.product.discount||0)/100);
        price.textContent = formatPrice(finalPrice * item.qty);

        ctrl.appendChild(dec); ctrl.appendChild(q); ctrl.appendChild(inc);

        info.appendChild(N); info.appendChild(sub); info.appendChild(ctrl);
        row.appendChild(thumb); row.appendChild(info); row.appendChild(price);
        container.appendChild(row);

        // update on qty change
        q.addEventListener('change', ()=>{
          price.textContent = formatPrice(finalPrice * Number(q.value));
          document.getElementById('cart-subtotal-value').textContent = formatPrice(cartSubtotal());
        });
      });
      document.getElementById('cart-subtotal-value').textContent = formatPrice(cartSubtotal());
    }

    // Cart UI toggling
    function showCart(){
      const drawer = document.getElementById('cart-drawer');
      drawer.classList.add('open');
      drawer.setAttribute('aria-hidden','false');
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('overlay').setAttribute('aria-hidden','false');
    }
    function hideCart(){
      const drawer = document.getElementById('cart-drawer');
      drawer.classList.remove('open');
      drawer.setAttribute('aria-hidden','true');
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('overlay').setAttribute('aria-hidden','true');
    }

    // Text translation updates
    function renderTexts(){
      // Update nav labels
      document.querySelectorAll('[data-i18n-key]').forEach(el => {
        const key = el.getAttribute('data-i18n-key');
        if (key){
          el.textContent = t(key);
        }
      });
      // Buttons/labels that may not be in data-i18n-key map
      document.getElementById('cart-title').textContent = t('cartTitle');
      document.getElementById('checkout').textContent = t('checkout');
      document.getElementById('live-region').textContent = '';
      // About intro
      // footer language hint
      document.getElementById('footer-lang-note').textContent = 'Lang: ' + currentLang.toUpperCase();
    }

    // Initialize UI and event handlers
    function initUI(){
      // Fill filter category choices from shop list
      const catSet = new Set();
      productsRaw.filter(p => p.sections.includes('shop')).forEach(p => catSet.add(p.category));
      const filterCategory = document.getElementById('filter-category');
      catSet.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        filterCategory.appendChild(opt);
      });

      // Populate language change
      document.getElementById('lang').value = currentLang;
      document.getElementById('lang').addEventListener('change', (e)=>{
        currentLang = e.target.value;
        renderTexts();
        // Re-render with current filters (translations only)
        renderAll();
        document.getElementById('live-region').textContent = 'Language changed';
        setTimeout(()=>{ document.getElementById('live-region').textContent = ''; }, 1500);
      });

      // Cart open/close
      document.getElementById('open-cart').addEventListener('click', ()=>{ showCart(); });
      document.getElementById('close-cart').addEventListener('click', ()=>{ hideCart(); });
      document.getElementById('overlay').addEventListener('click', ()=>{ hideCart(); });

      // Filters wiring
      document.getElementById('filter-category').addEventListener('change', (e)=>{ filters.category = e.target.value; renderAll(); });
      document.getElementById('filter-occasion').addEventListener('change', (e)=>{ filters.occasion = e.target.value; renderAll(); });
      document.getElementById('filter-color').addEventListener('change', (e)=>{ filters.color = e.target.value; renderAll(); });
      document.getElementById('filter-min').addEventListener('input', (e)=>{ filters.min = e.target.value ? Number(e.target.value) : null; renderAll(); });
      document.getElementById('filter-max').addEventListener('input', (e)=>{ filters.max = e.target.value ? Number(e.target.value) : null; renderAll(); });
      document.getElementById('sort-by').addEventListener('change', (e)=>{ filters.sortBy = e.target.value; renderAll(); });
      document.getElementById('clear-filters').addEventListener('click', ()=>{ resetFilters(); renderAll(); });

      // Cart actions
      document.getElementById('checkout').addEventListener('click', ()=> {
        alert('Checkout is a stub in this demo.');
      });

      // Contact form submission
      document.getElementById('contact-form').addEventListener('submit', (e)=> {
        e.preventDefault();
        const name = document.getElementById('name');
        const email = document.getElementById('email');
        const msg = document.getElementById('message');
        const status = document.getElementById('form-status');
        if (name.value.trim() && email.value.trim() && msg.value.trim()) {
          status.textContent = translations[currentLang]?.thankYou ?? 'Thank you! Your message has been sent.';
          setTimeout(()=>{ status.textContent = ''; }, 2500);
          document.getElementById('contact-form').reset();
        } else {
          status.textContent = 'Please fill all fields';
          setTimeout(()=>{ status.textContent = ''; }, 2000);
        }
      });

      // Chat interactions
      document.getElementById('open-chat').addEventListener('click', ()=> {
        const panel = document.getElementById('chat-panel');
        panel.hidden = false;
        panel.style.display = 'flex';
        panel.querySelector('#chat-input')?.focus();
      });
      document.getElementById('close-chat').addEventListener('click', ()=> {
        const panel = document.getElementById('chat-panel');
        panel.hidden = true;
        panel.style.display = 'none';
      });
      document.getElementById('send-chat').addEventListener('click', ()=> {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text) return;
        const chat = document.getElementById('chat-content');
        const user = document.createElement('div');
        user.className = 'message me';
        user.textContent = text;
        chat.appendChild(user);
        chat.scrollTop = chat.scrollHeight;
        input.value = '';
        // Bot reply
        setTimeout(()=> { appendChatBot("I can help you explore products. Try filtering by color or occasion!"); }, 800);
      });
      document.getElementById('chat-input').addEventListener('keydown', (e)=> {
        if (e.key === 'Enter') { e.preventDefault(); document.getElementById('send-chat').click(); }
      });
    }

    // Chat bot helper
    function appendChatBot(text){
      const chat = document.getElementById('chat-content');
      const msg = document.createElement('div');
      msg.className = 'message bot';
      msg.textContent = text;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    // Text translation updates (additional helpers)
    function resetFilters(){
      filters = { category: 'All', occasion: 'All', color: 'All', min: null, max: null, sortBy: 'default' };
      document.getElementById('filter-category').value = 'All';
      document.getElementById('filter-occasion').value = 'All';
      document.getElementById('filter-color').value = 'All';
      document.getElementById('filter-min').value = '';
      document.getElementById('filter-max').value = '';
      document.getElementById('sort-by').value = 'default';
    }

    // Initialize data and UI after DOM is ready
    window.addEventListener('DOMContentLoaded', ()=> {
      initImages();
      initUI();
      renderTexts();
      renderAll();
      renderAllCounts();
    });

  </script>
</body>
</html>