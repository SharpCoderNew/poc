<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AutoFlow Showroom - Car Dealer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg: #0b1020;
      --card: #151a32;
      --surface: #1e2342;
      --text: #e6e6f0;
      --muted: #a6a6c6;
      --accent: #6be675;
      --chip: #2b2f60;
      --rose: #ff6b6b;
      --green: #2ecc71;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(circle at 20% -10%, rgba(107,230,117,0.15), transparent 40%),
                  radial-gradient(circle at 100% 0%, rgba(109,110,230,0.15), transparent 40%),
                  var(--bg);
      color: var(--text);
      line-height: 1.4;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: rgba(15,18,40,0.92);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .container { width: min(1200px, 92%); margin: 0 auto; padding: 14px 0; }
    .brand {
      display: flex; align-items: center; gap: 12px;
    }
    .brand h1 { font-size: 1.2rem; margin: 0; }
    .brand .badge { font-size: 0.9rem; padding: 6px 10px; border-radius: 999px; background: #1a1f45; color: #e8eaff; }
    .layout { display: grid; grid-template-columns: 280px 1fr; gap: 16px; align-items: start; min-height: calc(100vh - 70px); padding: 16px 0; }
    aside#filters {
      background: rgba(16,20,45,0.95);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px; padding: 14px;
      position: sticky; top: 72px; align-self: start;
      max-height: calc(100vh - 90px); overflow: auto;
    }
    aside#filters h2 { font-size: 0.95rem; margin: 8px 0 8px; color: #eaf1ff; }
    .field { margin-bottom: 12px; }
    label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"], input[type="number"], select {
      width: 100%; padding: 9px 10px; border-radius: 8px;
      border: 1px solid #334; background: #0b1130; color: #fff;
    }
    .row { display: flex; gap: 8px; }
    .button, button {
      background: #2a2f67; color: white; border: 0; border-radius: 8px;
      padding: 9px 12px; cursor: pointer;
    }
    .button.secondary { background: #1b2140; }
    .button.danger { background: #a2183d; }
    .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 14px; align-content: start; }
    .card {
      background: linear-gradient(135deg, rgba(27, 31, 78, 0.95), rgba(14, 16, 40, 0.95));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px; padding: 12px; display: flex; flex-direction: column; height: 100%;
      box-shadow: 0 6px 16px rgba(0,0,0,0.25);
    }
    .card-media { position: relative; height: 150px; border-radius: 8px; overflow: hidden; background: #111; display: flex; align-items: center; justify-content: center; }
    .card-media .emoji { font-size: 48px; z-index: 2; }
    .card-media img { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s ease; }
    .card-media img.loaded { opacity: 1; }
    .skeleton { background: linear-gradient(-90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.0) 60%); height: 100%; width: 100%; animation: shimmer 1.2s infinite; }
    @keyframes shimmer {
      0% { background-position: 1% 0; }
      100% { background-position: 100% 0; }
    }
    .card h3 { margin: 10px 0 6px; font-size: 1rem; }
    .meta { font-size: 12px; color: var(--muted); display: flex; gap: 6px; flex-wrap: wrap; }
    .price { font-weight: bold; margin-left: auto; }
    .card-actions { margin-top: auto; display: flex; gap: 6px; }
    .tabs { display: flex; gap: 6px; margin-bottom: 8px; }
    .tab { padding: 8px 12px; border-radius: 8px; background: #1a1f46; border: 1px solid rgba(255,255,255,0.08); cursor: pointer; }
    .tab.active { background: #2b3170; color: white; }
    main { padding: 0; }
    /* Modal */
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.55); padding: 20px; z-index: 50; }
    .modal.open { display: flex; }
    .modal-content { width: min(720px, 100%); background: #111433; border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.1); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .modal-header h4 { margin: 0; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .admin-panel { margin-top: 16px; padding: 12px; background: rgba(20, 20, 60, 0.9); border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); }
    .admin-section { display: none; }
    .admin-section.active { display: block; }
    .table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .table th, .table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.08); text-align: left; }
    .avatar { width: 20px; height: 20px; border-radius: 50%; display: inline-block; background: #333; text-align: center; line-height: 20px; font-size: 12px; margin-right: 6px; vertical-align: middle; }
    .empty { text-align: center; padding: 40px 0; color: var(--muted); }
    @media (max-width: 980px){
      .layout { grid-template-columns: 1fr; }
      aside#filters { position: static; max-height: none; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container" role="banner">
      <div class="brand" aria-label="AutoFlow Brand">
        <span aria-hidden="true" style="font-size:28px;">ðŸš—</span>
        <h1>AutoFlow Showroom</h1>
        <span class="badge" aria-label="Status">Single-JSON Demo</span>
      </div>
    </div>
  </header>

  <div class="container" role="main" aria-label="Main content">
    <div class="layout">
      <!-- FILTERS (Left) -->
      <aside id="filters" aria-label="Filters">
        <h2>Filters & Search</h2>
        <div class="field">
          <label for="search">Search</label>
          <input id="search" type="text" placeholder="Search by make, model, or seller" />
        </div>
        <div class="field">
          <label for="makeFilter">Make</label>
          <select id="makeFilter">
            <option value="">All makes</option>
          </select>
        </div>
        <div class="row" aria-label="Year range">
          <div class="field" style="flex:1;">
            <label for="minYear">Min Year</label>
            <input id="minYear" type="number" min="1980" max="2100" step="1" value="1980" />
          </div>
          <div class="field" style="flex:1;">
            <label for="maxYear">Max Year</label>
            <input id="maxYear" type="number" min="1980" max="2100" step="1" value="2025" />
          </div>
        </div>
        <div class="field">
          <label for="bodyFilter">Body Type</label>
          <select id="bodyFilter">
            <option value="">All body types</option>
          </select>
        </div>
        <div class="field">
          <label for="fuelFilter">Fuel</label>
          <select id="fuelFilter">
            <option value="">All fuels</option>
          </select>
        </div>
        <div class="field">
          <label for="transFilter">Transmission</label>
          <select id="transFilter">
            <option value="">All transmissions</option>
          </select>
        </div>
        <div class="field">
          <label for="colorFilter">Color</label>
          <select id="colorFilter">
            <option value="">All colors</option>
          </select>
        </div>
        <div class="field">
          <label for="sort">Sort by</label>
          <select id="sort">
            <option value="popular">Popular</option>
            <option value="price_low">Price: Low to High</option>
            <option value="price_high">Price: High to Low</option>
            <option value="year_new">Year: Newest</option>
            <option value="mileage_low">Mileage: Low</option>
          </select>
        </div>
        <div class="field row" style="margin-top:6px;">
          <button class="button" id="resetFilters" aria-label="Reset filters">Reset Filters</button>
        </div>
      </aside>

      <!-- SHOWROOM (Right) -->
      <section aria-label="Showroom" id="showroom">
        <div class="tabs" role="navigation" aria-label="Showroom tabs">
          <button class="tab active" data-tab="all" aria-selected="true">All Cars</button>
          <button class="tab" data-tab="admin" aria-selected="false">Admin</button>
        </div>

        <div id="grid" class="card-grid" aria-label="Car grid">
          <!-- Cards injected by JS -->
        </div>

        <div class="row" style="justify-content: center; padding: 12px 0;">
          <button class="button secondary" id="prevPage" aria-label="Previous page">Previous</button>
          <span id="pageInfo" style="align-self:center; padding: 6px 12px; color:var(--muted);"></span>
          <button class="button secondary" id="nextPage" aria-label="Next page">Next</button>
        </div>

        <!-- Admin Panel (in a toggle tab) -->
        <div id="adminPanel" class="admin-panel" aria-label="Admin Panel" hidden>
          <div class="tabs" role="navigation" aria-label="Admin tabs">
            <button class="tab active" data-tab="sellers" aria-selected="true">Sellers</button>
            <button class="tab" data-tab="cars" aria-selected="false">Cars</button>
          </div>
          <section id="adminSellers" class="admin-section active" aria-label="Sellers Admin">
            <h3 style="margin:6px 0 12px;">Add Seller</h3>
            <div class="grid-2" style="gap:12px;">
              <input id="sellerName" placeholder="Name" />
              <input id="sellerEmail" placeholder="Email" />
              <input id="sellerPhone" placeholder="Phone" />
              <input id="sellerAddress" placeholder="Address" />
            </div>
            <div class="row" style="margin-top:8px;">
              <button class="button" id="saveSeller" aria-label="Create seller">Create Seller</button>
            </div>
            <h4 style="margin:14px 0 8px;">Sellers</h4>
            <table class="table" aria-label="Sellers table" id="sellersTable">
              <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Address</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </section>

          <section id="adminCars" class="admin-section" aria-label="Cars Admin">
            <h3 style="margin:6px 0 12px;">Add Car</h3>
            <div class="grid-2" style="grid-template-columns: 1fr 1fr; gap:12px;">
              <select id="carSeller"></select>
              <input id="carMake" placeholder="Make" />
              <input id="carModel" placeholder="Model" />
              <input id="carYear" placeholder="Year" type="number" min="1980" max="2100" />
              <input id="carPrice" placeholder="Price" type="number" />
              <input id="carMileage" placeholder="Mileage" type="number" />
              <select id="carBody">
                <option value="">Body Type</option><option>SUV</option><option>SEDAN</option><option>HATCHBACK</option><option>TRUCK</option>
              </select>
              <select id="carFuel">
                <option value="">Fuel</option><option>gasoline</option><option>diesel</option><option>electric</option><option>hybrid</option>
              </select>
              <select id="carTrans">
                <option value="">Transmission</option><option>automatic</option><option>manual</option>
              </select>
              <input id="carColor" placeholder="Color" />
              <input id="carVin" placeholder="VIN (optional)" />
              <textarea id="carDesc" placeholder="Description" rows="2"></textarea>
            </div>
            <div class="row" style="margin-top:8px; flex-wrap: wrap;">
              <button class="button" id="saveCar" aria-label="Create car">Create Car</button>
            </div>
            <h4 style="margin:14px 0 8px;">Cars</h4>
            <table class="table" aria-label="Cars table" id="carsTable">
              <thead><tr><th>Make</th><th>Model</th><th>Year</th><th>Seller</th><th>Price</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </section>
        </div>
      </section>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal" id="detailModal" aria-hidden="true" aria-label="Car details">
    <div class="modal-content" role="dialog" aria-label="Car details">
      <div class="modal-header">
        <h4 id="modalTitle">Car Details</h4>
        <button class="button" id="closeModal" aria-label="Close details">Close</button>
      </div>
      <div class="grid-2">
        <div id="modalImage" class="card-media" style="height:220px;">
          <span class="emoji" aria-label="car emoji" id="modalEmoji" style="font-size:56px;">ðŸš—</span>
          <img id="modalImg" alt="Car image" />
        </div>
        <div style="padding:6px 2px;">
          <div id="modalBody" style="font-size:14px; color:var(--muted); line-height:1.5;"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Minimal client-side "JSON DB" using localStorage (single file)
    // Seed data (2 sellers, 12 cars)
    const DB_KEY = 'autoflow_db_v1';
    const DEFAULT_SEED = {
      sellers: [
        { id: 's1', name: 'Alex Rivera', email: 'alex@example.com', phone: '+1 555-0101', address: '123 Market St, San Jose', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
        { id: 's2', name: 'Jamie Chen', email: 'jamie@example.com', phone: '+1 555-0102', address: '789 Ocean Ave, Austin', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() }
      ],
      cars: [
        { id: 'c1', sellerId: 's1', make: 'Toyota', model: 'Camry', year: 2019, price: 19500, mileage: 42000, bodyType: 'SEDAN', fuel: 'gasoline', transmission: 'automatic', color: 'red', emoji: 'ðŸš—', vin: '1HGCM82633A004352', description: 'Reliable family sedan with excellent resale value.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 80 },
        { id: 'c2', sellerId: 's1', make: 'Honda', model: 'Civic', year: 2020, price: 21000, mileage: 18000, bodyType: 'SEDAN', fuel: 'gasoline', transmission: 'automatic', color: 'blue', emoji: 'ðŸš—', vin: '2HGFG12668H123456', description: 'Civic with solid handling and great fuel economy.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 95 },
        { id: 'c3', sellerId: 's2', make: 'Ford', model: 'F-150', year: 2018, price: 27500, mileage: 55000, bodyType: 'TRUCK', fuel: 'gasoline', transmission: 'automatic', color: 'black', emoji: 'ðŸš™', vin: '1FTFW1EF2JFB12345', description: 'Work-ready pickup with impressive torque.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 70 },
        { id: 'c4', sellerId: 's2', make: 'Tesla', model: 'Model 3', year: 2021, price: 38999, mileage: 12000, bodyType: 'SEDAN', fuel: 'electric', transmission: 'automatic', color: 'white', emoji: 'ðŸš—', vin: '5YJ3E1EA7MF1B12345', description: 'Electric efficiency with modern tech suite.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 110 },
        { id: 'c5', sellerId: 's1', make: 'BMW', model: '3 Series', year: 2017, price: 15999, mileage: 78000, bodyType: 'SEDAN', fuel: 'diesel', transmission: 'automatic', color: 'gray', emoji: 'ðŸš˜', vin: 'WBA8A9C58GNU12345', description: 'Sporty dynamics and premium interior.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 60 },
        { id: 'c6', sellerId: 's1', make: 'Audi', model: 'A4', year: 2020, price: 28999, mileage: 32000, bodyType: 'SEDAN', fuel: 'gasoline', transmission: 'automatic', color: 'silver', emoji: 'ðŸš—', vin: 'WAUZZZ8K5DA012345', description: 'Quiet cabin and refined performance.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 85 },
        { id: 'c7', sellerId: 's2', make: 'Hyundai', model: 'Elantra', year: 2019, price: 14999, mileage: 42000, bodyType: 'SEDAN', fuel: 'gasoline', transmission: 'automatic', color: 'green', emoji: 'ðŸš—', vin: '5NPD84L38KH012345', description: 'Economical daily driver with good value.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 65 },
        { id: 'c8', sellerId: 's2', make: 'Nissan', model: 'Rogue', year: 2020, price: 21999, mileage: 24000, bodyType: 'SUV', fuel: 'gasoline', transmission: 'automatic', color: 'blue', emoji: 'ðŸš™', vin: '5N1AT2MV0LC012345', description: 'Compact SUV with ample cargo space.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 90 },
        { id: 'c9', sellerId: 's1', make: 'Mazda', model: 'CX-5', year: 2021, price: 25999, mileage: 15000, bodyType: 'SUV', fuel: 'gasoline', transmission: 'automatic', color: 'red', emoji: 'ðŸš™', vin: 'JM3KFBCM5J1234567', description: 'Sporty handling and stylish interior.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 100 },
        { id: 'c10', sellerId: 's2', make: 'Chevrolet', model: 'Bolt', year: 2022, price: 30999, mileage: 5000, bodyType: 'HATCHBACK', fuel: 'electric', transmission: 'automatic', color: 'blue', emoji: 'âš¡', vin: '1G1FW6S07G0123456', description: 'Affordable electric hatch with good range.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 75 },
        { id: 'c11', sellerId: 's1', make: 'Kia', model: 'Telluride', year: 2020, price: 34999, mileage: 21000, bodyType: 'SUV', fuel: 'gasoline', transmission: 'automatic', color: 'black', emoji: 'ðŸš™', vin: '5XYP2D8A0LJ012345', description: 'Family-friendly three-row SUV.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 88 },
        { id: 'c12', sellerId: 's2', make: 'Ford', model: 'Mustang', year: 2016, price: 19999, mileage: 68000, bodyType: 'COUPE', fuel: 'gasoline', transmission: 'manual', color: 'yellow', emoji: 'ðŸ', vin: '1FA6P8CF3G5101234', description: 'Iconic muscle car with manual fun.', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), popularity: 72 }
      ]
    };

    // Utility
    const now = () => new Date().toISOString();
    function saveDB(data){ localStorage.setItem(DB_KEY, JSON.stringify(data)); }
    function loadDB(){ const raw = localStorage.getItem(DB_KEY); if(!raw) return null; try { return JSON.parse(raw); } catch { return null; } }

    // init DB
    function initDB(){
      const existing = loadDB();
      if(!existing){
        const seed = DEFAULT_SEED;
        saveDB(seed);
        // Also expose as "db" global for dev
        window.__db = JSON.parse(JSON.stringify(seed));
      } else {
        window.__db = existing;
      }
    }

    // Simple lock for writes
    let writeLock = false;
    function withLock(p) {
      return new Promise((resolve, reject) => {
        const tryRun = () => {
          if(!writeLock){
            writeLock = true;
            Promise.resolve(p()).then(res => {
              writeLock = false;
              resolve(res);
            }).catch(err => {
              writeLock = false;
              reject(err);
            });
          } else {
            setTimeout(tryRun, 20);
          }
        };
        tryRun();
      });
    }

    // DB operations (CRUD)
    const api = {
      getSellers: async () => {
        const db = loadDB() || window.__db;
        return db.sellers.map(s => ({ ...s }));
      },
      getCars: async () => {
        const db = loadDB() || window.__db;
        return db.cars.map(c => ({ ...c }));
      },
      getSeller: async (id) => {
        const db = loadDB() || window.__db;
        return db.sellers.find(s => s.id === id);
      },
      getCar: async (id) => {
        const db = loadDB() || window.__db;
        return db.cars.find(c => c.id === id);
      },
      createSeller: async (payload) => {
        if(!payload?.name || !payload?.email) throw new Error('Name and email are required');
        await withLock(async () => {
          const db = loadDB() || window.__db;
          // unique email
          if(db.sellers.find(s => s.email.toLowerCase() === payload.email.toLowerCase())){
            throw new Error('Email already exists');
          }
          const id = 's' + cryptoRandom();
          const nowS = now();
          const newSeller = { id, name: payload.name, email: payload.email, phone: payload.phone||'', address: payload.address||'', createdAt: nowS, updatedAt: nowS };
          db.sellers.push(newSeller);
          saveDB(db);
          window.__db = db;
          return newSeller;
        });
      },
      updateSeller: async (id, payload) => {
        return withLock(async () => {
          const db = loadDB() || window.__db;
          const s = db.sellers.find(s => s.id === id);
          if(!s) throw new Error('Seller not found');
          // email unique if changed
          if(payload?.email && payload.email !== s.email){
            if(db.sellers.find(x => x.email.toLowerCase() === payload.email.toLowerCase())){
              throw new Error('Email already exists');
            }
          }
          Object.assign(s, payload);
          s.updatedAt = now();
          saveDB(db); window.__db = db;
          return s;
        });
      },
      deleteSeller: async (id) => {
        return withLock(async () => {
          const db = loadDB() || window.__db;
          // check reference
          if(db.cars.some(c => c.sellerId === id)){
            const err = new Error('Cannot delete seller with assigned cars');
            err.code = 409;
            throw err;
          }
          const idx = db.sellers.findIndex(s => s.id === id);
          if(idx === -1) throw new Error('Seller not found');
          db.sellers.splice(idx, 1);
          saveDB(db); window.__db = db;
          return true;
        });
      },
      createCar: async (payload) => {
        return withLock(async () => {
          const db = loadDB() || window.__db;
          // required fields
          const { sellerId, make, model, year, price } = payload;
          if(!sellerId || !make || !model || year == null || price == null){
            throw new Error('Missing required car fields');
          }
          // seller exists
          if(!db.sellers.find(s => s.id === sellerId)){
            throw new Error('Seller not found');
          }
          // vin unique if present
          if(payload.vin && db.cars.find(c => c.vin && c.vin.toLowerCase() === payload.vin.toLowerCase())){
            throw new Error('VIN already exists');
          }
          const id = 'c' + cryptoRandom();
          const nowC = now();
          const newCar = {
            id, sellerId, make, model, year, price, mileage: payload.mileage ?? 0,
            bodyType: payload.bodyType ?? '', fuel: payload.fuel ?? '', transmission: payload.transmission ?? '',
            color: payload.color ?? '', emoji: payload.emoji ?? 'ðŸš—', vin: payload.vin ?? '', description: payload.description ?? '',
            createdAt: nowC, updatedAt: nowC, popularity: payload.popularity ?? 50
          };
          db.cars.push(newCar);
          saveDB(db); window.__db = db;
          return newCar;
        });
      },
      updateCar: async (id, payload) => {
        return withLock(async () => {
          const db = loadDB() || window.__db;
          const car = db.cars.find(c => c.id === id);
          if(!car) throw new Error('Car not found');
          // if sellerId changed, ensure seller exists
          if(payload?.sellerId && payload.sellerId !== car.sellerId){
            if(!db.sellers.find(s => s.id === payload.sellerId)){
              throw new Error('Seller not found');
            }
            car.sellerId = payload.sellerId;
          }
          // vin unique if changed
          if(payload?.vin && payload.vin !== car.vin){
            if(db.cars.find(x => x.vin && x.vin.toLowerCase() === payload.vin.toLowerCase())){
              throw new Error('VIN already exists');
            }
            car.vin = payload.vin;
          }
          // update other fields
          Object.assign(car, payload);
          car.updatedAt = now();
          saveDB(db); window.__db = db;
          return car;
        });
      },
      deleteCar: async (id) => {
        return withLock(async () => {
          const db = loadDB() || window.__db;
          const idx = db.cars.findIndex(c => c.id === id);
          if(idx === -1) throw new Error('Car not found');
          db.cars.splice(idx, 1);
          saveDB(db); window.__db = db;
          return true;
        });
      }
    };

    // Simple crypto helper (portable)
    function cryptoRandom(){ // returns a short unique string
      const arr = new Uint8Array(6);
      crypto.getRandomValues(arr);
      return Array.from(arr).map(v => v.toString(16).padStart(2,'0')).join('');
    }

    // SVG "image" generator (inline, self-contained)
    function generateSVGdata(car){
      const w = 800, h = 600;
      const color = car.color || 'teal';
      const title = `${car.year} ${car.make} ${car.model}`;
      const svg = `
        <svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'>
          <defs>
            <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>
              <stop stop-color='${color}' offset='0'/>
              <stop stop-color='${shade(color, -20)}' offset='1'/>
            </linearGradient>
          </defs>
          <rect width='100%' height='100%' fill='url(#g)'/>
          <circle cx='120' cy='520' r='60' fill='rgba(255,255,255,0.25)'/>
          <circle cx='700' cy='140' r='90' fill='rgba(255,255,255,0.25)'/>
          <text x='50%' y='50%' text-anchor='middle' fill='white' font-family='Arial' font-size='40'>${title}</text>
          <text x='50%' y='65%' text-anchor='middle' fill='rgba(255,255,255,0.9)' font-family='Arial' font-size='22'>AutoFlow</text>
        </svg>
      `;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }
    function shade(hex, percent){
      // naive color shade for gradient
      const colors = {
        red: '#e74c3c', blue:'#3498db', green:'#2ecc71', gray:'#95a5a6', black:'#2d2d2d',
        white:'#ffffff', purple:'#9b59b6', teal:'#1abc9c', yellow:'#f1c40f'
      };
      // simple fallback: map simple names
      const c = {
        red: '#e74c3c',
        blue: '#3498db',
        green: '#2ecc71',
        gray: '#95a5a6',
        black: '#2d2d2d',
        white: '#ffffff',
        teal: '#1abc9c'
      }[hex] || hex;
      // Not precise; just return c for simplicity
      return c;
    }

    // Debounce
    function debounce(fn, delay){
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn.apply(null, args), delay);
      };
    }

    // UI State
    let currentPage = 1;
    const PAGE_SIZE = 6;
    let currentTab = 'all'; // 'all' or 'admin'
    let adminActive = 'sellers'; // or 'cars'
    let lastFilterCache = null;

    // Init & render
    async function initUI(){
      initDB();
      // populate admin and showroom
      await renderFilters();
      await renderShowroom();
      setupEventHandlers();
    }

    // Helpers to render
    async function renderFilters(){
      const db = loadDB() || window.__db;
      const makes = Array.from(new Set(db.cars.map(c => c.make))).sort();
      const bodies = Array.from(new Set(db.cars.map(c => c.bodyType))).filter(Boolean).sort();
      const fuels = Array.from(new Set(db.cars.map(c => c.fuel))).filter(Boolean).sort();
      const trans = Array.from(new Set(db.cars.map(c => c.transmission))).filter(Boolean).sort();
      const colors = Array.from(new Set(db.cars.map(c => c.color))).filter(Boolean).sort();

      const makeSel = document.getElementById('makeFilter');
      makeSel.innerHTML = '<option value="">All makes</option>' + makes.map(m => `<option value="${m}">${m}</option>`).join('');
      const bodySel = document.getElementById('bodyFilter');
      bodySel.innerHTML = '<option value="">All body types</option>' + bodies.map(b => `<option value="${b}">${b}</option>`).join('');
      const fuelSel = document.getElementById('fuelFilter');
      fuelSel.innerHTML = '<option value="">All fuels</option>' + fuels.map(f => `<option value="${f}">${f}</option>`).join('');
      const transSel = document.getElementById('transFilter');
      transSel.innerHTML = '<option value="">All transmissions</option>' + trans.map(t => `<option value="${t}">${t}</option>`).join('');
      const colorSel = document.getElementById('colorFilter');
      colorSel.innerHTML = '<option value="">All colors</option>' + colors.map(c => `<option value="${c}">${c}</option>`).join('');

      // update seller dropdown in add car (admin)
      const carSellerSel = document.getElementById('carSeller');
      const sellers = db.sellers;
      carSellerSel.innerHTML = sellers.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
      // clear search & year range defaults
      document.getElementById('minYear').value = 1980;
      document.getElementById('maxYear').value = 2025;
    }

    async function renderShowroom(){
      // gather filters
      const search = (document.getElementById('search').value || '').toLowerCase().trim();
      const make = document.getElementById('makeFilter').value;
      const minY = parseInt(document.getElementById('minYear').value || 0, 10);
      const maxY = parseInt(document.getElementById('maxYear').value || 9999, 10);
      const body = document.getElementById('bodyFilter').value;
      const fuel = document.getElementById('fuelFilter').value;
      const trans = document.getElementById('transFilter').value;
      const color = document.getElementById('colorFilter').value;
      const sort = document.getElementById('sort').value;

      const db = loadDB() || window.__db;
      let cars = db.cars.filter(c => {
        if(make && c.make !== make) return false;
        if(body && c.bodyType !== body) return false;
        if(fuel && c.fuel !== fuel) return false;
        if(trans && c.transmission !== trans) return false;
        if(color && c.color !== color) return false;
        if(c.year < minY || c.year > maxY) return false;
        if(search){
          const seller = db.sellers.find(s => s.id === c.sellerId);
          const hay = `${c.make} ${c.model} ${seller?.name ?? ''}`.toLowerCase();
          if(!hay.includes(search)) return false;
        }
        return true;
      });

      // sort
      switch(sort){
        case 'price_low': cars.sort((a,b)=> a.price - b.price); break;
        case 'price_high': cars.sort((a,b)=> b.price - a.price); break;
        case 'year_new': cars.sort((a,b)=> b.year - a.year); break;
        case 'mileage_low': cars.sort((a,b)=> a.mileage - b.mileage); break;
        default: cars.sort((a,b)=> (b.popularity||0) - (a.popularity||0)); break;
      }

      // pagination
      const totalPages = Math.max(1, Math.ceil(cars.length / PAGE_SIZE));
      if(currentPage > totalPages) currentPage = totalPages;
      const start = (currentPage - 1) * PAGE_SIZE;
      const pageItems = cars.slice(start, start + PAGE_SIZE);

      // render
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      if(pageItems.length === 0){
        grid.innerHTML = '<div class="empty" role="status" aria-live="polite">No cars match your filters. Try clearing some filters.</div>';
      } else {
        for(let car of pageItems){
          const seller = db.sellers.find(s => s.id === car.sellerId);
          const svg = generateSVGdata(car);
          const card = document.createElement('article');
          card.className = 'card';
          card.innerHTML = `
            <div class="card-media" aria-label="Car image">
              <span class="emoji" aria-label="car emoji" style="font-size:48px;">${car.emoji || 'ðŸš—'}</span>
              <img alt="${car.make} ${car.model}" />
            </div>
            <h3>${car.year} ${car.make} ${car.model}</h3>
            <div class="meta" aria-label="Car meta">
              <span>Seller: ${seller?.name ?? 'Unknown'}</span>
              <span>Color: ${car.color}</span>
              <span>Body: ${car.bodyType}</span>
              <span>Fuel: ${car.fuel}</span>
              <span>Trans: ${car.transmission}</span>
            </div>
            <div class="row" style="margin-top:6px;">
              <strong class="price" aria-label="Price">$${car.price.toLocaleString()}</strong>
            </div>
            <div class="card-actions" aria-label="Card actions">
              <button class="button" data-action="view" data-id="${car.id}">View</button>
              <button class="button secondary" data-action="edit" data-id="${car.id}">Edit</button>
              <button class="button danger" data-action="delete" data-id="${car.id}">Delete</button>
            </div>
          `;
          // image handling: emoji shown, swap to generated SVG without external assets
          const img = card.querySelector('img');
          img.src = ''; // initial empty
          img.style.display = 'block';
          const emojiEl = card.querySelector('.emoji');
          // simulate loading
          const svgUrl = svg;
          setTimeout(() => {
            img.src = svgUrl;
            img.onload = () => img.classList.add('loaded');
            emojiEl.style.display = 'none';
            // set src to loaded
          }, 200);
          grid.appendChild(card);
        }
      }

      // setup card actions (event delegation)
      grid.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const action = btn.getAttribute('data-action');
          const id = btn.getAttribute('data-id');
          if(action === 'view'){
            openDetail(id);
          } else if(action === 'edit'){
            openEditCar(id);
          } else if(action === 'delete'){
            if(confirm('Delete this car?')){
              await api.deleteCar(id);
              await renderShowroom();
            }
          }
        });
      });

      // update page info
      document.getElementById('pageInfo').textContent = `Page ${currentPage} / ${totalPages}`;
      // enable/disable nav
      document.getElementById('prevPage').disabled = currentPage <= 1;
      document.getElementById('nextPage').disabled = currentPage >= totalPages;
    }

    function openDetail(carId){
      const db = loadDB() || window.__db;
      const car = db.cars.find(c => c.id === carId);
      const seller = db.sellers.find(s => s.id === car.sellerId);
      document.getElementById('modalTitle').textContent = `${car.year} ${car.make} ${car.model}`;
      const body = [
        `Seller: ${seller?.name ?? 'Unknown'}`,
        `Price: $${car.price.toLocaleString()}`,
        `Mileage: ${car.mileage.toLocaleString()} miles`,
        `Body: ${car.bodyType}, Color: ${car.color}, Fuel: ${car.fuel}, Transmission: ${car.transmission}`,
        `VIN: ${car.vin ?? 'N/A'}`,
        `Description: ${car.description ?? ''}`
      ].join('<br>');
      document.getElementById('modalBody').innerHTML = body;
      // image in modal
      const modalImg = document.getElementById('modalImg');
      const modalEmoji = document.getElementById('modalEmoji');
      const svg = generateSVGdata(car);
      modalImg.src = '';
      modalImg.style.display = 'block';
      modalImg.onload = () => {
        modalEmoji.style.display = 'none';
      };
      // start with emoji
      modalEmoji.style.display = 'inline';
      modalImg.src = svg;
      // show modal
      const modal = document.getElementById('detailModal');
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      // focus
      setTimeout(() => document.getElementById('closeModal').focus(), 50);
    }

    function closeDetail(){
      const modal = document.getElementById('detailModal');
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    function openEditCar(carId){
      // fill form with car data for editing (in Cars admin)
      const db = loadDB() || window.__db;
      const car = db.cars.find(c => c.id === carId);
      if(!car) return;
      // switch to Cars admin
      activateAdminSection('cars');
      // populate form
      document.getElementById('carMake').value = car.make;
      document.getElementById('carModel').value = car.model;
      document.getElementById('carYear').value = car.year;
      document.getElementById('carPrice').value = car.price;
      document.getElementById('carMileage').value = car.mileage;
      document.getElementById('carBody').value = car.bodyType;
      document.getElementById('carFuel').value = car.fuel;
      document.getElementById('carTrans').value = car.transmission;
      document.getElementById('carColor').value = car.color;
      document.getElementById('carVin').value = car.vin;
      document.getElementById('carDesc').value = car.description;
      // update seller
      document.getElementById('carSeller').value = car.sellerId;
      // store id for update
      window.__editCarId = car.id;
      document.getElementById('saveCar').textContent = 'Update Car';
    }

    async function resetFilters(){
      document.getElementById('search').value = '';
      document.getElementById('makeFilter').value = '';
      document.getElementById('minYear').value = 1980;
      document.getElementById('maxYear').value = 2025;
      document.getElementById('bodyFilter').value = '';
      document.getElementById('fuelFilter').value = '';
      document.getElementById('transFilter').value = '';
      document.getElementById('colorFilter').value = '';
      document.getElementById('sort').value = 'popular';
      currentPage = 1;
      await renderShowroom();
    }

    function activateAdminSection(name){
      document.querySelectorAll('.admin-section').forEach(sec => sec.classList.remove('active'));
      document.getElementById('admin'+capitalize(name)).classList.add('active');
    }
    function capitalize(s){ return s.charAt(0).toUpperCase() + s.slice(1); }

    // Event wiring
    function setupEventHandlers(){
      // Filters
      const onFilterChange = debounce(async () => {
        currentPage = 1;
        await renderShowroom();
      }, 250);
      document.getElementById('search').addEventListener('input', onFilterChange);
      document.getElementById('makeFilter').addEventListener('change', onFilterChange);
      document.getElementById('minYear').addEventListener('change', onFilterChange);
      document.getElementById('maxYear').addEventListener('change', onFilterChange);
      document.getElementById('bodyFilter').addEventListener('change', onFilterChange);
      document.getElementById('fuelFilter').addEventListener('change', onFilterChange);
      document.getElementById('transFilter').addEventListener('change', onFilterChange);
      document.getElementById('colorFilter').addEventListener('change', onFilterChange);
      document.getElementById('sort').addEventListener('change', onFilterChange);

      // Pagination
      document.getElementById('prevPage').addEventListener('click', async () => {
        if(currentPage > 1){ currentPage--; await renderShowroom(); }
      });
      document.getElementById('nextPage').addEventListener('click', async () => {
        currentPage++; await renderShowroom();
      });

      // Reset
      document.getElementById('resetFilters').addEventListener('click', async () => { await resetFilters(); });

      // Admin toggle tabs
      document.querySelectorAll('.tabs .tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
          const target = tab.getAttribute('data-tab');
          document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          if(tab.parentElement.id === 'adminSellers' || tab.parentElement.id === 'adminCars'){
            // handled differently
          }
          // show sections
        });
      });

      // Admin toggle button (hidden by default; shown by "Admin" tab)
      // Create Seller
      document.getElementById('saveSeller').addEventListener('click', async () => {
        const name = document.getElementById('sellerName').value.trim();
        const email = document.getElementById('sellerEmail').value.trim();
        const phone = document.getElementById('sellerPhone').value.trim();
        const address = document.getElementById('sellerAddress').value.trim();
        if(!name || !email){
          alert('Please provide name and email for seller.');
          return;
        }
        try{
          const s = await api.createSeller({ name, email, phone, address });
          // clear
          document.getElementById('sellerName').value = '';
          document.getElementById('sellerEmail').value = '';
          document.getElementById('sellerPhone').value = '';
          document.getElementById('sellerAddress').value = '';
          await renderSellersTable();
          await renderFilters();
        }catch(e){
          alert(e.message);
        }
      });

      async function renderSellersTable(){
        const sellers = await api.getSellers();
        const tbody = document.querySelector('#sellersTable tbody');
        tbody.innerHTML = '';
        sellers.forEach(s => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${s.name}</td><td>${s.email}</td><td>${s.phone}</td><td>${s.address}</td>
            <td>
              <button class="button" data-action="edit-seller" data-id="${s.id}">Edit</button>
              <button class="button danger" data-action="delete-seller" data-id="${s.id}">Delete</button>
            </td>`;
          tbody.appendChild(tr);
        });
        tbody.querySelectorAll('button[data-action]').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            const id = btn.getAttribute('data-id');
            const action = btn.getAttribute('data-action');
            if(action === 'edit-seller'){
              openEditSeller(id);
            } else if(action === 'delete-seller'){
              if(confirm('Delete seller? This will fail if cars reference this seller.')){
                try{ await api.deleteSeller(id); await renderSellersTable(); await renderFilters(); await renderShowroom(); }catch(e){ alert(e.message); }
              }
            }
          });
        });
      }

      async function openEditSeller(id){
        const s = (await api.getSellers()).find(x => x.id === id);
        if(!s) return;
        const name = prompt('Edit name', s.name) ?? s.name;
        const email = prompt('Edit email', s.email) ?? s.email;
        const phone = prompt('Edit phone', s.phone) ?? s.phone;
        const address = prompt('Edit address', s.address) ?? s.address;
        try{
          await api.updateSeller(id, { name, email, phone, address });
          await renderSellersTable();
          await renderFilters();
          await renderShowroom();
        }catch(e){
          alert(e.message);
        }
      }

      // Create Car
      document.getElementById('saveCar').addEventListener('click', async () => {
        const sellerId = document.getElementById('carSeller').value;
        const make = document.getElementById('carMake').value.trim();
        const model = document.getElementById('carModel').value.trim();
        const year = parseInt(document.getElementById('carYear').value, 10);
        const price = parseInt(document.getElementById('carPrice').value, 10);
        const mileage = parseInt(document.getElementById('carMileage').value, 10) || 0;
        const bodyType = document.getElementById('carBody').value;
        const fuel = document.getElementById('carFuel').value;
        const transmission = document.getElementById('carTrans').value;
        const color = document.getElementById('carColor').value;
        const vin = document.getElementById('carVin').value;
        const description = document.getElementById('carDesc').value;

        if(!sellerId || !make || !model || isNaN(year) || isNaN(price)){
          alert('Please fill required fields: seller, make, model, year, price.');
          return;
        }

        try{
          const c = await api.createCar({ sellerId, make, model, year, price, mileage, bodyType, fuel, transmission, color, vin, description });
          // reset
          document.getElementById('carMake').value = '';
          document.getElementById('carModel').value = '';
          document.getElementById('carYear').value = '';
          document.getElementById('carPrice').value = '';
          document.getElementById('carMileage').value = '';
          document.getElementById('carBody').value = '';
          document.getElementById('carFuel').value = '';
          document.getElementById('carTrans').value = '';
          document.getElementById('carColor').value = '';
          document.getElementById('carVin').value = '';
          document.getElementById('carDesc').value = '';
          await renderSellersTable();
          await renderFilters();
          await renderShowroom();
        }catch(e){
          alert(e.message);
        }
      });

      // Init admin lists when admin tab is opened
      document.querySelectorAll('.tab').forEach(t => {
        t.addEventListener('click', () => {
          const tabName = t.getAttribute('data-tab');
          // Only admin tab uses
        });
      });
    }

    // Start
    window.addEventListener('DOMContentLoaded', () => {
      // show/hide admin when user toggles
      const adminBtn = document.createElement('button');
      adminBtn.textContent = 'Open Admin';
      adminBtn.className = 'button';
      adminBtn.style.marginLeft = '8px';
      adminBtn.addEventListener('click', () => {
        const panel = document.getElementById('adminPanel');
        panel.hidden = !panel.hidden;
        if(!panel.hidden){
          activateAdminSection('sellers');
          renderSellersTable();
          renderShowroom();
        }
      });
      document.querySelector('.container').appendChild(adminBtn);

      // close modal
      document.getElementById('closeModal').addEventListener('click', closeDetail);
      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') {
          if(document.getElementById('detailModal').classList.contains('open')) closeDetail();
        }
      });

      initUI().catch(console.error);
    });

    // Init with seeds if needed
    initDB();

  </script>
  
</body>
</html>